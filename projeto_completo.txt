

==================================================
FILE: backend\package.json
==================================================

{
  "name": "sgac-braz-backend",
  "version": "0.1.0",
  "description": "Backend para o Sistema de Gest√£o de Atendimentos do CREAS Brazl√¢ndia",
  "main": "src/server.ts",
  "scripts": {
    "dev": "tsx watch src/server.ts",
    "build": "tsup src --out-dir dist",
    "start": "node dist/server.js"
  },
  "keywords": [
    "creas",
    "assistencia-social",
    "gestao"
  ],
  "author": "DevHelper CREAS",
  "license": "ISC",
  "prisma": {
    "seed": "tsx prisma/seed.ts"
  },
  "dependencies": {
    "@fastify/cors": "^11.1.0",
    "@fastify/formbody": "^8.0.2",
    "@fastify/helmet": "^13.0.2",
    "@fastify/jwt": "^10.0.0",
    "@prisma/client": "^6.19.0",
    "bcryptjs": "^3.0.3",
    "date-fns": "^4.1.0",
    "dotenv": "^17.2.3",
    "fast-csv": "^5.0.5",
    "fastify": "^5.6.2",
    "pg": "^8.16.3",
    "zod": "^4.1.12"
  },
  "devDependencies": {
    "@faker-js/faker": "^10.1.0",
    "@types/node": "^24.10.0",
    "pino-pretty": "^13.1.2",
    "prisma": "6.19.0",
    "tsup": "^8.5.0",
    "tsx": "^4.20.6",
    "typescript": "^5.9.3"
  }
}

==================================================
FILE: backend\prisma\migration-scripts\backfill-paefi-dates.ts
==================================================

// backend/prisma/migration-scripts/backfill-paefi-dates.ts
import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()

async function main() {
  console.log('A iniciar o script de corre√ß√£o de dados...')

  // 1. Encontra todos os casos que est√£o em acompanhamento mas n√£o t√™m a data de in√≠cio do PAEFI.
  const casesToUpdate = await prisma.case.findMany({
    where: {
      status: 'EM_ACOMPANHAMENTO_PAEFI',
      dataInicioPAEFI: null,
    },
  })

  if (casesToUpdate.length === 0) {
    console.log('Nenhum caso a necessitar de corre√ß√£o. Base de dados j√° est√° atualizada.')
    return
  }

  console.log(`Encontrados ${casesToUpdate.length} casos para atualizar.`)

  // 2. Para cada caso, atualiza a `dataInicioPAEFI` usando a data da √∫ltima atualiza√ß√£o (`updatedAt`).
  // Esta √© a melhor aproxima√ß√£o que temos para quando o status mudou para "Em Acompanhamento".
  for (const caseItem of casesToUpdate) {
    await prisma.case.update({
      where: { id: caseItem.id },
      data: {
        dataInicioPAEFI: caseItem.updatedAt,
      },
    })
    console.log(`- Caso ${caseItem.nomeCompleto} (ID: ${caseItem.id}) foi atualizado.`)
  }

  console.log('Script de corre√ß√£o conclu√≠do com sucesso!')
}

main()
  .catch((e) => {
    console.error('Ocorreu um erro durante a execu√ß√£o do script:', e)
    process.exit(1)
  })
  .finally(async () => {
    await prisma.$disconnect()
  })



==================================================
FILE: backend\prisma\schema.prisma
==================================================

// backend/prisma/schema.prisma ‚Äî Schema principal do Prisma, respons√°vel por mapear todas as entidades do SGAC, com organiza√ß√£o visual e coment√°rios para facilitar manuten√ß√£o e expans√£o.

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

/* ============================================================
   USER ‚Äî Tabela de usu√°rios do sistema
   ============================================================ */
model User {
  id        String   @id @default(uuid())
  nome      String
  email     String   @unique
  senha     String
  cargo     String   // "Gerente", "Agente Social", "Especialista"
  ativo     Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Rela√ß√µes ‚Äî Casos de acolhida (Agente Social)
  casosDeAcolhida       Case[]        @relation("AgenteAcolhida")

  // Casos PAEFI (Especialista T√©cnico)
  casosDeAcompanhamento Case[]        @relation("EspecialistaPAEFI")

  // Casos criados (quem registra)
  casosCriados          Case[]        @relation("CasosCriados")

  // Evolu√ß√µes produzidas
  evolucoes             Evolucao[]    @relation("EvolucoesDoAutor")

  // PAFs criados
  pafsCriados           Paf[]         @relation("PafsDoAutor")

  // Agendamentos criados
  agendamentos          Agendamento[] @relation("AgendamentosDoResponsavel")

  // Logs gerados (auditoria)
  logsGerados           CaseLog[]     @relation("LogsDoAutor")
}

/* ============================================================
   CASE ‚Äî Dossi√™ principal das fam√≠lias/indiv√≠duos
   ============================================================ */
model Case {
  id          String   @id @default(uuid())
  nomeCompleto String
  cpf          String   @unique
  nascimento   DateTime
  sexo         String
  telefone     String
  endereco     String
  urgencia     String
  violacao     String
  categoria    String
  orgaoDemandante String

  numeroSei    String?
  linkSei      String?
  observacoes  String?

  dataEntrada  DateTime @default(now())
  status       String   @default("AGUARDANDO_ACOLHIDA")

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  /* ----------------- Rela√ß√µes ----------------- */

  // Quem criou o caso
  criadoPor   User   @relation("CasosCriados", fields: [criadoPorId], references: [id])
  criadoPorId String

  // Quem faz a acolhida (Agente Social)
  agenteAcolhida   User?  @relation("AgenteAcolhida", fields: [agenteAcolhidaId], references: [id])
  agenteAcolhidaId String?

  // Quem acompanha PAEFI (Especialista)
  especialistaPAEFI   User?  @relation("EspecialistaPAEFI", fields: [especialistaPAEFIId], references: [id])
  especialistaPAEFIId String?

  // Evolu√ß√µes
  evolucoes   Evolucao[]

  // PAF ‚Äî um por caso
  paf         Paf?

  // Agendamentos
  agendamentos Agendamento[]

  // Logs ‚Äî hist√≥rico de auditoria
  logs        CaseLog[]

  /* ----------------- Campos avan√ßados ----------------- */

  beneficios          String[]   // Array de benef√≠cios
  dataInicioPAEFI     DateTime?
  dataDesligamento    DateTime?
  motivoDesligamento  String?
  parecerFinal        String?
}

/* ============================================================
   EVOLU√á√ÉO ‚Äî Registros escritos pelos t√©cnicos
   ============================================================ */
model Evolucao {
  id        String   @id @default(uuid())
  conteudo  String   @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // V√≠nculo com o caso
  caso      Case     @relation(fields: [casoId], references: [id], onDelete: Cascade)
  casoId    String

  // Autor da evolu√ß√£o
  autor     User     @relation("EvolucoesDoAutor", fields: [autorId], references: [id])
  autorId   String
}

/* ============================================================
   PAF ‚Äî Plano de Acompanhamento
   ============================================================ */
model Paf {
  id          String   @id @default(uuid())
  diagnostico String   @db.Text
  objetivos   String   @db.Text
  estrategias String   @db.Text
  deadline    DateTime

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  caso        Case     @relation(fields: [casoId], references: [id], onDelete: Cascade)
  casoId      String   @unique   // Um caso s√≥ pode ter 1 PAF

  autor       User     @relation("PafsDoAutor", fields: [autorId], references: [id])
  autorId     String
}

/* ============================================================
   AGENDAMENTO ‚Äî Compromissos com fam√≠lias
   ============================================================ */
model Agendamento {
  id          String   @id @default(uuid())
  titulo      String
  data        DateTime
  observacoes String?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  responsavel   User   @relation("AgendamentosDoResponsavel", fields: [responsavelId], references: [id])
  responsavelId String

  caso        Case     @relation(fields: [casoId], references: [id], onDelete: Cascade)
  casoId      String
}

/* ============================================================
   CASE LOG ‚Äî Auditoria do sistema
   ============================================================ */
model CaseLog {
  id          String   @id @default(uuid())
  acao        String       // "MUDANCA_STATUS", "ATRIBUICAO", etc.
  descricao   String       // ex: "Caso alterado de X para Y"
  createdAt   DateTime @default(now())

  caso        Case     @relation(fields: [casoId], references: [id], onDelete: Cascade)
  casoId      String

  autor       User     @relation("LogsDoAutor", fields: [autorId], references: [id])
  autorId     String
}


==================================================
FILE: backend\prisma\seed.ts
==================================================

// backend/prisma/seed.ts
import { PrismaClient } from '@prisma/client'
import { faker } from '@faker-js/faker/locale/pt_BR'
import bcrypt from 'bcryptjs'
import { addMonths, startOfDay, subDays } from 'date-fns'

const prisma = new PrismaClient()

// --- Fun√ß√µes Auxiliares de Gera√ß√£o de Dados ---

function getRandomItem<T>(arr: T[]): T {
  return arr[Math.floor(Math.random() * arr.length)]
}

function generateParecerFinal(motivo: string, nome: string): string {
  switch (motivo) {
    case 'Mudan√ßa de territ√≥rio':
      return `A fam√≠lia/indiv√≠duo, Sr(a). ${nome}, informou mudan√ßa de endere√ßo para outra regional administrativa. O caso est√° sendo encaminhado via SEI para o CREAS de refer√™ncia do novo territ√≥rio. N√£o h√° mais pend√™ncias nesta unidade.`
    case 'Falecimento':
      return `Recebida comunica√ß√£o de falecimento do(a) usu√°rio(a) Sr(a). ${nome}, confirmado por documenta√ß√£o (certid√£o de √≥bito anexa ao processo). O acompanhamento do n√∫cleo familiar restante, se necess√°rio, ser√° avaliado em novo registro.`
    case 'Recusa de atendimento':
      return `Ap√≥s m√∫ltiplas tentativas de contato (TC) e visita domiciliar (VD), o(a) usu√°rio(a) ${nome} recusou formalmente o acompanhamento ofertado pela equipe, assinando o termo de recusa. O caso ser√° encerrado por desejo do utilizador, que foi orientado sobre os servi√ßos.`
    case 'Viola√ß√£o cessada':
      return `O acompanhamento foi conclu√≠do com sucesso. As viola√ß√µes de direito identificadas no in√≠cio do atendimento foram cessadas e os objetivos do PAF foram alcan√ßados. A fam√≠lia (Sr(a). ${nome}) demonstrou fortalecimento dos v√≠nculos e supera√ß√£o da situa√ß√£o de vulnerabilidade.`
    case 'Contrareferenciamento':
      return `Caso contrareferenciado para o CRAS de origem (${getRandomItem(['CRAS Brazl√¢ndia', 'CRAS Incra'])}) para acompanhamento no PAIF, visto que as demandas de prote√ß√£o especial foram superadas e a fam√≠lia se enquadra no perfil de Prote√ß√£o B√°sica.`
    case 'N√£o localizado':
      return `Realizadas 3 (tr√™s) tentativas de visita domiciliar em dias e hor√°rios alternados e m√∫ltiplos contatos telef√¥nicos sem sucesso. O(A) usu√°rio(a) ${nome} n√£o foi localizado no endere√ßo fornecido e n√£o h√° novos contatos. Esgotadas as possibilidades de busca ativa no territ√≥rio.`
    case 'Acolhimento':
      return `O(A) usu√°rio(a) ${nome} foi encaminhado(a) e recebido(a) em servi√ßo de acolhimento institucional em ${faker.date.recent({ days: 10 }).toLocaleDateString('pt-BR')}. O acompanhamento ser√° continuado pela equipe do servi√ßo de acolhimento.`
    default:
      return 'Desligamento realizado conforme parecer t√©cnico detalhado em evolu√ß√µes anteriores.'
  }
}

function generateRealisticPaf(violacao: string, categoria: string): { diagnostico: string, objetivos: string, estrategias: string } {
  const diagnostico = `N√∫cleo familiar apresenta vulnerabilidade social e relacional, agravada pela situa√ß√£o de ${violacao.toLowerCase()}. Observa-se fragilidade nos v√≠nculos familiares e comunit√°rios, impactando o(a) ${categoria.toLowerCase()}.`
  
  const objetivos = `1. Supera√ß√£o da situa√ß√£o de ${violacao.toLowerCase()}.\n2. Fortalecimento da fun√ß√£o protetiva da fam√≠lia.\n3. Promo√ß√£o de acesso a outros servi√ßos e benef√≠cios socioassistenciais.`
  
  const estrategias = `1. Realiza√ß√£o de atendimentos psicossociais individualizados e familiares.\n2. Visitas domiciliares para monitoramento e orienta√ß√£o.\n3. Articula√ß√£o com a rede (Sa√∫de, Educa√ß√£o, Conselho Tutelar) para a√ß√µes integradas.`

  return { diagnostico, objetivos, estrategias }
}

function generateObservacoes(orgao: string, violacao: string, categoria: string): string {
  const obs = [
    `Caso encaminhado via SEI pelo(a) ${orgao}. Demanda inicial: ${violacao.toLowerCase()}.`,
    `Usu√°rio(a) compareceu por demanda espont√¢nea, relatando ${violacao.toLowerCase()}. Perfil: ${categoria.toLowerCase()}.`,
    `Recebido of√≠cio do ${orgao} solicitando acompanhamento para o(a) usu√°rio(a) da categoria ${categoria.toLowerCase()}.`,
  ]
  return getRandomItem(obs)
}

// --- Textos para Evolu√ß√µes (Novidade) ---
const textosEvolucao = [
  "Realizado atendimento individualizado na unidade. Usu√°rio compareceu e relatou melhoria na conviv√™ncia familiar.",
  "Visita domiciliar realizada. Fam√≠lia receptiva, por√©m mant√©m-se a situa√ß√£o de vulnerabilidade habitacional.",
  "Contato telef√¥nico com a rede de sa√∫de para verificar agendamento de consulta. Confirmado para a pr√≥xima semana.",
  "Realizada escuta especializada. Identificada necessidade de encaminhamento para o CRAS.",
  "Participa√ß√£o em reuni√£o de rede com o Conselho Tutelar para discuss√£o do caso.",
  "Usu√°rio n√£o compareceu ao atendimento agendado. Realizado contato para reagendamento.",
  "Entrega de benef√≠cios eventuais (cesta b√°sica) e orienta√ß√£o sobre o uso.",
  "Atendimento psicossocial realizado. Trabalhado o fortalecimento de v√≠nculos e autonomia."
]

// --- Listas de Op√ß√µes ---
const urgencias = [
  'Convive com agressor', 'Idoso 80+', 'Primeira inf√¢ncia', 'Risco de morte',
  'Risco de reincid√™ncia', 'Sofre amea√ßa', 'Risco de desabrigo', 'Crian√ßa/Adolescente',
  'PCD', 'Idoso', 'Interna√ß√£o', 'Acolhimento', 'Gestante/Lactante', 'Sem risco imediato',
  'Visita peri√≥dica',
]
const violacoes = [
  'Abandono', 'Neglig√™ncia', 'Afastamento do conv√≠vio familiar', 'Cumprimento de medidas socioeducativas',
  'Descumprimento de condicionalidade do PBF', 'Discrimina√ß√£o', 'Situa√ß√£o de rua', 'Trabalho infantil',
  'Viol√™ncia f√≠sica e/ou psicol√≥gica', 'Viol√™ncia sexual', 'Outros',
]
const categorias = [
  'Mulher', 'POP RUA', 'LGBTQIA+', 'Migrante', 'Idoso', 'Crian√ßa/adolescente',
  'PCD', '√Ålcool/drogas',
]
const statusPossiveis = [
  'AGUARDANDO_ACOLHIDA', 'EM_ACOLHIDA', 'AGUARDANDO_DISTRIBUICAO_PAEFI',
  'EM_ACOMPANHAMENTO_PAEFI', 'DESLIGADO',
]
const beneficiosList = [
  'BPC', 'Bolsa Fam√≠lia', 'Prato Cheio', 'Vulnerabilidade', 'Excepcional', 'Calamidade',
]
const motivosDesligamento = [
  'Mudan√ßa de territ√≥rio', 'Falecimento', 'Recusa de atendimento', 
  'Viola√ß√£o cessada', 'Contrareferenciamento', 'N√£o localizado', 'Acolhimento',
]
const titulosAgendamento = [
  'Visita Domiciliar', 'Atendimento Individualizado', 'Escuta Especializada', 'Reuni√£o de Rede (Sa√∫de)', 'Acompanhamento Telef√¥nico'
]

// --- Fun√ß√£o Principal de Povoamento ---
async function main() {
  console.log('‚úÖ A iniciar o povoamento da base de dados...')

  console.log('üßπ A limpar tabelas existentes...')
  await prisma.agendamento.deleteMany()
  await prisma.paf.deleteMany()
  await prisma.evolucao.deleteMany()
  await prisma.case.deleteMany()
  await prisma.user.deleteMany()
  console.log('üßº Tabelas limpas com sucesso.')

  console.log('üë§ A criar utilizadores...')
  const hashedPassword = await bcrypt.hash('senha-segura-123', 8)

  const gerente = await prisma.user.create({
    data: {
      nome: 'Gerente CREAS',
      email: 'gerente@creas.com',
      senha: hashedPassword,
      cargo: 'Gerente',
      ativo: true,
    },
  })

  const agentesSociais = await Promise.all(
    Array.from({ length: 3 }).map((_, i) =>
      prisma.user.create({
        data: {
          nome: `Agente Social ${i + 1}`,
          email: `agente${i + 1}@creas.com`,
          senha: hashedPassword,
          cargo: 'Agente Social',
          ativo: true,
        },
      }),
    ),
  )

  const especialistas = await Promise.all(
    Array.from({ length: 4 }).map((_, i) =>
      prisma.user.create({
        data: {
          nome: `Especialista ${i + 1}`,
          email: `especialista${i + 1}@creas.com`,
          senha: hashedPassword,
          cargo: 'Especialista',
          ativo: true,
        },
      }),
    ),
  )
  console.log('üë• Utilizadores (1 Gerente, 3 Agentes, 4 Especialistas) criados com sucesso!')

  const createdCases = []
  console.log('üìÇ A criar 80 casos simulados...')
  
  for (let i = 0; i < 80; i++) {
    const status = getRandomItem(statusPossiveis)
    const agenteAcolhida = getRandomItem(agentesSociais)
    const nomeCompleto = faker.person.fullName()
    const violacao = getRandomItem(violacoes)
    const categoria = getRandomItem(categorias)
    const orgaoDemandante = getRandomItem(['CRAS', 'Conselho Tutelar', 'Sa√∫de', 'Demanda Espont√¢nea'])
    
    let especialistaPAEFI = null
    let dataInicioPAEFI: Date | null = null
    let dataDesligamento: Date | null = null
    let motivoDesligamento: string | null = null
    let parecerFinal: string | null = null
    let pafData = undefined

    const beneficios = faker.helpers.arrayElements(beneficiosList, { min: 0, max: 2 })

    if (['EM_ACOMPANHAMENTO_PAEFI', 'DESLIGADO'].includes(status)) {
      especialistaPAEFI = getRandomItem(especialistas)
      dataInicioPAEFI = faker.date.past({ years: 1 })
      
      const { diagnostico, objetivos, estrategias } = generateRealisticPaf(violacao, categoria)
      
      pafData = {
        create: {
          diagnostico,
          objetivos,
          estrategias,
          deadline: (i % 10 === 0) 
            ? faker.date.future({ days: 7, refDate: startOfDay(new Date()) }) 
            : addMonths(dataInicioPAEFI, getRandomItem([3, 6, 12])),
          autorId: especialistaPAEFI.id,
        }
      }
    }
    
    if (status === 'DESLIGADO') {
      dataDesligamento = faker.date.recent({ days: 30 })
      motivoDesligamento = getRandomItem(motivosDesligamento)
      parecerFinal = generateParecerFinal(motivoDesligamento, nomeCompleto)
    }
    
    const newCase = await prisma.case.create({
      data: {
        nomeCompleto,
        cpf: faker.string.numeric(11),
        nascimento: faker.date.birthdate({ min: 18, max: 70, mode: 'age' }),
        sexo: getRandomItem(['Masculino', 'Feminino']),
        telefone: faker.phone.number('619########'),
        endereco: faker.location.streetAddress({ useFullAddress: true }),
        dataEntrada: faker.date.past({ years: 2 }),
        urgencia: getRandomItem(urgencias),
        violacao,
        categoria,
        orgaoDemandante,
        numeroSei: `${faker.string.numeric(5)}-${faker.string.numeric(8)}/${faker.string.numeric(4)}-${faker.string.numeric(2)}`,
        observacoes: generateObservacoes(orgaoDemandante, violacao, categoria),
        status,
        criadoPorId: gerente.id,
        agenteAcolhidaId: agenteAcolhida.id,
        especialistaPAEFIId: especialistaPAEFI?.id,
        dataInicioPAEFI,
        dataDesligamento,
        beneficios,
        motivoDesligamento,
        parecerFinal,
        paf: pafData,
      },
    })
    createdCases.push(newCase)
  }
  console.log(`üì¶ ${createdCases.length} casos simulados criados.`)

  // --- Cria√ß√£o de Evolu√ß√µes (Hist√≥rico) ---
  console.log('üìù A criar evolu√ß√µes (hist√≥rico) para os casos...')
  let evolutionCount = 0
  
  for (const c of createdCases) {
    // Determina quem pode ter escrito a evolu√ß√£o (Gerente, Agente ou Especialista)
    const possiveisAutores = [gerente]
    if (c.agenteAcolhidaId) possiveisAutores.push(agentesSociais.find(a => a.id === c.agenteAcolhidaId)!)
    if (c.especialistaPAEFIId) possiveisAutores.push(especialistas.find(e => e.id === c.especialistaPAEFIId)!)

    // Cria entre 1 e 5 evolu√ß√µes para cada caso
    const numEvolucoes = faker.number.int({ min: 1, max: 5 })
    
    for (let j = 0; j < numEvolucoes; j++) {
      // Data da evolu√ß√£o: aleat√≥ria entre a entrada e hoje (ou data de desligamento)
      const dataMax = c.dataDesligamento || new Date()
      const dataEvolucao = faker.date.between({ from: c.dataEntrada, to: dataMax })
      
      const autor = getRandomItem(possiveisAutores)

      await prisma.evolucao.create({
        data: {
          conteudo: getRandomItem(textosEvolucao), // Usa os textos predefinidos
          createdAt: dataEvolucao,
          casoId: c.id,
          autorId: autor.id,
        }
      })
      evolutionCount++
    }
  }
  console.log(`üìù ${evolutionCount} evolu√ß√µes registradas com sucesso!`)

 // --- Cria√ß√£o de Agendamentos (T√âCNICOS) ---
  console.log('üóìÔ∏è A criar agendamentos simulados...')
  let agendamentoCount = 0
  const activeCases = createdCases.filter(c => 
    c.status === 'EM_ACOLHIDA' || c.status === 'EM_ACOMPANHAMENTO_PAEFI'
  )

  for (const c of activeCases) {
    let responsavelId = null
    if (c.status === 'EM_ACOLHIDA' && c.agenteAcolhidaId) {
      responsavelId = c.agenteAcolhidaId
    } else if (c.status === 'EM_ACOMPANHAMENTO_PAEFI' && c.especialistaPAEFIId) {
      responsavelId = c.especialistaPAEFIId
    }

    if (responsavelId) {
      const numAgendamentos = getRandomItem([1, 2])
      for (let j = 0; j < numAgendamentos; j++) {
        await prisma.agendamento.create({
          data: {
            titulo: getRandomItem(titulosAgendamento),
            data: faker.date.future({ days: 30 }),
            casoId: c.id,
            responsavelId: responsavelId,
          },
        })
        agendamentoCount++
      }
    }
  }

  // --- [NOVO] Cria√ß√£o de Agendamentos para o GERENTE (Para voc√™ ver no dashboard) ---
  const casosDoGerente = createdCases.slice(0, 3); // Pega 3 casos quaisquer
  for (const c of casosDoGerente) {
     await prisma.agendamento.create({
        data: {
          titulo: "Supervis√£o de Caso (Teste)",
          data: faker.date.soon({ days: 7 }), // Pr√≥ximos 7 dias
          casoId: c.id,
          responsavelId: gerente.id, // Atribui ao GERENTE
          observacoes: "Reuni√£o de alinhamento criada pelo seed."
        }
     });
     agendamentoCount++;
  }

  console.log(`üìÖ ${agendamentoCount} agendamentos futuros criados com sucesso!`)
  console.log('üéâ Povoamento da base de dados conclu√≠do.')
}

main()
  .catch((e) => {
    console.error('‚ùå Ocorreu um erro durante o povoamento:', e)
    process.exit(1)
  })
  .finally(async () => {
    await prisma.$disconnect()
  })

==================================================
FILE: backend\src\lib\prisma.ts
==================================================

// backend/src/lib/prisma.ts

// Importa o PrismaClient da biblioteca instalada
import { PrismaClient } from '@prisma/client'; //

// Cria e exporta uma inst√¢ncia √∫nica do PrismaClient.
// Esta abordagem (singleton) garante que a nossa aplica√ß√£o n√£o crie
// m√∫ltiplas conex√µes desnecess√°rias com o banco de dados.
export const prisma = new PrismaClient(); //

==================================================
FILE: backend\src\routes\alerts.ts
==================================================

// backend/src/routes/alerts.ts
import { type FastifyInstance } from 'fastify'
import { z } from 'zod'
import { prisma } from '../lib/prisma' //
import { addDays, startOfDay, endOfDay } from 'date-fns' //

// Define quantos dias antes consideramos "pr√≥ximo do vencimento"
const UPCOMING_DEADLINE_DAYS = 7

export async function alertRoutes(app: FastifyInstance) {
  // Hook de autentica√ß√£o para todas as rotas de alerta
  app.addHook('onRequest', async (request, reply) => {
    try {
      await request.jwtVerify() //
    } catch (err) {
      return reply.status(401).send({ message: 'N√£o autorizado.' })
    }
  })

  /**
   * -----------------------------------------------------------------
   * [GET] /alerts/paf-deadlines - Obter PAFs com prazos pr√≥ximos
   * -----------------------------------------------------------------
   * Retorna uma lista de PAFs associados a casos ativos
   * ('EM_ACOMPANHAMENTO_PAEFI') cujo prazo ('deadline') est√°
   * entre hoje e os pr√≥ximos 'UPCOMING_DEADLINE_DAYS'.
   *
   * - Especialistas veem apenas os alertas dos seus casos.
   * - Gerentes veem todos os alertas.
   * - Agentes Sociais n√£o veem alertas de PAF.
   */
  app.get('/alerts/paf-deadlines', async (request, reply) => {
    const { sub: userId, cargo } = request.user as { sub: string; cargo: string } //

    // Agentes n√£o t√™m acesso a esta informa√ß√£o
    if (cargo === 'Agente Social') {
      return reply.status(200).send([])
    }

    try {
      const today = startOfDay(new Date())
      const cutoffDate = endOfDay(addDays(today, UPCOMING_DEADLINE_DAYS))

      // Monta a cl√°usula 'where' baseada no cargo
      const whereClause: any = {
        // Filtra pelo campo 'deadline' (DateTime)
        deadline: {
          gte: today,
          lte: cutoffDate,
        },
        // Usa a rela√ß√£o 'caso' (min√∫sculo)
        caso: {
          status: 'EM_ACOMPANHAMENTO_PAEFI', //
        },
      }

      // Se for um Especialista, filtra apenas pelos seus casos
      if (cargo === 'Especialista') {
        whereClause.caso.especialistaPAEFIId = userId //
      }

      // Busca os PAFs que atendem aos crit√©rios
      const upcomingPAFs = await prisma.paf.findMany({
        where: whereClause,
        orderBy: {
          deadline: 'asc', // Ordena pelo campo 'deadline'
        },
        select: {
          id: true,
          deadline: true,
          objetivos: true,
          caso: { // Usa a rela√ß√£o 'caso'
            select: {
              id: true,
              nomeCompleto: true, //
              especialistaPAEFI: { //
                select: {
                  nome: true, //
                },
              },
            },
          },
        },
      })

      // Formata a resposta
      const formattedAlerts = upcomingPAFs.map((paf) => ({
        pafId: paf.id,
        deadline: paf.deadline,
        caseId: paf.caso.id,
        caseName: paf.caso.nomeCompleto,
        specialistName: paf.caso.especialistaPAEFI?.nome ?? 'N√£o atribu√≠do',
        objetivosResumo:
          paf.objetivos?.length > 100
            ? paf.objetivos.substring(0, 100) + '...'
            : paf.objetivos ?? '',
      }))

      return reply.status(200).send(formattedAlerts)
    } catch (error) {
      console.error('Erro ao buscar alertas de prazo do PAF:', error)
      return reply.status(500).send({ message: 'Erro interno ao buscar alertas.' })
    }
  })

  // Outras rotas de alerta (ex: /alerts/stale-cases) podem ser adicionadas aqui
}

==================================================
FILE: backend\src\routes\appointments.ts
==================================================

// backend/src/routes/appointments.ts
import { type FastifyInstance } from 'fastify'
import { z } from 'zod'
import { prisma } from '../lib/prisma' //
import { startOfMonth, endOfMonth, parseISO } from 'date-fns' //

export async function appointmentRoutes(app: FastifyInstance) { //
  // Protege todas as rotas de agendamento
  app.addHook('onRequest', async (request, reply) => { //
    try {
      await request.jwtVerify() //
    } catch (err) { //
      await reply.status(401).send({ message: 'N√£o autorizado.' }) //
    }
  })

  /**
   * -----------------------------------------------------------------
   * [GET] /appointments - Buscar agendamentos (Para a Agenda)
   * -----------------------------------------------------------------
   * Busca agendamentos com base em filtros.
   * Usado pela p√°gina 'Agenda.tsx' para popular o calend√°rio.
   *
   * Query Params:
   * - month (obrigat√≥rio): M√™s no formato 'yyyy-MM'.
   * - userId (opcional): Filtra por um t√©cnico espec√≠fico (s√≥ para Gerente).
   */
  app.get('/appointments', async (request, reply) => {
    const { sub: userId, cargo } = request.user as {
      sub: string
      cargo: string
    }

    const querySchema = z.object({
      month: z.string().regex(/^\d{4}-\d{2}$/, 'Formato de m√™s inv√°lido. Use YYYY-MM.'),
      userId: z.string().uuid().optional(),
    })

    try {
      const { month, userId: queryUserId } = querySchema.parse(request.query)

      // Calcula o in√≠cio e o fim do m√™s solicitado
      const firstDay = startOfMonth(parseISO(month))
      const lastDay = endOfMonth(parseISO(month))

      const whereClause: any = {
        data: {
          gte: firstDay,
          lte: lastDay,
        },
      }

      // L√≥gica de permiss√£o
      if (cargo === 'Gerente') {
        // Gerente pode ver agendamentos de um usu√°rio espec√≠fico
        if (queryUserId) {
          whereClause.responsavelId = queryUserId
        }
        // Se queryUserId n√£o for fornecido, o Gerente v√™ os de TODOS.
      } else {
        // Agente Social e Especialista s√≥ podem ver os seus pr√≥prios agendamentos.
        whereClause.responsavelId = userId
      }

      const appointments = await prisma.agendamento.findMany({ //
        where: whereClause,
        orderBy: {
          data: 'asc',
        },
        include: {
          caso: {
            select: {
              id: true,
              nomeCompleto: true,
            },
          },
          responsavel: {
            select: {
              nome: true,
            },
          },
        },
      })

      return reply.status(200).send(appointments)
    } catch (error) {
      if (error instanceof z.ZodError) {
        return reply.status(400).send({ message: 'Dados inv√°lidos.', errors: error.flatten() })
      }
      console.error('Erro ao buscar agendamentos:', error)
      return reply.status(500).send({ message: 'Erro interno no servidor.' })
    }
  })

  /**
   * -----------------------------------------------------------------
   * [GET] /cases/:caseId/appointments - Buscar agendamentos de UM CASO
   * -----------------------------------------------------------------
   * (Esta rota j√° existia no seu arquivo)
   */
  app.get('/cases/:caseId/appointments', async (request, reply) => { //
    const paramsSchema = z.object({ caseId: z.string().uuid() }) //

    try {
      const { caseId } = paramsSchema.parse(request.params) //

      const appointments = await prisma.agendamento.findMany({ //
        where: { casoId: caseId }, //
        orderBy: { data: 'desc' }, //
        include: {
          responsavel: { select: { id: true, nome: true } }, //
        },
      })
      return reply.status(200).send(appointments) //
    } catch (error) {
      request.log.error(error, 'Erro ao buscar agendamentos do caso') //
      return reply
        .status(500)
        .send({ message: 'Erro interno ao buscar agendamentos do caso.' }) //
    }
  })

  /**
   * -----------------------------------------------------------------
   * [POST] /appointments - Criar novo agendamento
   * -----------------------------------------------------------------
   * (Esta rota j√° existia e foi corrigida para o novo schema)
   */
  app.post('/appointments', async (request, reply) => { //
    const { sub: userId } = request.user as { sub: string }

    const createAppointmentSchema = z.object({ //
      titulo: z.string().min(3, 'O t√≠tulo √© muito curto.'), //
      data: z.string().min(1, 'A data √© obrigat√≥ria.'), //
      time: z.string().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/, 'Hora inv√°lida.'), //
      casoId: z.string().uuid('Selecione um caso.'), //
      observacoes: z.string().optional(),
    })

    try {
      const { titulo, data, time, casoId, observacoes } =
        createAppointmentSchema.parse(request.body)

      // Combina a data (yyyy-MM-dd) e a hora (HH:mm) em um objeto Date completo
      const dataHoraISO = `${data}T${time}:00.000`

      const newAppointment = await prisma.agendamento.create({ //
        data: {
          titulo,
          data: new Date(dataHoraISO), // Salva o DateTime completo
          observacoes,
          casoId, // Campo agora existe no schema
          responsavelId: userId, // Campo agora existe no schema
        },
      })

      return reply.status(201).send(newAppointment)
    } catch (error) {
      if (error instanceof z.ZodError) {
        return reply.status(400).send({ message: 'Dados inv√°lidos.', errors: error.flatten() })
      }
      console.error('Erro ao criar agendamento:', error)
      return reply.status(500).send({ message: 'Erro interno no servidor.' })
    }
  })
}

==================================================
FILE: backend\src\routes\auth.ts
==================================================

// backend/src/routes/auth.ts
import { type FastifyInstance } from 'fastify'
import { z } from 'zod'
import { prisma } from '../lib/prisma' //
import bcrypt from 'bcryptjs' //

export async function authRoutes(app: FastifyInstance) {
  // Rota de Registo de Utilizador (voc√™ tinha, mantemos)
  app.post('/register', async (request, reply) => { //
    const registerBodySchema = z.object({
      nome: z.string(),
      email: z.string().email(),
      senha: z.string().min(6),
      cargo: z.enum(['Gerente', 'Agente Social', 'Especialista']), //
    })

    try {
      const { nome, email, senha, cargo } = registerBodySchema.parse(
        request.body,
      )

      const userExists = await prisma.user.findUnique({ where: { email } }) //
      if (userExists) {
        return await reply.status(409).send({ message: 'Email j√° registado.' })
      }

      const hashedPassword = await bcrypt.hash(senha, 8) //

      const user = await prisma.user.create({
        data: {
          nome,
          email,
          senha: hashedPassword,
          cargo,
          ativo: true, // Garante que o usu√°rio registrado seja ativo
        },
      })

      return await reply.status(201).send({ //
        message: 'Utilizador criado com sucesso!',
        user: { id: user.id, nome: user.nome, email: user.email },
      })
    } catch (error) {
      request.log.error(error, 'Erro ao registar utilizador') //
      return await reply
        .status(500)
        .send({ message: 'Erro interno do servidor.' })
    }
  })

  // Rota de Login
  app.post('/login', async (request, reply) => { //
    const loginBodySchema = z.object({
      email: z.string().email('Email inv√°lido.'),
      senha: z.string().min(6, 'A senha deve ter no m√≠nimo 6 caracteres.'), //
    })

    try {
      const { email, senha } = loginBodySchema.parse(request.body)
      const user = await prisma.user.findUnique({ where: { email } }) //

      if (!user) {
        return await reply
          .status(401)
          .send({ message: 'Credenciais inv√°lidas.' }) //
      }

      // Adiciona verifica√ß√£o de usu√°rio 'ativo'
      if (!user.ativo) {
        return await reply
          .status(403) // Forbidden
          .send({ message: 'Este usu√°rio est√° desativado.' })
      }

      const isPasswordCorrect = await bcrypt.compare(senha, user.senha) //

      if (!isPasswordCorrect) {
        return await reply
          .status(401)
          .send({ message: 'Credenciais inv√°lidas.' }) //
      }

      const token = app.jwt.sign(
        {
          // Payload (informa√ß√µes dentro do token)
          nome: user.nome, //
          cargo: user.cargo, //
        },
        {
          // Metadados (informa√ß√µes sobre o token)
          sub: user.id, // 'sub' (subject) √© o ID do usu√°rio
          expiresIn: '7d', // Token expira em 7 dias
        },
      )

      return await reply.status(200).send({ token }) //
    } catch (error) {
      request.log.error(error, 'Erro no processo de login') //
      return await reply
        .status(500)
        .send({ message: 'Ocorreu um erro inesperado no servidor.' })
    }
  })

  // Rota para buscar dados do utilizador logado
  app.get(
    '/me',
    { onRequest: [app.authenticate] },
    async (request, reply) => { //
      const userId = request.user.sub //

      const user = await prisma.user.findUnique({
        where: { id: userId, ativo: true }, // Garante que o usu√°rio ainda est√° ativo
        select: {
          id: true, //
          nome: true, //
          email: true, //
          cargo: true, //
        },
      })

      if (!user) {
        return await reply.status(404).send({ message: 'Utilizador n√£o encontrado.' }) //
      }

      return await reply.status(200).send(user) //
    },
  )
}

==================================================
FILE: backend\src\routes\cases.ts
==================================================

// backend/src/routes/cases.ts ‚Äî Arquivo contendo todas as rotas relacionadas √† gest√£o de casos (CRUD, atribui√ß√µes, desligamentos, logs e exporta√ß√µes CSV).

import { type FastifyInstance, type FastifyReply } from 'fastify'
import { z } from 'zod'
import { prisma } from '../lib/prisma'
import { format as formatCsv } from 'fast-csv'
import { format } from 'date-fns'
import { ptBR } from 'date-fns/locale'

// -------------------------------------------------------
// üîß UTILIT√ÅRIOS
// -------------------------------------------------------

/** Formata datas para CSV ou retorna 'N/A'. */
const formatDateForCsv = (date: Date | null | undefined): string => {
  return date && !isNaN(date.getTime())
    ? format(date, 'dd/MM/yyyy', { locale: ptBR })
    : 'N/A'
}

/** Padroniza resposta de erro interno. */
function internalError(reply: FastifyReply, message: string, error: unknown) {
  console.error(message, error)
  return reply.status(500).send({ message })
}

/** Filtros para casos ativos conforme o cargo do usu√°rio. */
function buildActiveCaseWhereClause(user: { cargo: string; sub: string }) {
  switch (user.cargo) {
    case 'Agente Social':
      return {
        agenteAcolhidaId: user.sub,
        status: { in: ['AGUARDANDO_ACOLHIDA', 'EM_ACOLHIDA'] }
      }
    case 'Especialista':
      return {
        especialistaPAEFIId: user.sub,
        status: 'EM_ACOMPANHAMENTO_PAEFI'
      }
    case 'Gerente':
      return { status: 'AGUARDANDO_DISTRIBUICAO_PAEFI' }
    default:
      return { id: '-1' }
  }
}

/** Filtros para casos fechados. */
function buildClosedCaseWhereClause(user: { cargo: string; sub: string }) {
  const where: any = { status: 'DESLIGADO' }
  if (user.cargo === 'Agente Social') where.agenteAcolhidaId = user.sub
  if (user.cargo === 'Especialista') where.especialistaPAEFIId = user.sub
  return where
}

/** Cria√ß√£o de logs internos. */
async function createLog(casoId: string, autorId: string, acao: string, descricao: string) {
  await prisma.caseLog.create({
    data: { casoId, autorId, acao, descricao },
  })
}

// -------------------------------------------------------
// üöÄ ROTAS
// -------------------------------------------------------

export async function caseRoutes(app: FastifyInstance) {

  // -----------------------------------------------------
  // 1. Criar Caso
  // -----------------------------------------------------
  app.post('/cases', { onRequest: [app.authenticate] }, async (request, reply) => {
    const schema = z.object({
      nomeCompleto: z.string(),
      cpf: z.string().length(11),
      nascimento: z.coerce.date(),
      sexo: z.string(),
      telefone: z.string(),
      endereco: z.string(),
      dataEntrada: z.coerce.date(),
      urgencia: z.string(),
      violacao: z.string(),
      categoria: z.string(),
      orgaoDemandante: z.string(),
      numeroSei: z.string().optional(),
      linkSei: z.string().url().optional().or(z.literal('')),
      agenteAcolhidaId: z.string().uuid(),
      observacoes: z.string().optional(),
      beneficios: z.array(z.string()).optional(),
    })

    try {
      const data = schema.parse(request.body)
      const userId = request.user.sub

      const novoCaso = await prisma.case.create({
        data: {
          ...data,
          criadoPorId: userId,
          numeroSei: data.numeroSei || null,
          linkSei: data.linkSei || null,
          observacoes: data.observacoes || null,
          beneficios: data.beneficios || [],
        },
      })

      await createLog(novoCaso.id, userId, 'CRIACAO', 'Caso cadastrado no sistema.')

      return reply.status(201).send(novoCaso)
    } catch (error) {
      if (error instanceof z.ZodError) {
        return reply.status(400).send({ message: 'Dados inv√°lidos.', errors: error.flatten().fieldErrors })
      }
      return internalError(reply, 'Erro interno ao criar caso.', error)
    }
  })

  // -----------------------------------------------------
  // 2. Listar Casos Ativos
  // -----------------------------------------------------
  app.get('/cases', { onRequest: [app.authenticate] }, async (request, reply) => {
    const schema = z.object({
      search: z.string().optional(),
      page: z.coerce.number().min(1).default(1),
      pageSize: z.coerce.number().min(1).max(100).default(10),
      status: z.string().optional(),
      urgencia: z.string().optional(),
      violacao: z.string().optional(),
    })

    try {
      const { search, page, pageSize, status, urgencia, violacao } = schema.parse(request.query)
      let where = buildActiveCaseWhereClause(request.user) as any

      if (search) {
        where.AND = [
          ...(where.AND || []),
          {
            OR: [
              { nomeCompleto: { contains: search, mode: 'insensitive' } },
              { cpf: { contains: search } },
            ],
          },
        ]
      }

      if (status && status !== 'all') where.status = status
      if (urgencia && urgencia !== 'all') where.urgencia = urgencia
      if (violacao && violacao !== 'all') where.violacao = { contains: violacao }

      const [items, total] = await Promise.all([
        prisma.case.findMany({
          where,
          orderBy: { createdAt: 'desc' },
          take: pageSize,
          skip: (page - 1) * pageSize,
          include: {
            agenteAcolhida: { select: { nome: true } },
            especialistaPAEFI: { select: { nome: true } },
          },
        }),
        prisma.case.count({ where }),
      ])

      return reply.send({
        items,
        total,
        page,
        pageSize,
        totalPages: Math.ceil(total / pageSize),
      })
    } catch (error) {
      return internalError(reply, 'Erro interno ao listar casos ativos.', error)
    }
  })

  // -----------------------------------------------------
  // 3. Listar Casos Fechados
  // -----------------------------------------------------
  app.get('/cases/closed', { onRequest: [app.authenticate] }, async (request, reply) => {
    const schema = z.object({
      search: z.string().optional(),
      page: z.coerce.number().min(1).default(1),
      pageSize: z.coerce.number().min(1).max(100).default(10),
    })

    try {
      const { search, page, pageSize } = schema.parse(request.query)
      let where = buildClosedCaseWhereClause(request.user)

      if (search) {
        where.OR = [
          { nomeCompleto: { contains: search, mode: 'insensitive' } },
          { cpf: { contains: search } },
        ]
      }

      const [items, total] = await Promise.all([
        prisma.case.findMany({
          where,
          orderBy: { dataDesligamento: 'desc' },
          take: pageSize,
          skip: (page - 1) * pageSize,
          select: {
            id: true,
            nomeCompleto: true,
            cpf: true,
            status: true,
            dataDesligamento: true,
            parecerFinal: true,
            agenteAcolhida: { select: { nome: true } },
            especialistaPAEFI: { select: { nome: true } },
          },
        }),
        prisma.case.count({ where }),
      ])

      return reply.send({
        items,
        total,
        page,
        pageSize,
        totalPages: Math.ceil(total / pageSize),
      })
    } catch (error) {
      return internalError(reply, 'Erro interno ao listar casos finalizados.', error)
    }
  })

  // -----------------------------------------------------
  // 4. Detalhes do Caso
  // -----------------------------------------------------
  app.get('/cases/:id', { onRequest: [app.authenticate] }, async (request, reply) => {
    try {
      const { id } = z.object({ id: z.string().uuid() }).parse(request.params)

      const caso = await prisma.case.findUnique({
        where: { id },
        include: {
          criadoPor: { select: { nome: true } },
          agenteAcolhida: { select: { id: true, nome: true } },
          especialistaPAEFI: { select: { id: true, nome: true } },
          logs: {
            orderBy: { createdAt: 'desc' },
            take: 20,
            include: { autor: { select: { nome: true } } },
          },
        },
      })

      if (!caso) return reply.status(404).send({ message: 'Caso n√£o encontrado.' })

      return reply.send(caso)
    } catch (error) {
      return internalError(reply, 'Erro ao buscar detalhes do caso.', error)
    }
  })

  // -----------------------------------------------------
  // 5. Atualizar Status
  // -----------------------------------------------------
  app.patch('/cases/:id/status', { onRequest: [app.authenticate] }, async (request, reply) => {
    const paramsSchema = z.object({ id: z.string().uuid() })
    const bodySchema = z.object({
      status: z.enum([
        'AGUARDANDO_ACOLHIDA',
        'EM_ACOLHIDA',
        'AGUARDANDO_DISTRIBUICAO_PAEFI',
        'EM_ACOMPANHAMENTO_PAEFI',
        'DESLIGADO',
      ]),
    })

    try {
      const { id } = paramsSchema.parse(request.params)
      const { status } = bodySchema.parse(request.body)
      const { sub: userId, cargo } = request.user

      const caso = await prisma.case.findUnique({ where: { id } })
      if (!caso) return reply.status(404).send({ message: 'Caso n√£o encontrado.' })

      const isManager = cargo === 'Gerente'
      const isAgent = caso.agenteAcolhidaId === userId
      const isSpec = caso.especialistaPAEFIId === userId

      if (caso.status === 'DESLIGADO' && status !== 'DESLIGADO' && !isManager) {
        return reply.status(403).send({ message: 'Apenas gerentes podem reabrir um caso.' })
      }

      if (!isManager && !isAgent && !isSpec) {
        return reply.status(403).send({ message: 'Sem permiss√£o para alterar este caso.' })
      }

      const oldStatus = caso.status
      let updateData: any = { status }

      if (oldStatus === 'DESLIGADO' && status !== 'DESLIGADO') {
        updateData = {
          status: 'AGUARDANDO_ACOLHIDA',
          motivoDesligamento: null,
          dataDesligamento: null,
          parecerFinal: null,
        }
      }

      const updated = await prisma.case.update({ where: { id }, data: updateData })

      if (oldStatus !== status) {
        await createLog(id, userId, 'MUDANCA_STATUS', `Alterou o status de ${oldStatus} para ${status}`)
      } else {
        await createLog(id, userId, 'MUDANCA_STATUS', `Reabriu o caso (status reiniciado).`)
      }

      return reply.send(updated)
    } catch (error) {
      return internalError(reply, 'Erro ao alterar status.', error)
    }
  })

  // -----------------------------------------------------
  // 6. Atribuir Especialista ao Caso
  // -----------------------------------------------------
  app.patch('/cases/:id/assign', { onRequest: [app.authenticate] }, async (request, reply) => {
    const params = z.object({ id: z.string().uuid() })
    const body = z.object({ specialistId: z.string().uuid() })

    try {
      const { id } = params.parse(request.params)
      const { specialistId } = body.parse(request.body)
      const { cargo, sub: userId } = request.user

      if (cargo !== 'Gerente') {
        return reply.status(403).send({ message: 'Apenas gerentes podem atribuir casos.' })
      }

      const specialist = await prisma.user.findUnique({ where: { id: specialistId } })

      const updatedCase = await prisma.case.update({
        where: { id },
        data: { especialistaPAEFIId: specialistId, status: 'EM_ACOMPANHAMENTO_PAEFI', dataInicioPAEFI: new Date() },
      })

      await createLog(id, userId, 'ATRIBUICAO', `Atribuiu o caso ao especialista ${specialist?.nome || 'Desconhecido'}`)

      return reply.send(updatedCase)
    } catch (error) {
      return internalError(reply, 'Erro ao atribuir especialista.', error)
    }
  })

  // -----------------------------------------------------
  // 7. Desligar Caso
  // -----------------------------------------------------
  app.patch('/cases/:id/close', { onRequest: [app.authenticate] }, async (request, reply) => {
    const params = z.object({ id: z.string().uuid() })
    const body = z.object({
      parecerFinal: z.string().min(10, 'Muito curto.'),
      motivoDesligamento: z.string().min(1, 'Obrigat√≥rio.'),
    })

    try {
      const { id } = params.parse(request.params)
      const { parecerFinal, motivoDesligamento } = body.parse(request.body)
      const { sub: userId, cargo } = request.user

      const caso = await prisma.case.findUnique({ where: { id } })
      if (!caso) return reply.status(404).send({ message: 'Caso n√£o encontrado.' })

      const isManager = cargo === 'Gerente'
      const isAgent = caso.agenteAcolhidaId === userId
      const isSpec = caso.especialistaPAEFIId === userId

      if (!isManager && !isAgent && !isSpec) {
        return reply.status(403).send({ message: 'Sem permiss√£o para esta a√ß√£o.' })
      }

      const updated = await prisma.case.update({
        where: { id },
        data: {
          status: 'DESLIGADO',
          parecerFinal,
          motivoDesligamento,
          dataDesligamento: new Date(),
        },
      })

      await createLog(id, userId, 'DESLIGAMENTO', `Desligou o caso. Motivo: ${motivoDesligamento}`)

      return reply.send(updated)
    } catch (error) {
      return internalError(reply, 'Erro ao desligar caso.', error)
    }
  })

  // -----------------------------------------------------
  // 8. Exporta√ß√£o CSV
  // -----------------------------------------------------
  app.get('/cases/export', { onRequest: [app.authenticate] }, async (request, reply) => {
    if (request.user.cargo !== 'Gerente') {
      return reply.status(403).send({ message: 'Acesso negado.' })
    }

    try {
      const casos = await prisma.case.findMany({
        orderBy: { createdAt: 'desc' },
        include: {
          criadoPor: true,
          agenteAcolhida: true,
          especialistaPAEFI: true,
        },
      })

      reply.header(
        'Content-Disposition',
        `attachment; filename="export_casos_${format(new Date(), 'yyyy-MM-dd')}.csv"`
      )
      reply.type('text/csv; charset=utf-8')

      const csv = formatCsv({ headers: true })
      csv.pipe(reply.raw)

      casos.forEach((c) => {
        csv.write({
          ID: c.id,
          Nome_Completo: c.nomeCompleto,
          CPF: c.cpf,
          Nascimento: formatDateForCsv(c.nascimento),
          Sexo: c.sexo,
          Telefone: c.telefone,
          Endereco: c.endereco,
          Data_Entrada: formatDateForCsv(c.dataEntrada),
          Urgencia: c.urgencia,
          Violacao: c.violacao,
          Categoria: c.categoria,
          Orgao_Demandante: c.orgaoDemandante,
          Numero_SEI: c.numeroSei ?? 'N/A',
          Status: c.status,
          Criado_Por: c.criadoPor?.nome ?? 'Usu√°rio Removido',
          Agente_Acolhida: c.agenteAcolhida?.nome ?? 'N√£o Atribu√≠do',
          Especialista_PAEFI: c.especialistaPAEFI?.nome ?? 'N√£o Atribu√≠do',
          Data_Desligamento: formatDateForCsv(c.dataDesligamento),
          Parecer_Final: c.parecerFinal ?? 'N/A',
        })
      })

      csv.end()
    } catch (error) {
      return internalError(reply, 'Erro ao exportar CSV.', error)
    }
  })
}


==================================================
FILE: backend\src\routes\evolutions.ts
==================================================

// backend/src/routes/evolutions.ts
import { type FastifyInstance } from 'fastify'
import { z } from 'zod'
import { prisma } from '../lib/prisma' //

// O schema do frontend (caseSchemas.ts) envia 'conteudo'
const createEvolutionBodySchema = z.object({ //
  conteudo: z.string().min(10, 'A evolu√ß√£o deve ter no m√≠nimo 10 caracteres.'), //
})

export async function evolutionRoutes(app: FastifyInstance) { //
  // Hook de autentica√ß√£o
  app.addHook('onRequest', async (request, reply) => { //
    try {
      await request.jwtVerify() //
    } catch (err) { //
      return reply.status(401).send({ message: 'N√£o autorizado.' })
    }
  })

  // Rota para buscar evolu√ß√µes de um caso (GET)
  app.get('/cases/:caseId/evolutions', async (request, reply) => {
    const paramsSchema = z.object({ caseId: z.string().uuid() })
    try {
      const { caseId } = paramsSchema.parse(request.params)

      const evolutions = await prisma.evolucao.findMany({
        where: { casoId: caseId }, //
        orderBy: { createdAt: 'desc' },
        include: {
          autor: { select: { id: true, nome: true } }, //
        },
      })
      // O frontend (EvolutionsSection.tsx) espera 'conteudo'
      // O banco (schema.prisma) j√° envia 'conteudo'
      // Nenhuma tradu√ß√£o √© necess√°ria.
      return await reply.status(200).send(evolutions)
    } catch (error) {
      console.error('Erro ao buscar evolu√ß√µes:', error)
      return await reply
        .status(500)
        .send({ message: 'Erro interno ao buscar evolu√ß√µes.' })
    }
  })

  // Rota para criar uma nova evolu√ß√£o (POST)
  app.post('/cases/:caseId/evolutions', async (request, reply) => {
    const paramsSchema = z.object({ caseId: z.string().uuid() })

    try {
      const { caseId } = paramsSchema.parse(request.params)
      // Valida o corpo (JSON) esperando 'conteudo'
      const data = createEvolutionBodySchema.parse(request.body)
      const { sub: autorId, nome: autorNome } = request.user as { sub: string, nome: string } //

      const newEvolution = await prisma.evolucao.create({ //
        data: {
          // O frontend envia 'conteudo' e o banco espera 'conteudo'
          conteudo: data.conteudo, //
          casoId: caseId, //
          autorId: autorId, //
        },
      })
      
      // Retorna a evolu√ß√£o no formato que o frontend espera
      const evolutionForFrontend = {
          id: newEvolution.id,
          createdAt: newEvolution.createdAt,
          conteudo: newEvolution.conteudo,
          autor: { nome: autorNome ?? 'Usu√°rio' } // Adiciona o autor para o cache
      }
      
      return await reply.status(201).send(evolutionForFrontend)

    } catch (error) {
      console.error('!!!!!!!!!! ERRO 500 AO CRIAR EVOLU√á√ÉO !!!!!!!!!!')
      console.error('DADOS RECEBIDOS:', request.body)
      console.error('AUTOR ID:', (request.user as { sub: string }).sub)
      console.error('ERRO COMPLETO:', error)
      
      if (error instanceof z.ZodError) {
        return reply.status(400).send({
          message: 'Dados inv√°lidos.',
          errors: error.flatten().fieldErrors
        })
      }

      return await reply
        .status(500)
        .send({ message: 'Erro interno ao criar evolu√ß√£o.' })
    }
  })
}

==================================================
FILE: backend\src\routes\paf.ts
==================================================

// backend/src/routes/paf.ts
import { type FastifyInstance } from 'fastify'
import { z } from 'zod'
import { prisma } from '../lib/prisma' //

export async function pafRoutes(app: FastifyInstance) { //
  // Rota para buscar o PAF de um caso
  app.get(
    '/cases/:caseId/paf',
    { onRequest: [app.authenticate] }, //
    async (request, reply) => {
      const paramsSchema = z.object({ caseId: z.string().uuid() }) //
      try {
        const { caseId } = paramsSchema.parse(request.params) //
        const paf = await prisma.paf.findUnique({
          where: { casoId: caseId }, //
          include: { autor: { select: { id: true, nome: true } } }, //
        })
        return await reply.status(200).send(paf) //
      } catch (error) {
        request.log.error(error, 'Erro ao buscar PAF.') //
        return await reply
          .status(500)
          .send({ message: 'Erro interno ao buscar PAF.' }) //
      }
    },
  )

  // --- ALTERA√á√ÉO NO SCHEMA DE VALIDA√á√ÉO ---
  // Este schema agora espera 'deadline' (data) em vez de 'prazos' (texto)
  const pafBodySchema = z.object({ //
    diagnostico: z.string().min(10), //
    objetivos: z.string().min(10), //
    estrategias: z.string().min(10), //
    // Trocamos 'prazos: z.string()' por 'deadline: z.coerce.date()'
    deadline: z.coerce.date({
      required_error: 'A data do prazo √© obrigat√≥ria.',
    }),
  })
  // --- FIM DA ALTERA√á√ÉO ---

  // Rota para criar um PAF para um caso
  app.post(
    '/cases/:caseId/paf',
    { onRequest: [app.authenticate] }, //
    async (request, reply) => {
      const paramsSchema = z.object({ caseId: z.string().uuid() }) //
      try {
        const { caseId } = paramsSchema.parse(request.params) //
        const data = pafBodySchema.parse(request.body) //
        const { sub: autorId, cargo } = request.user as { sub: string; cargo: string } //

        if (cargo !== 'Especialista' && cargo !== 'Gerente') { //
          return await reply
            .status(403)
            .send({ message: 'Apenas especialistas podem criar um PAF.' }) //
        }

        const newPaf = await prisma.paf.create({
          data: {
            ...data, // 'data' agora cont√©m 'deadline' em vez de 'prazos'
            casoId: caseId, //
            autorId, //
          },
        })

        return await reply.status(201).send(newPaf) //
      } catch (error) {
        request.log.error(error, 'Erro ao criar PAF.') //
        return await reply
          .status(500)
          .send({ message: 'Erro interno ao criar PAF.' }) //
      }
    },
  )

  // Rota: Atualizar (Editar) um PAF existente
  app.put(
    '/cases/:caseId/paf',
    { onRequest: [app.authenticate] }, //
    async (request, reply) => {
      const paramsSchema = z.object({ caseId: z.string().uuid() }) //

      try {
        const { caseId } = paramsSchema.parse(request.params) //
        // O schema de atualiza√ß√£o agora espera 'deadline' (opcional)
        // .partial() torna todos os campos do schema opcionais
        const data = pafBodySchema.partial().parse(request.body)
        const { sub: userId, cargo } = request.user as { sub: string; cargo: string } //

        const existingPaf = await prisma.paf.findUnique({
          where: { casoId: caseId }, //
        })

        if (!existingPaf) { //
          return await reply.status(404).send({ message: 'PAF n√£o encontrado.' }) //
        }

        if (existingPaf.autorId !== userId && cargo !== 'Gerente') { //
          return await reply.status(403).send({ message: 'Apenas o autor ou um gerente podem editar este PAF.' }) //
        }

        const updatedPaf = await prisma.paf.update({
          where: { casoId: caseId }, //
          data: {
            ...data, // 'data' agora cont√©m 'deadline' (se foi enviado)
            updatedAt: new Date(), //
          },
        })

        return await reply.status(200).send(updatedPaf) //
      } catch (error) {
        request.log.error(error, 'Erro ao atualizar PAF.') //
        return await reply
          .status(500)
          .send({ message: 'Erro interno ao atualizar PAF.' }) //
      }
    },
  )
}

==================================================
FILE: backend\src\routes\reports.ts
==================================================

// backend/src/routes/reports.ts
import { type FastifyInstance } from 'fastify'
import { z } from 'zod'
import { prisma } from '../lib/prisma' //
import { startOfMonth, endOfMonth, subMonths, startOfDay, endOfDay } from 'date-fns'

export async function reportRoutes(app: FastifyInstance) {
  // Protege todas as rotas de relat√≥rios
  app.addHook('onRequest', async (request, reply) => {
    try {
      await request.jwtVerify()
      // Garante que apenas Gerentes acessem relat√≥rios
      const { cargo } = request.user as { cargo: string }
      if (cargo !== 'Gerente') {
        return reply.status(403).send({ message: 'Acesso negado. Apenas gerentes podem ver relat√≥rios.' })
      }
    } catch (err) {
      await reply.status(401).send({ message: 'N√£o autorizado.' })
    }
  })

  /**
   * -----------------------------------------------------------------
   * [GET] /reports/team-overview
   * -----------------------------------------------------------------
   * Gera dados para a p√°gina 'TeamOverview.tsx'.
   * Lista todos os t√©cnicos ativos e seus casos ativos associados.
   */
  app.get('/reports/team-overview', async (request, reply) => {
    try {
      // 1. Busca todos os Agentes Sociais e Especialistas que est√£o ativos
      const technicians = await prisma.user.findMany({
        where: {
          cargo: {
            in: ['Agente Social', 'Especialista'],
          },
          ativo: true, //
        },
        select: {
          id: true,
          nome: true,
          cargo: true,
        },
        orderBy: {
          cargo: 'asc',
        },
      })

      // 2. Busca todos os casos ativos (n√£o desligados)
      const activeCases = await prisma.case.findMany({
        where: {
          status: {
            not: 'DESLIGADO',
          },
        },
        select: {
          id: true,
          nomeCompleto: true,
          status: true,
          agenteAcolhidaId: true, //
          especialistaPAEFIId: true, //
        },
      })

      // 3. Combina os dados no frontend (ou aqui, se preferir)
      // Vamos formatar no backend para facilitar para o frontend
      const overview = technicians.map((tech) => {
        const techCases = activeCases.filter((c) => {
          if (tech.cargo === 'Agente Social') {
            return c.agenteAcolhidaId === tech.id && (c.status === 'AGUARDANDO_ACOLHIDA' || c.status === 'EM_ACOLHIDA')
          }
          if (tech.cargo === 'Especialista') {
            return c.especialistaPAEFIId === tech.id && c.status === 'EM_ACOMPANHAMENTO_PAEFI'
          }
          return false
        }).map(c => ({ id: c.id, nomeCompleto: c.nomeCompleto })) //

        return {
          nome: tech.nome, //
          cargo: tech.cargo, //
          cases: techCases, //
        }
      })

      return reply.status(200).send(overview)
    } catch (error) {
      console.error('Erro ao gerar relat√≥rio de equipe:', error)
      return reply.status(500).send({ message: 'Erro interno no servidor.' })
    }
  })

  /**
   * -----------------------------------------------------------------
   * [GET] /reports/rma
   * -----------------------------------------------------------------
   * Gera dados para o Relat√≥rio Mensal de Atendimentos (RMA).
   *
   * Query Params:
   * - month (obrigat√≥rio): M√™s no formato 'yyyy-MM'.
   */
  app.get('/reports/rma', async (request, reply) => {
    const querySchema = z.object({
      month: z.string().regex(/^\d{4}-\d{2}$/, 'Formato de m√™s inv√°lido. Use YYYY-MM.'),
    })

    try {
      const { month } = querySchema.parse(request.query)
      const targetMonth = parseISO(month)
      const firstDay = startOfMonth(targetMonth)
      const lastDay = endOfMonth(targetMonth)
      const firstDayOfPreviousMonth = startOfMonth(subMonths(targetMonth, 1))
      const lastDayOfPreviousMonth = endOfMonth(subMonths(targetMonth, 1))

      // B1: Contagem no in√≠cio do m√™s
      const initialCount = await prisma.case.count({
        where: {
          status: 'EM_ACOMPANHAMENTO_PAEFI',
          dataInicioPAEFI: {
            lt: firstDay, // Come√ßou antes do in√≠cio deste m√™s
          },
          OR: [
            { dataDesligamento: null }, // Ainda ativo
            { dataDesligamento: { gte: firstDay } }, // Ou foi desligado *neste* m√™s (contava no in√≠cio)
          ],
        },
      })

      // B2: Novas entradas no PAEFI no m√™s
      const newEntries = await prisma.case.findMany({
        where: {
          dataInicioPAEFI: {
            gte: firstDay,
            lte: lastDay,
          },
        },
        select: {
          id: true,
          sexo: true,
          nascimento: true,
        },
      })

      // B3: Desligados no m√™s
      const closedCases = await prisma.case.count({
        where: {
          status: 'DESLIGADO',
          dataDesligamento: {
            gte: firstDay,
            lte: lastDay,
          },
        },
      })

      // B4: Total no final do m√™s
      const finalCount = initialCount + newEntries.length - closedCases //

      // C1: Perfil por Sexo (dos novos casos)
      const profileBySex = { masculino: 0, feminino: 0, outro: 0 } //
      newEntries.forEach(c => {
        if (c.sexo === 'Masculino') profileBySex.masculino++
        else if (c.sexo === 'Feminino') profileBySex.feminino++
        else profileBySex.outro++
      })

      // C2: Perfil por Faixa Et√°ria (dos novos casos)
      const profileByAgeGroup = { //
        '0-6': 0,
        '7-12': 0,
        '13-17': 0,
        '18-29': 0,
        '30-59': 0,
        '60+': 0,
      }
      const now = new Date()
      newEntries.forEach(c => {
        const age = now.getFullYear() - new Date(c.nascimento).getFullYear()
        if (age <= 6) profileByAgeGroup['0-6']++
        else if (age <= 12) profileByAgeGroup['7-12']++
        else if (age <= 17) profileByAgeGroup['13-17']++
        else if (age <= 29) profileByAgeGroup['18-29']++
        else if (age <= 59) profileByAgeGroup['30-59']++
        else profileByAgeGroup['60+']++
      })

      const rmaData: RmaData = { //
        initialCount,
        newEntries: newEntries.length,
        closedCases,
        finalCount,
        profileBySex,
        profileByAgeGroup,
      }

      return reply.status(200).send(rmaData)

    } catch (error) {
      if (error instanceof z.ZodError) {
        return reply.status(400).send({ message: 'Dados inv√°lidos.', errors: error.flatten() })
      }
      console.error('Erro ao gerar relat√≥rio RMA:', error)
      return reply.status(500).send({ message: 'Erro interno no servidor.' })
    }
  })
}

// Interface auxiliar para o tipo RmaData (baseado no frontend)
interface RmaData {
  initialCount: number
  newEntries: number
  closedCases: number
  finalCount: number
  profileBySex: {
    masculino: number
    feminino: number
    outro: number
  }
  profileByAgeGroup: {
    '0-6': number
    '7-12': number
    '13-17': number
    '18-29': number
    '30-59': number
    '60+': number
  }
}

==================================================
FILE: backend\src\routes\stats.ts
==================================================

// backend/src/routes/stats.ts ‚Äî Rotas de estat√≠sticas (Dashboard Adaptativo por Cargo)
import { type FastifyInstance } from "fastify";
import { prisma } from "../lib/prisma";
import { startOfMonth, endOfMonth, startOfDay, endOfDay, addDays } from "date-fns";

export async function statsRoutes(app: FastifyInstance) {
  /**
   * =======================================================
   * MIDDLEWARE: Todas as rotas deste m√≥dulo exigem JWT
   * =======================================================
   */
  app.addHook("onRequest", async (request, reply) => {
    try {
      await request.jwtVerify();
    } catch {
      return reply.status(401).send({ message: "N√£o autorizado." });
    }
  });

  /**
   * =======================================================
   * GET /stats ‚Üí Dashboard Inteligente (Gerente / Agente / Especialista)
   * =======================================================
   */
  app.get("/stats", async (request, reply) => {
    const { cargo, sub: userId } = request.user as { cargo: string; sub: string };

    const today = new Date();
    const firstDayOfMonth = startOfMonth(today);
    const lastDayOfMonth = endOfMonth(today);

    try {
      /**
       * =======================================================
       * 1. PAINEL DO GERENTE ‚Äî vis√£o geral do CREAS
       * =======================================================
       */
      if (cargo === "Gerente") {
        const [
          totalCases,
          acolhidasCount,
          acompanhamentosCount,
          newCasesThisMonth,
          closedCasesThisMonth,
        ] = await Promise.all([
          prisma.case.count(),
          prisma.case.count({
            where: { status: { in: ["AGUARDANDO_ACOLHIDA", "EM_ACOLHIDA"] } },
          }),
          prisma.case.count({
            where: { status: "EM_ACOMPANHAMENTO_PAEFI" },
          }),
          prisma.case.count({
            where: { dataEntrada: { gte: firstDayOfMonth, lte: lastDayOfMonth } },
          }),
          prisma.case.count({
            where: {
              status: "DESLIGADO",
              dataDesligamento: { gte: firstDayOfMonth, lte: lastDayOfMonth },
            },
          }),
        ]);

        // Carga de trabalho (Acolhidas + PAEFI)
        const [agentWorkload, specialistWorkload] = await Promise.all([
          prisma.user.findMany({
            where: { cargo: "Agente Social", ativo: true },
            select: {
              nome: true,
              casosDeAcolhida: {
                where: { status: { in: ["AGUARDANDO_ACOLHIDA", "EM_ACOLHIDA"] } },
                select: { id: true },
              },
            },
          }),
          prisma.user.findMany({
            where: { cargo: "Especialista", ativo: true },
            select: {
              nome: true,
              casosDeAcompanhamento: {
                where: { status: "EM_ACOMPANHAMENTO_PAEFI" },
                select: { id: true },
              },
            },
          }),
        ]);

        // Dados dos gr√°ficos
        const [urgencyGroups, categoryGroups, violationGroups] = await Promise.all([
          prisma.case.groupBy({
            by: ["urgencia"],
            _count: { _all: true },
            where: { status: { not: "DESLIGADO" } },
          }),
          prisma.case.groupBy({
            by: ["categoria"],
            _count: { _all: true },
            where: { status: { not: "DESLIGADO" } },
          }),
          prisma.case.groupBy({
            by: ["violacao"],
            _count: { _all: true },
            where: { status: { not: "DESLIGADO" } },
          }),
        ]);

        const productivity = [...agentWorkload, ...specialistWorkload]
          .map((u) => ({
            name: u.nome,
            value:
              (u.casosDeAcolhida?.length || 0) +
              (u.casosDeAcompanhamento?.length || 0),
          }))
          .sort((a, b) => b.value - a.value);

        return reply.status(200).send({
          role: "Gerente",
          totalCases,
          acolhidasCount,
          acompanhamentosCount,
          newCasesThisMonth,
          closedCasesThisMonth,
          workloadByAgent: agentWorkload.map((u) => ({
            name: u.nome,
            value: u.casosDeAcolhida.length,
          })),
          workloadBySpecialist: specialistWorkload.map((u) => ({
            name: u.nome,
            value: u.casosDeAcompanhamento.length,
          })),
          productivity,
          casesByUrgency: urgencyGroups.map((g) => ({
            name: g.urgencia,
            value: g._count._all,
          })),
          casesByCategory: categoryGroups.map((g) => ({
            name: g.categoria,
            value: g._count._all,
          })),
          casesByViolation: violationGroups.map((g) => ({
            name: g.violacao,
            value: g._count._all,
          })),
        });
      }

      /**
       * =======================================================
       * 2. PAINEL DO AGENTE SOCIAL ‚Äî foco em Acolhida/Triagem
       * =======================================================
       */
      if (cargo === "Agente Social") {
        const [myActiveCases, myClosedMonth, myNewCasesMonth] = await Promise.all([
          prisma.case.count({
            where: {
              agenteAcolhidaId: userId,
              status: { in: ["AGUARDANDO_ACOLHIDA", "EM_ACOLHIDA"] },
            },
          }),
          prisma.case.count({
            where: {
              agenteAcolhidaId: userId,
              status: "DESLIGADO",
              dataDesligamento: { gte: firstDayOfMonth, lte: lastDayOfMonth },
            },
          }),
          prisma.case.count({
            where: {
              agenteAcolhidaId: userId,
              dataEntrada: { gte: firstDayOfMonth, lte: lastDayOfMonth },
            },
          }),
        ]);

        return reply.status(200).send({
          role: "Agente Social",
          myActiveCases,
          myClosedMonth,
          myNewCasesMonth,
        });
      }

      /**
       * =======================================================
       * 3. PAINEL DO ESPECIALISTA ‚Äî foco PAEFI
       * =======================================================
       */
      if (cargo === "Especialista") {
        const [myActiveCases, myClosedMonth, myNewCasesMonth] = await Promise.all([
          prisma.case.count({
            where: {
              especialistaPAEFIId: userId,
              status: "EM_ACOMPANHAMENTO_PAEFI",
            },
          }),
          prisma.case.count({
            where: {
              especialistaPAEFIId: userId,
              status: "DESLIGADO",
              dataDesligamento: { gte: firstDayOfMonth, lte: lastDayOfMonth },
            },
          }),
          prisma.case.count({
            where: {
              especialistaPAEFIId: userId,
              dataInicioPAEFI: { gte: firstDayOfMonth, lte: lastDayOfMonth },
            },
          }),
        ]);

        return reply.status(200).send({
          role: "Especialista",
          myActiveCases,
          myClosedMonth,
          myNewCasesMonth,
        });
      }

      return reply.status(200).send({ message: "Perfil sem painel dispon√≠vel." });
    } catch (error) {
      console.error("Erro ao buscar estat√≠sticas:", error);
      return reply.status(500).send({ message: "Erro interno no servidor." });
    }
  });

  /**
   * =======================================================
   * GET /stats/my-agenda ‚Üí Pr√≥ximos 30 dias (max 5)
   * =======================================================
   */
  app.get("/stats/my-agenda", async (request, reply) => {
    const { sub: userId } = request.user as { sub: string };

    try {
      const today = startOfDay(new Date());
      const cutoffDate = endOfDay(addDays(today, 30));

      const appointments = await prisma.agendamento.findMany({
        where: {
          responsavelId: userId,
          data: { gte: today, lte: cutoffDate },
        },
        take: 5,
        orderBy: { data: "asc" },
        include: {
          caso: {
            select: { id: true, nomeCompleto: true },
          },
        },
      });

      return reply.status(200).send(appointments);
    } catch (error) {
      console.error("Erro ao buscar pr√≥ximos agendamentos:", error);
      return reply.status(500).send({ message: "Erro interno no servidor." });
    }
  });
}


==================================================
FILE: backend\src\routes\users.ts
==================================================

// backend/src/routes/users.ts
import { type FastifyInstance } from 'fastify'
import { z } from 'zod'
import { prisma } from '../lib/prisma' //

export async function userRoutes(app: FastifyInstance) {
  // Protege todas as rotas de usu√°rios
  app.addHook('onRequest', async (request, reply) => {
    try {
      await request.jwtVerify()
    } catch (err) {
      await reply.status(401).send({ message: 'N√£o autorizado.' })
    }
  })

  /**
   * -----------------------------------------------------------------
   * [GET] /users - Listar todos os usu√°rios (para Gerente)
   * -----------------------------------------------------------------
   * Usado pela p√°gina 'UserManagement.tsx'.
   * Lista todos os usu√°rios, exceto o pr√≥prio gerente que est√° logado.
   */
  app.get('/users', async (request, reply) => {
    const { sub: userId, cargo } = request.user as { sub: string; cargo: string }

    if (cargo !== 'Gerente') {
      return reply.status(403).send({ message: 'Acesso negado.' })
    }

    try {
      const users = await prisma.user.findMany({
        where: {
          id: { not: userId }, // N√£o inclui o gerente logado
          ativo: true, // Mostra apenas usu√°rios ativos
        },
        orderBy: { nome: 'asc' },
        select: {
          id: true,
          nome: true,
          email: true,
          cargo: true,
          ativo: true,
        },
      })
      return reply.status(200).send(users)
    } catch (error) {
      console.error('Erro ao listar usu√°rios:', error)
      return reply.status(500).send({ message: 'Erro interno no servidor.' })
    }
  })

  /**
   * -----------------------------------------------------------------
   * [GET] /users/agents - Listar Agentes Sociais ativos
   * -----------------------------------------------------------------
   * Usado pelo 'NewCaseModal.tsx' para preencher o <Select>.
   */
  app.get('/users/agents', async (request, reply) => {
    try {
      const agents = await prisma.user.findMany({
        where: {
          cargo: 'Agente Social',
          ativo: true, //
        },
        orderBy: { nome: 'asc' },
        select: {
          id: true,
          nome: true,
        },
      })
      return reply.status(200).send(agents)
    } catch (error) {
      console.error('Erro ao listar Agentes Sociais:', error)
      return reply.status(500).send({ message: 'Erro interno no servidor.' })
    }
  })

  /**
   * -----------------------------------------------------------------
   * [GET] /users/specialists - Listar Especialistas ativos
   * -----------------------------------------------------------------
   * Usado pelo 'ManagerActions.tsx' para atribuir casos PAEFI.
   */
  app.get('/users/specialists', async (request, reply) => {
    try {
      const specialists = await prisma.user.findMany({
        where: {
          cargo: 'Especialista',
          ativo: true, //
        },
        orderBy: { nome: 'asc' },
        select: {
          id: true,
          nome: true,
        },
      })
      return reply.status(200).send(specialists)
    } catch (error) {
      console.error('Erro ao listar Especialistas:', error)
      return reply.status(500).send({ message: 'Erro interno no servidor.' })
    }
  })

  /**
   * -----------------------------------------------------------------
   * [PUT] /users/:id - Atualizar um usu√°rio
   * -----------------------------------------------------------------
   * Usado pelo 'EditUserModal' na 'UserManagement.tsx'.
   */
  app.put('/users/:id', async (request, reply) => {
    const { cargo } = request.user as { cargo: string }
    if (cargo !== 'Gerente') {
      return reply.status(403).send({ message: 'Acesso negado.' })
    }

    const paramsSchema = z.object({ id: z.string().uuid() })
    // Schema baseado no 'editUserFormSchema'
    const bodySchema = z.object({
      nome: z.string().min(3),
      email: z.string().email(),
      cargo: z.enum(['Gerente', 'Agente Social', 'Especialista']),
    })

    try {
      const { id } = paramsSchema.parse(request.params)
      const data = bodySchema.parse(request.body)

      const updatedUser = await prisma.user.update({
        where: { id },
        data: {
          nome: data.nome,
          email: data.email,
          cargo: data.cargo,
        },
      })

      return reply.status(200).send(updatedUser)
    } catch (error) {
      console.error('Erro ao atualizar usu√°rio:', error)
      return reply.status(500).send({ message: 'Erro interno no servidor.' })
    }
  })

  /**
   * -----------------------------------------------------------------
   * [DELETE] /users/:id - Desativar um usu√°rio
   * -----------------------------------------------------------------
   * Usado pela 'UserManagement.tsx'.
   * N√£o deleta o usu√°rio (para manter o hist√≥rico), apenas o desativa.
   */
  app.delete('/users/:id', async (request, reply) => {
    const { cargo } = request.user as { cargo: string }
    if (cargo !== 'Gerente') {
      return reply.status(403).send({ message: 'Acesso negado.' })
    }

    const paramsSchema = z.object({ id: z.string().uuid() })

    try {
      const { id } = paramsSchema.parse(request.params)

      // Em vez de deletar, atualizamos o campo 'ativo' para 'false'
      await prisma.user.update({
        where: { id },
        data: {
          ativo: false, //
        },
      })

      return reply.status(204).send() // 204 No Content (sucesso, sem corpo)
    } catch (error) {
      console.error('Erro ao desativar usu√°rio:', error)
      return reply.status(500).send({ message: 'Erro interno no servidor.' })
    }
  })
}

==================================================
FILE: backend\src\server.ts
==================================================

// backend/src/server.ts
import fastify from 'fastify'
import cors from '@fastify/cors'
import jwt from '@fastify/jwt'

import { authRoutes } from './routes/auth'
import { caseRoutes } from './routes/cases'
import { userRoutes } from './routes/users'
import { evolutionRoutes } from './routes/evolutions'
import { pafRoutes } from './routes/paf'
import { statsRoutes } from './routes/stats'
import { appointmentRoutes } from './routes/appointments'
import { reportRoutes } from './routes/reports'
import { alertRoutes } from './routes/alerts' // [CORRE√á√ÉO: Importado]

const app = fastify({
  logger: {
    transport: {
      target: 'pino-pretty',
    },
  },
})

app.register(cors, {
  origin: true,
  methods: ['GET', 'POST', 'PUT', 'PATCH', 'DELETE'],
})

app.register(jwt, {
  secret: process.env.JWT_SECRET as string,
})

app.decorate('authenticate', async (request, reply) => {
  try {
    await request.jwtVerify()
  } catch (err) {
    await reply.send(err)
  }
})

// Registo das Rotas
app.register(authRoutes)
app.register(caseRoutes)
app.register(userRoutes)
app.register(evolutionRoutes)
app.register(pafRoutes)
app.register(statsRoutes)
app.register(appointmentRoutes)
app.register(reportRoutes)
app.register(alertRoutes) // [CORRE√á√ÉO: Registrado]

app
  .listen({
    port: 3333,
    host: '0.0.0.0',
  })
  .then(() => {
    console.log('üöÄ Servidor HTTP a rodar em http://localhost:3333')
  })

==================================================
FILE: frontend\src\App.tsx
==================================================

// frontend/src/App.tsx
import { BrowserRouter, Routes, Route, Navigate } from "react-router-dom";
import { QueryClientProvider } from "@tanstack/react-query";
import { ReactQueryDevtools } from "@tanstack/react-query-devtools";
import { Toaster } from "sonner";

import { queryClient } from "./lib/react-query";
import { AuthProvider } from "./contexts/AuthContext";
import { ModalProvider } from "./contexts/ModalContext";
import { ThemeProvider } from "./components/theme-provider";

import { ROUTE_PATHS } from "./constants/routes";
import { ProtectedRoute } from "./ProtectedRoute";
import { MainLayout } from "./components/layout/MainLayout";
import { Login } from "./pages/Login";
import { Dashboard } from "./pages/Dashboard";
import { Cases } from "./pages/Cases";
import { ClosedCases } from "./pages/ClosedCases";
import { CaseDetail } from "./pages/CaseDetail";
import { Agenda } from "./pages/Agenda";
import { Reports } from "./pages/Reports";
import { UserManagement } from "./pages/UserManagement";
import { TeamOverview } from "./pages/TeamOverview";
import { NotFound } from "./pages/NotFound";

export function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <ThemeProvider defaultTheme="dark" storageKey="vite-ui-theme">
        <BrowserRouter>
          <AuthProvider>
            <ModalProvider>
              <Routes>
                <Route path={ROUTE_PATHS.LOGIN} element={<Login />} />

                <Route path={ROUTE_PATHS.DASHBOARD} element={<MainLayout />}>
                  <Route
                    index
                    element={
                      <ProtectedRoute allowedRoles={["Gerente", "Especialista", "Agente Social"]}>
                        <Dashboard />
                      </ProtectedRoute>
                    }
                  />

                  {/* Rotas gerais */}
                  <Route element={<ProtectedRoute allowedRoles={["Gerente", "Especialista", "Agente Social"]} />}>
                    <Route path={ROUTE_PATHS.CASES} element={<Cases />} />
                    <Route path={ROUTE_PATHS.CLOSED_CASES} element={<ClosedCases />} />
                    <Route path={ROUTE_PATHS.AGENDA} element={<Agenda />} />
                  </Route>

                  {/* Rotas t√©cnicas */}
                  <Route element={<ProtectedRoute allowedRoles={["Gerente", "Especialista"]} />}>
                    <Route path={ROUTE_PATHS.CASE_DETAIL} element={<CaseDetail />} />
                  </Route>

                  {/* Rotas de ger√™ncia */}
                  <Route element={<ProtectedRoute allowedRoles={["Gerente"]} />}>
                    <Route path={ROUTE_PATHS.REPORTS} element={<Reports />} />
                    <Route path={ROUTE_PATHS.USERS} element={<UserManagement />} />
                    <Route path={ROUTE_PATHS.TEAM} element={<TeamOverview />} />
                  </Route>
                </Route>

                <Route path={ROUTE_PATHS.NOT_FOUND} element={<NotFound />} />
                <Route path="*" element={<Navigate to={ROUTE_PATHS.DASHBOARD} replace />} />
              </Routes>

              <Toaster richColors />
              <ReactQueryDevtools initialIsOpen={false} />
            </ModalProvider>
          </AuthProvider>
        </BrowserRouter>
      </ThemeProvider>
    </QueryClientProvider>
  );
}


==================================================
FILE: frontend\src\components\case\CaseActions.tsx
==================================================

// frontend/src/components/case/CaseActions.tsx
import { useState } from 'react'
import { toast } from 'sonner'
import { useMutation, useQueryClient } from '@tanstack/react-query'
import { getAvailableActions } from '@/constants/caseTransitions' //
import { Button } from '@/components/ui/button' //
import { useAuth } from '@/hooks/useAuth' //
import { api } from '@/lib/api' //
// Importa os modais da pasta correta
import { CloseCaseModal } from '@/components/modals/CloseCaseModal' //
import { AssignSpecialistModal } from '@/components/modals/AssignSpecialistModal' //
import type { CaseStatusIdentifier } from '@/constants/caseConstants' //
import type { CaseDetailData } from '@/types/case' //
import { getErrorMessage } from '@/utils/error' //

type ActionType = "status" | "close" | "assign"

interface CaseActionsProps {
  caseData: CaseDetailData
}

export function CaseActions({ caseData }: CaseActionsProps) {
  const { user } = useAuth()
  const queryClient = useQueryClient()
  const [isCloseModalOpen, setCloseModalOpen] = useState(false)
  const [isAssignModalOpen, setAssignModalOpen] = useState(false)

  if (!user) return null

  const actions = getAvailableActions(
    caseData.status as CaseStatusIdentifier,
    user.cargo
  )

  // --- MUTATION: Atualizar status ---
  const updateStatus = useMutation({
    mutationFn: async (nextStatus: CaseStatusIdentifier) => {
      await api.patch(`/cases/${caseData.id}/status`, { status: nextStatus })
    },
    onSuccess: () => {
      toast.success('Status atualizado com sucesso!')
      // Invalida todas as queries relacionadas para atualizar a UI
      queryClient.invalidateQueries({ queryKey: ['case', caseData.id] })
      queryClient.invalidateQueries({ queryKey: ['cases'] })
      queryClient.invalidateQueries({ queryKey: ['recentCases'] })
    },
    onError: (error) => {
      toast.error(getErrorMessage(error, 'Falha ao atualizar o status.'))
    },
  })

  const handleAction = (type: ActionType, nextStatus?: CaseStatusIdentifier) => {
    switch (type) {
      case "status":
        if (nextStatus) updateStatus.mutate(nextStatus)
        break
      case "close":
        setCloseModalOpen(true)
        break
      case "assign":
        setAssignModalOpen(true)
        break
    }
  }

  return (
    <div className="flex flex-wrap gap-2 mt-4">

      {actions.length === 0 && (
        <span className="text-sm text-muted-foreground">
          Nenhuma a√ß√£o dispon√≠vel no momento.
        </span>
      )}

      {actions.map((action) => (
        <Button
          key={action.label}
          className={action.style}
          onClick={() => handleAction(action.type as ActionType, action.nextStatus)}
          disabled={action.type === "status" && updateStatus.isPending}
        >
          {action.type === "status" && updateStatus.isPending
            ? "Atualizando..."
            : action.label}
        </Button>
      ))}

      {/* Modais */}
      <CloseCaseModal
        isOpen={isCloseModalOpen}
        onOpenChange={setCloseModalOpen}
        caseId={caseData.id}
      />

      <AssignSpecialistModal
        isOpen={isAssignModalOpen}
        onClose={() => setAssignModalOpen(false)}
        caseId={caseData.id}
      />
    </div>
  )
}

==================================================
FILE: frontend\src\components\case\CaseHistory.tsx
==================================================

// frontend/src/components/case/CaseHistory.tsx
import {
  History,
  PlusCircle,
  RefreshCw,
  UserPlus,
  Power,
  AlertCircle
} from "lucide-react"
import { formatDateSafe } from "@/utils/formatters"
import { Card, CardHeader, CardTitle, CardContent } from "@/components/ui/card"
import type { CaseLog } from "@/types/case"

interface CaseHistoryProps {
  logs: CaseLog[]
}

export function CaseHistory({ logs }: CaseHistoryProps) {
  const getLogConfig = (acao: string) => {
    switch (acao) {
      case "CRIACAO":
        return { icon: PlusCircle, color: "text-blue-500", bg: "bg-blue-500/10" }
      case "MUDANCA_STATUS":
        return { icon: RefreshCw, color: "text-amber-500", bg: "bg-amber-500/10" }
      case "ATRIBUICAO":
        return { icon: UserPlus, color: "text-purple-500", bg: "bg-purple-500/10" }
      case "DESLIGAMENTO":
        return { icon: Power, color: "text-red-500", bg: "bg-red-500/10" }
      default:
        return { icon: AlertCircle, color: "text-gray-500", bg: "bg-gray-500/10" }
    }
  }

  return (
    <Card className="animate-in fade-in slide-in-from-bottom-1 duration-300">
      <CardHeader className="pb-3">
        <CardTitle className="flex items-center gap-2 text-base">
          <History className="h-5 w-5 text-muted-foreground" />
          Hist√≥rico de Auditoria (Sistema)
        </CardTitle>
      </CardHeader>

      <CardContent>
        {logs.length === 0 ? (
          <p className="text-sm text-muted-foreground text-center py-8">
            Nenhum registro de altera√ß√£o encontrado.
          </p>
        ) : (
          <div className="relative border-l-2 border-muted-foreground/20 ml-3 space-y-6">
            {logs.map((log) => {
              const config = getLogConfig(log.acao)
              const Icon = config.icon

              return (
                <div key={log.id} className="relative pl-8 animate-in fade-in duration-300">
                  {/* √çcone */}
                  <span
                    className={`absolute -left-[11px] top-0 flex h-6 w-6 items-center justify-center rounded-full ${config.bg} ring-4 ring-muted ${config.color}`}
                  >
                    <Icon className="h-4 w-4" />
                  </span>

                  <div className="flex flex-col gap-1">
                    <div className="flex items-center justify-between">
                      <p className="text-sm font-medium leading-none text-foreground">
                        {log.descricao}
                      </p>
                      <span className="text-xs text-muted-foreground opacity-80 whitespace-nowrap ml-2">
                        {formatDateSafe(log.createdAt).replace(" ", " √†s ")}
                      </span>
                    </div>

                    <p className="text-xs text-muted-foreground">
                      Realizado por:{" "}
                      <span className="font-medium text-foreground">
                        {log.autor?.nome ?? "Sistema"}
                      </span>
                    </p>
                  </div>
                </div>
              )
            })}
          </div>
        )}
      </CardContent>
    </Card>
  )
}


==================================================
FILE: frontend\src\components\case\DetailField.tsx
==================================================

// frontend/src/components/case/DetailField.tsx
import type { ReactNode } from 'react'
import { cn } from '@/lib/utils' // Importa o utilit√°rio de classes padr√£o do projeto

interface DetailFieldProps {
  label: string
  value: ReactNode | null | undefined
  className?: string
  labelClassName?: string
}

/** Fun√ß√£o que garante fallback apenas para null/undefined (preserva o 0) */
function safeDisplay(value: ReactNode | null | undefined) {
  if (value === null || value === undefined) {
    return '-'
  }
  return value
}

export function DetailField({
  label,
  value,
  className,
  labelClassName,
}: DetailFieldProps) {
  return (
    <div className={cn(className)}> {/* Usa cn() para classes seguras */}
      <dt
        className={cn(
          'text-sm font-medium text-muted-foreground',
          labelClassName,
        )}
      >
        {label}
      </dt>

      <dd className="mt-1 text-sm text-foreground whitespace-pre-wrap break-words">
        {safeDisplay(value)}
      </dd>
    </div>
  )
}

==================================================
FILE: frontend\src\components\case\DetailSkeleton.tsx
==================================================

// frontend/src/components/case/DetailSkeleton.tsx
import { Card } from '@/components/ui/card'
import { Skeleton } from '@/components/ui/skeleton'

export function DetailSkeleton() {
  return (
    <div className="space-y-6">
      {/* Cabe√ßalho */}
      <div className="border-b pb-4">
        <Skeleton className="h-8 w-1/3 mb-2" aria-hidden="true" />
        <Skeleton className="h-5 w-1/4" aria-hidden="true" />
      </div>

      {/* Se√ß√µes repetidas */}
      {[...Array(2)].map((_, i) => (
        <Card key={i} className="p-4 space-y-6">
          <Skeleton className="h-6 w-48" aria-hidden="true" />

          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {[...Array(6)].map((_, j) => (
              <div key={j} className="space-y-2">
                <Skeleton className="h-4 w-24" aria-hidden="true" />
                <Skeleton className="h-4 w-full" aria-hidden="true" />
              </div>
            ))}
          </div>
        </Card>
      ))}
    </div>
  )
}


==================================================
FILE: frontend\src\components\case\EvolutionsSection.tsx
==================================================

// frontend/src/components/case/EvolutionsSection.tsx
import { useForm, type SubmitHandler } from 'react-hook-form' //
import { zodResolver } from '@hookform/resolvers/zod'
import { useMutation, useQuery, useQueryClient } from '@tanstack/react-query' //
import { toast } from 'sonner'
import { Loader2 } from 'lucide-react' //
import { z } from 'zod' //

import { api } from '@/lib/api' //
import { getErrorMessage } from '@/utils/error' //
import { evolutionFormSchema } from '@/schemas/caseSchemas' //
import { formatDateSafe } from '@/utils/formatters' //
import { Button } from '@/components/ui/button' //
import { Textarea } from '@/components/ui/textarea' //
// Importa componentes de formul√°rio do Shadcn
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from '@/components/ui/form'

type EvolutionFormData = z.infer<typeof evolutionFormSchema> //

interface Evolution { //
  id: string
  conteudo: string //
  createdAt: string //
  autor: { nome: string } //
}

export function EvolutionsSection({ caseId }: { caseId: string }) { //
  const queryClient = useQueryClient() //

  // --- CORRE√á√ÉO (ReferenceError) ---
  // Precisamos da vari√°vel 'form' inteira para passar para o componente <Form>
  const form = useForm<EvolutionFormData>({ //
    resolver: zodResolver(evolutionFormSchema), //
    defaultValues: { conteudo: '' }, //
  })
  // --- FIM DA CORRE√á√ÉO ---

  const { data: evolutions, isLoading: isLoadingEvolutions } = useQuery< //
    Evolution[]
  >({
    queryKey: ['evolutions', caseId], //
    queryFn: async () => { //
      const response = await api.get(`/cases/${caseId}/evolutions`) //
      return response.data //
    },
    enabled: !!caseId,
  })

  const { mutate: addEvolution, isPending } = useMutation({ //
    mutationFn: async (data: EvolutionFormData) => { //
      const response = await api.post(`/cases/${caseId}/evolutions`, data) //
      return response.data
    },
    onSuccess: () => { //
      toast.success('Evolu√ß√£o registada com sucesso.') //
      queryClient.invalidateQueries({ queryKey: ['evolutions', caseId] }) //
      form.reset() // Usa form.reset()
    },
    onError: (error) => { //
      toast.error(getErrorMessage(error, 'Falha ao registar evolu√ß√£o.')) //
    },
  })

  const onSubmit: SubmitHandler<EvolutionFormData> = (data) => { //
    addEvolution(data)
  }

  return (
    <div className="rounded-lg border bg-background p-4 space-y-6"> {/* */}
      <h3 className="text-base font-semibold text-foreground"> {/* */}
        Hist√≥rico de Evolu√ß√µes
      </h3>

      {/* Usando os componentes Form do Shadcn/ui */}
      <Form {...form}> {/* Passa o objeto 'form' completo */}
        <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-3">
          <FormField
            control={form.control} // Passa o 'control' do form
            name="conteudo" //
            render={({ field }) => (
              <FormItem>
                <FormLabel htmlFor="conteudo">Adicionar Nova Evolu√ß√£o</FormLabel>
                {/* Corre√ß√£o (Children.only): <FormControl> e <Textarea> na mesma linha */}
                <FormControl><Textarea
                  id="conteudo" //
                  rows={4} //
                  placeholder="Descreva aqui o atendimento, visita ou encaminhamento..." //
                  disabled={isPending} //
                  {...field} //
                /></FormControl>
                <FormMessage />
              </FormItem>
            )}
          />
          <div className="flex justify-end mt-2"> {/* */}
            <Button type="submit" disabled={isPending}> {/* */}
              {isPending && <Loader2 className="mr-2 h-4 w-4 animate-spin" />} {/* */}
              Registar Evolu√ß√£o {/* */}
            </Button>
          </div>
        </form>
      </Form>

      <div className="mt-6 space-y-4"> {/* */}
        {isLoadingEvolutions && <p className="text-sm text-muted-foreground">A carregar hist√≥rico...</p>} {/* */}
        {evolutions?.map((evo) => ( //
          <div key={evo.id} className="bg-card p-4 rounded-md border"> {/* */}
            <p className="text-sm text-foreground whitespace-pre-wrap"> {/* */}
              {evo.conteudo} {/* */}
            </p>
            <p className="text-xs text-muted-foreground mt-2 text-right"> {/* */}
              Registado por {evo.autor.nome} em {formatDateSafe(evo.createdAt)} {/* */}
            </p>
          </div>
        ))}
        {!isLoadingEvolutions && evolutions?.length === 0 && ( //
          <p className="text-sm text-muted-foreground text-center py-4"> {/* */}
            Nenhum hist√≥rico registado.
          </p>
        )}
      </div>
    </div>
  )
}

==================================================
FILE: frontend\src\components\case\PafSection.tsx
==================================================

// frontend/src/components/case/PafSection.tsx
import { useState } from 'react'
import { useForm, type SubmitHandler } from 'react-hook-form' // Removido Controller
import { zodResolver } from '@hookform/resolvers/zod'
import { useMutation, useQueryClient } from '@tanstack/react-query' // Removido useQuery
import { toast } from 'sonner'
import { z } from 'zod'
import { Loader2, Edit } from 'lucide-react'

import { useAuth } from '@/hooks/useAuth'
import { api } from '@/lib/api'
import { getErrorMessage } from '@/utils/error'
import { pafFormSchema } from '@/schemas/caseSchemas'
import { formatDateSafe } from '@/utils/formatters'
import { Button } from '@/components/ui/button'
import { Textarea } from '@/components/ui/textarea'
import { DetailField } from './DetailField'
import type { CaseDetailData, PafData } from '@/types/case'
import { Input } from '@/components/ui/input'
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from '@/components/ui/form'
import { usePaf } from '@/hooks/api/useCaseQueries'

// ... (Resto do c√≥digo permanece igual)

type PafFormData = z.infer<typeof pafFormSchema>

// --- Subcomponente DisplayPaf ---
function DisplayPaf({ paf }: { paf: PafData }) {
  return (
    <div className="mt-4 space-y-4">
      <DetailField label="Diagn√≥stico" value={paf.diagnostico} />
      <DetailField label="Objetivos" value={paf.objetivos} />
      <DetailField label="Estrat√©gias" value={paf.estrategias} />
      <DetailField label="Prazo Final" value={formatDateSafe(paf.deadline)} />
      <p className="text-xs text-muted-foreground pt-2 border-t">
        Criado por {paf.autor.nome} em {formatDateSafe(paf.createdAt)}
      </p>
    </div>
  )
}

// --- Fun√ß√£o formatDateForInput ---
const formatDateForInput = (date: Date | string | undefined) => {
  if (!date) return ''
  try {
    const d = new Date(date)
    return d.toISOString().split('T')[0]
  } catch (error) {
    return ''
  }
}

// --- Subcomponente PafForm ---
function PafForm({
  caseId,
  existingPaf,
  onClose,
}: {
  caseId: string
  existingPaf: PafData | null
  onClose: () => void
}) {
  const queryClient = useQueryClient()
  const form = useForm<PafFormData>({
    resolver: zodResolver(pafFormSchema),
    defaultValues: {
      diagnostico: existingPaf?.diagnostico ?? '',
      objetivos: existingPaf?.objetivos ?? '',
      estrategias: existingPaf?.estrategias ?? '',
      deadline: formatDateForInput(existingPaf?.deadline),
    },
  })

  const { mutate: savePaf, isPending } = useMutation({
    mutationFn: async (data: PafFormData) => {
      const payload = {
        ...data,
        deadline: new Date(data.deadline),
      }
      if (existingPaf) {
        return api.put(`/cases/${caseId}/paf`, payload)
      } else {
        return api.post(`/cases/${caseId}/paf`, payload)
      }
    },
    onSuccess: () => {
      toast.success('PAF salvo com sucesso!')
      queryClient.invalidateQueries({ queryKey: ['paf', caseId] })
      onClose()
    },
    onError: (error) => {
      toast.error(getErrorMessage(error, 'Falha ao salvar o PAF.'))
    },
  })

  const onSubmit: SubmitHandler<PafFormData> = (data) => {
    savePaf(data)
  }

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="mt-4 space-y-4">
        <FormField
          control={form.control}
          name="diagnostico"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Diagn√≥stico</FormLabel>
              <FormControl><Textarea rows={3} {...field} /></FormControl>
              <FormMessage />
            </FormItem>
          )}
        />
        <FormField
          control={form.control}
          name="objetivos"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Objetivos</FormLabel>
              <FormControl><Textarea rows={3} {...field} /></FormControl>
              <FormMessage />
            </FormItem>
          )}
        />
        <FormField
          control={form.control}
          name="estrategias"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Estrat√©gias</FormLabel>
              <FormControl><Textarea rows={3} {...field} /></FormControl>
              <FormMessage />
            </FormItem>
          )}
        />
        <FormField
          control={form.control}
          name="deadline"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Prazo Final (Deadline)</FormLabel>
              <FormControl><Input type="date" {...field} /></FormControl>
              <FormMessage />
            </FormItem>
          )}
        />
        <div className="flex justify-end gap-2 pt-4">
          <Button
            type="button"
            variant="ghost"
            onClick={onClose}
            disabled={isPending}
          >
            Cancelar
          </Button>
          <Button type="submit" disabled={isPending}>
            {isPending && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
            Salvar PAF
          </Button>
        </div>
      </form>
    </Form>
  )
}

// --- Componente Principal ---
export function PafSection({ caseData }: { caseData: CaseDetailData }) {
  const { user } = useAuth()
  const {
    data: paf,
    isLoading,
    isError,
  } = usePaf(caseData.id)

  const [isEditing, setIsEditing] = useState(false)

  const canCreatePaf =
    !paf &&
    caseData.status === 'EM_ACOMPANHAMENTO_PAEFI' &&
    caseData.especialistaPAEFI?.id === user?.id

  const canEditPaf =
    paf &&
    (user?.id === paf.autor.id || user?.cargo === 'Gerente') &&
    caseData.status !== 'DESLIGADO'

  return (
    <div className="rounded-lg border bg-background p-4">
      <div className="flex justify-between items-center mb-4">
        <h3 className="text-base font-semibold text-foreground">
          Plano de Acompanhamento Familiar (PAF)
        </h3>
        {canEditPaf && !isEditing && (
          <Button variant="outline" size="sm" onClick={() => setIsEditing(true)}>
            <Edit className="mr-2 h-4 w-4" />
            Editar PAF
          </Button>
        )}
        {canCreatePaf && !isEditing && (
          <Button variant="default" size="sm" onClick={() => setIsEditing(true)}>
            <Edit className="mr-2 h-4 w-4" />
            Elaborar PAF
          </Button>
        )}
      </div>

      {isLoading && <p className="text-sm text-muted-foreground mt-4">A carregar PAF...</p>}
      
      {isError && (
        <p className="text-sm text-destructive mt-4">
          Erro ao carregar o PAF.
        </p>
      )}

      {!isLoading && !isError && (
        <>
          {isEditing ? (
            <PafForm
              caseId={caseData.id}
              existingPaf={paf || null}
              onClose={() => setIsEditing(false)}
            />
          ) : paf ? (
            <DisplayPaf paf={paf} />
          ) : (
            !canCreatePaf && (
              <p className="text-sm text-muted-foreground mt-4 text-center py-4">
                {caseData.status === 'EM_ACOMPANHAMENTO_PAEFI'
                  ? 'Nenhum PAF elaborado para este caso.'
                  : 'O PAF s√≥ pode ser elaborado quando o caso est√° em Acompanhamento PAEFI.'}
              </p>
            )
          )}
        </>
      )}
    </div>
  )
}

==================================================
FILE: frontend\src\components\CaseForm.tsx
==================================================

import { useForm, type SubmitHandler } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { toast } from 'sonner'
import { useMutation, useQueryClient } from '@tanstack/react-query'
import { IMaskInput } from 'react-imask'
import { Loader2, AlertCircle } from 'lucide-react'
import { clsx } from 'clsx'

import { api } from '@/lib/api'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select'
import { Textarea } from '@/components/ui/textarea'
import { Checkbox } from '@/components/ui/checkbox'
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
  FormDescription
} from '@/components/ui/form'

import { getErrorMessage } from '@/utils/error'
import { createCaseFormSchema, type CreateCaseFormData } from '@/schemas/caseSchemas'
import { useAgents } from '@/hooks/api/useCaseQueries'


// ------------------------------------------------------------
// üîß CONSTANTES E HELPERS
// ------------------------------------------------------------

const CPF_MASK = { mask: '000.000.000-00' }
const PHONE_MASK = { mask: '(00) 00000-0000' }
const SEI_MASK = { mask: '00000-00000000/0000-00' }

const LISTS = {
  sexo: ['Masculino', 'Feminino', 'Outro', 'N√£o Informado'],

  urgencia: [
    'Convive com agressor', 'Idoso 80+', 'Primeira inf√¢ncia', 'Risco de morte',
    'Risco de reincid√™ncia', 'Sofre amea√ßa', 'Risco de desabrigo', 'Crian√ßa/Adolescente',
    'PCD', 'Idoso', 'Interna√ß√£o', 'Acolhimento', 'Gestante/Lactante',
    'Sem risco imediato', 'Visita peri√≥dica'
  ],

  violacao: [
    'Abandono', 'Neglig√™ncia', 'Afastamento do conv√≠vio familiar',
    'Cumprimento de medidas socioeducativas',
    'Descumprimento de condicionalidade do PBF',
    'Discrimina√ß√£o', 'Situa√ß√£o de rua', 'Trabalho infantil',
    'Viol√™ncia f√≠sica e/ou psicol√≥gica', 'Viol√™ncia sexual', 'Outros'
  ],

  categoria: [
    'Mulher', 'POP RUA', 'LGBTQIA+', 'Migrante', 'Idoso',
    'Crian√ßa/adolescente', 'PCD', '√Ålcool/drogas'
  ],

  beneficios: [
    { id: 'BPC', label: 'BPC' },
    { id: 'Bolsa Fam√≠lia', label: 'Bolsa Fam√≠lia' },
    { id: 'Prato Cheio', label: 'Prato Cheio' },
    { id: 'Vulnerabilidade', label: 'Vulnerabilidade' },
    { id: 'Excepcional', label: 'Excepcional' },
    { id: 'Calamidade', label: 'Calamidade' },
  ]
}


// üîß Fun√ß√£o que retorna SOMENTE a data local (sem UTC bug)
const getLocalDateOnly = (date = new Date()) =>
  new Date(date.getTime() - date.getTimezoneOffset() * 60000)
    .toISOString()
    .split("T")[0]


// Valores iniciais
const defaultValues: Partial<CreateCaseFormData> = {
  nomeCompleto: '',
  cpf: '',
  nascimento: '',
  sexo: '',
  telefone: '',
  endereco: '',
  urgencia: '',
  violacao: '',
  categoria: '',
  orgaoDemandante: '',
  agenteAcolhidaId: '',
  linkSei: '',
  observacoes: '',
  numeroSei: '',
  beneficios: [],
  dataEntrada: '', 
}


// ------------------------------------------------------------
// üîß COMPONENTE PRINCIPAL
// ------------------------------------------------------------

interface CaseFormProps {
  onCaseCreated?: () => void
}

export function CaseForm({ onCaseCreated }: CaseFormProps) {
  const queryClient = useQueryClient()
  const { data: agents, isLoading: isLoadingAgents, isError: isErrorAgents } = useAgents()

  const form = useForm<CreateCaseFormData>({
    resolver: zodResolver(createCaseFormSchema),
    defaultValues: {
      ...defaultValues,
      dataEntrada: getLocalDateOnly(),
    },
  })

  const { mutateAsync: createCase, isPending } = useMutation({
    mutationFn: async (data: CreateCaseFormData) => {
      const payload = {
        ...data,
        cpf: data.cpf.replace(/\D/g, ''),
        telefone: data.telefone.replace(/\D/g, ''),
        nascimento: data.nascimento,     // j√° √© data local YYYY-MM-DD
        dataEntrada: getLocalDateOnly(), // sempre salvo a data atual corretamente
      }

      return await api.post('/cases', payload)
    },

    onSuccess: () => {
      toast.success('Caso cadastrado com sucesso!')
      queryClient.invalidateQueries({ queryKey: ['cases'] })

      form.reset({
        ...defaultValues,
        dataEntrada: getLocalDateOnly(),
      })

      onCaseCreated?.()
    },

    onError: (error) => {
      toast.error(getErrorMessage(error, 'Falha ao cadastrar o caso.'))
    },
  })

  const onSubmit: SubmitHandler<CreateCaseFormData> = async (data) => {
    await createCase(data)
  }


  // ------------------------------------------------------------
  // üîß RENDERIZA√á√ÉO
  // ------------------------------------------------------------

  return (
    <Form {...form}>
      <form
        onSubmit={form.handleSubmit(onSubmit)}
        className={clsx("space-y-6", isPending && "opacity-50 pointer-events-none")}
      >

        {/* ------------------------------------------------------------ */}
        {/* 1. IDENTIFICA√á√ÉO PESSOAL */}
        {/* ------------------------------------------------------------ */}
        <div className="space-y-3">
          <h3 className="text-lg font-semibold">Identifica√ß√£o Pessoal</h3>

          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4 border rounded-lg bg-card">

            {/* Nome */}
            <FormField
              control={form.control}
              name="nomeCompleto"
              render={({ field }) => (
                <FormItem className="lg:col-span-2">
                  <FormLabel>Nome Completo</FormLabel>
                  <FormControl><Input {...field} /></FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />

            {/* CPF */}
            <FormField
              control={form.control}
              name="cpf"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>CPF</FormLabel>
                  <FormControl>
                    <IMaskInput
                      {...CPF_MASK}
                      value={field.value || ''}
                      onAccept={(v: string) => field.onChange(v)}
                      onBlur={field.onBlur}
                      className="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />

            {/* Data de Nascimento */}
            <FormField
              control={form.control}
              name="nascimento"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Data de Nascimento</FormLabel>
                  <FormControl>
                    <Input type="date" {...field} />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />

            {/* Sexo */}
            <FormField
              control={form.control}
              name="sexo"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Sexo</FormLabel>
                  <Select value={field.value} onValueChange={field.onChange}>
                    <FormControl>
                      <SelectTrigger><SelectValue placeholder="Selecione" /></SelectTrigger>
                    </FormControl>
                    <SelectContent>
                      {LISTS.sexo.map(s => (
                        <SelectItem key={s} value={s}>{s}</SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                  <FormMessage />
                </FormItem>
              )}
            />

            {/* Telefone */}
            <FormField
              control={form.control}
              name="telefone"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Telefone</FormLabel>
                  <FormControl>
                    <IMaskInput
                      {...PHONE_MASK}
                      value={field.value || ''}
                      onAccept={(v: string) => field.onChange(v)}
                      onBlur={field.onBlur}
                      className="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />

            {/* Endere√ßo */}
            <FormField
              control={form.control}
              name="endereco"
              render={({ field }) => (
                <FormItem className="lg:col-span-3">
                  <FormLabel>Endere√ßo</FormLabel>
                  <FormControl><Input {...field} /></FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
          </div>
        </div>


        {/* ------------------------------------------------------------ */}
        {/* 2. BENEF√çCIOS */}
        {/* ------------------------------------------------------------ */}
        <div className="space-y-3">
          <h3 className="text-lg font-semibold">Benef√≠cios Recebidos</h3>

          <div className="p-4 border rounded-lg bg-card">
            <FormField
              control={form.control}
              name="beneficios"
              render={({ field }) => (
                <FormItem>
                  <div className="grid grid-cols-2 md:grid-cols-3 gap-4">

                    {LISTS.beneficios.map(item => (
                      <FormItem
                        key={item.id}
                        className="flex flex-row items-start space-x-3 space-y-0"
                      >
                        <FormControl>
                          <Checkbox
                            checked={field.value?.includes(item.id)}
                            onCheckedChange={(checked) => {
                              if (checked) {
                                field.onChange([...(field.value || []), item.id])
                              } else {
                                field.onChange(field.value?.filter(v => v !== item.id))
                              }
                            }}
                          />
                        </FormControl>

                        <FormLabel className="cursor-pointer">
                          {item.label}
                        </FormLabel>
                      </FormItem>
                    ))}

                  </div>

                  <FormMessage />
                </FormItem>
              )}
            />
          </div>
        </div>


        {/* ------------------------------------------------------------ */}
        {/* 3. DETALHES DO CASO */}
        {/* ------------------------------------------------------------ */}
        <div className="space-y-3">
          <h3 className="text-lg font-semibold">Detalhes do Caso</h3>

          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4 border rounded-lg bg-card">

            {/* Data Entrada */}
            <FormField
              control={form.control}
              name="dataEntrada"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Data de Entrada</FormLabel>
                  <FormControl>
                    <Input type="date" {...field} readOnly className="bg-muted" />
                  </FormControl>
                  <FormDescription>Data atual do sistema.</FormDescription>
                  <FormMessage />
                </FormItem>
              )}
            />

            {/* Urg√™ncia */}
            <FormField
              control={form.control}
              name="urgencia"
              render={({ field }) => (
                <FormItem className="lg:col-span-2">
                  <FormLabel>N√≠vel de Urg√™ncia</FormLabel>
                  <Select value={field.value} onValueChange={field.onChange}>
                    <FormControl><SelectTrigger><SelectValue placeholder="Selecione" /></SelectTrigger></FormControl>
                    <SelectContent>
                      {LISTS.urgencia.map(u => (
                        <SelectItem key={u} value={u}>{u}</SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                  <FormMessage />
                </FormItem>
              )}
            />

            {/* Viola√ß√£o */}
            <FormField
              control={form.control}
              name="violacao"
              render={({ field }) => (
                <FormItem className="lg:col-span-2">
                  <FormLabel>Viola√ß√£o de Direito</FormLabel>
                  <Select value={field.value} onValueChange={field.onChange}>
                    <FormControl><SelectTrigger><SelectValue placeholder="Selecione" /></SelectTrigger></FormControl>
                    <SelectContent>
                      {LISTS.violacao.map(v => (
                        <SelectItem key={v} value={v}>{v}</SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                  <FormMessage />
                </FormItem>
              )}
            />

            {/* Categoria */}
            <FormField
              control={form.control}
              name="categoria"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Categoria</FormLabel>
                  <Select value={field.value} onValueChange={field.onChange}>
                    <FormControl><SelectTrigger><SelectValue placeholder="Selecione" /></SelectTrigger></FormControl>
                    <SelectContent>
                      {LISTS.categoria.map(c => (
                        <SelectItem key={c} value={c}>{c}</SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                  <FormMessage />
                </FormItem>
              )}
            />

          </div>
        </div>


        {/* ------------------------------------------------------------ */}
        {/* 4. ATRIBUI√á√ÉO E ORIGEM */}
        {/* ------------------------------------------------------------ */}
        <div className="space-y-3">
          <h3 className="text-lg font-semibold">Atribui√ß√£o e Origem</h3>

          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4 border rounded-lg bg-card">

            {/* √ìrg√£o Demandante */}
            <FormField
              control={form.control}
              name="orgaoDemandante"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>√ìrg√£o Demandante</FormLabel>
                  <FormControl><Input {...field} /></FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />

            {/* N√∫mero SEI */}
            <FormField
              control={form.control}
              name="numeroSei"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>N√∫mero do SEI</FormLabel>
                  <FormControl>
                    <IMaskInput
                      {...SEI_MASK}
                      value={field.value || ''}
                      onAccept={(v: string) => field.onChange(v)}
                      onBlur={field.onBlur}
                      className="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"
                      placeholder="00000-00000000/0000-00"
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />

            {/* Link SEI */}
            <FormField
              control={form.control}
              name="linkSei"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Link do SEI</FormLabel>
                  <FormControl>
                    <Input type="url" {...field} placeholder="https://..." />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />

            {/* Agente Respons√°vel */}
            <FormField
              control={form.control}
              name="agenteAcolhidaId"
              render={({ field }) => (
                <FormItem className="lg:col-span-3">
                  <FormLabel>Agente Social Respons√°vel</FormLabel>

                  <Select
                    value={field.value}
                    onValueChange={field.onChange}
                    disabled={isLoadingAgents}
                  >
                    <FormControl>
                      <SelectTrigger>
                        <SelectValue
                          placeholder={
                            isLoadingAgents
                              ? "Carregando..."
                              : "Selecione um agente"
                          }
                        />
                      </SelectTrigger>
                    </FormControl>

                    <SelectContent>
                      {isErrorAgents && (
                        <div className="p-2 text-destructive text-sm flex justify-center gap-2">
                          <AlertCircle className="w-4 h-4" /> Falha ao carregar
                        </div>
                      )}

                      {agents?.length === 0 && (
                        <div className="p-2 text-sm text-muted-foreground text-center">
                          Nenhum agente dispon√≠vel
                        </div>
                      )}

                      {agents?.map(agent => (
                        <SelectItem key={agent.id} value={agent.id}>
                          {agent.nome}
                        </SelectItem>
                      ))}
                    </SelectContent>

                  </Select>

                  <FormMessage />
                </FormItem>
              )}
            />

          </div>
        </div>


        {/* OBSERVA√á√ïES */}
        <FormField
          control={form.control}
          name="observacoes"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Observa√ß√µes (Opcional)</FormLabel>
              <FormControl>
                <Textarea {...field} className="min-h-[100px]" />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />


        {/* BOT√ÉO */}
        <div className="flex justify-end pt-4">
          <Button type="submit" disabled={isPending} className="w-44">
            {isPending && <Loader2 className="animate-spin mr-2" />}
            {isPending ? 'A salvar‚Ä¶' : 'Cadastrar Caso'}
          </Button>
        </div>

      </form>
    </Form>
  )
}


==================================================
FILE: frontend\src\components\CaseStatusBadge.tsx
==================================================

// frontend/src/components/CaseStatusBadge.tsx
import { Badge } from '@/components/ui/badge'
import {
  CASE_STATUS_MAP,
  type CaseStatusIdentifier,
} from '@/constants/caseConstants'
import { clsx } from 'clsx'

interface CaseStatusBadgeProps {
  status: string | CaseStatusIdentifier
  className?: string
}

export function CaseStatusBadge({ status, className }: CaseStatusBadgeProps) {
  // Normaliza entradas (evita problemas vindos do backend)
  const normalized = String(status).trim().toUpperCase() as CaseStatusIdentifier

  const statusInfo = CASE_STATUS_MAP[normalized]

  return (
    <Badge
      variant="outline"
      className={clsx(
        'whitespace-nowrap border-transparent',
        statusInfo?.style ?? 'bg-muted text-muted-foreground',
        className
      )}
    >
      {statusInfo?.text ?? normalized}
    </Badge>
  )
}


==================================================
FILE: frontend\src\components\CaseTable.tsx
==================================================

// frontend/src/components/CaseTable.tsx
import { useState } from 'react'
import { useQuery } from '@tanstack/react-query'
import { Link, useSearchParams } from 'react-router-dom'
import { MoreHorizontal, Search, Edit, FileDown, Loader2 } from 'lucide-react'
import { formatDistanceToNow } from 'date-fns'
import { ptBR } from 'date-fns/locale'
import { toast } from 'sonner'

import { api } from '@/lib/api'
import { type CaseSummary } from '@/types/case'
import { useDebounce } from '@/hooks/useDebounce'
import { ROUTES } from '@/constants/routes'
import { formatCPF, formatDateSafe } from '@/utils/formatters'
import { useAuth } from '@/hooks/useAuth'
import { getErrorMessage } from '@/utils/error'

import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table'
import { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from '@/components/ui/dropdown-menu'
import { Skeleton } from '@/components/ui/skeleton'
import { Pagination } from './Pagination'
import { CaseStatusBadge } from './CaseStatusBadge'
// NOVO IMPORT
import { DataTableFilters } from './DataTableFilters' 

interface PaginatedCasesResponse {
  items: CaseSummary[]
  total: number
  page: number
  pageSize: number
  totalPages: number
}

interface CaseTableProps {
  endpoint: '/cases' | '/cases/closed'
  title: string
  description: string
}

export function CaseTable({ endpoint, title, description }: CaseTableProps) {
  const { user } = useAuth()
  const [searchParams, setSearchParams] = useSearchParams()
  
  // Estados de Pagina√ß√£o e Busca
  const initialSearch = searchParams.get('search') ?? ''
  const initialPage = Number(searchParams.get('page') ?? '1')
  const [searchTerm, setSearchTerm] = useState(initialSearch)
  const debouncedSearchTerm = useDebounce(searchTerm, 500)
  const currentPage = initialPage > 0 ? initialPage : 1
  const [isExporting, setIsExporting] = useState(false)

  // NOVO: Estados de Filtro
  const [filters, setFilters] = useState({
    status: '',
    urgencia: '',
    violacao: ''
  })

  // Fun√ß√£o helper para atualizar filtros
  const handleFilterChange = (key: string, value: string) => {
    setFilters(prev => ({ ...prev, [key]: value === 'all' ? '' : value }))
    // Volta para a p√°gina 1 ao filtrar
    const params = new URLSearchParams(searchParams)
    params.set('page', '1')
    setSearchParams(params)
  }

  const clearFilters = () => {
    setFilters({ status: '', urgencia: '', violacao: '' })
  }

  // Query Principal
  const {
    data: result,
    isLoading,
    isError,
    refetch,
  } = useQuery<PaginatedCasesResponse>({
    // Adicione os filtros na key do cache para recarregar quando mudarem
    queryKey: ['cases', endpoint, debouncedSearchTerm, currentPage, filters], 
    queryFn: async () => {
      const response = await api.get(endpoint, {
        params: {
          search: debouncedSearchTerm || undefined,
          page: currentPage,
          pageSize: 10,
          // Envia os filtros para o backend
          status: filters.status || undefined,
          urgencia: filters.urgencia || undefined,
          violacao: filters.violacao || undefined,
        },
      })
      return response.data
    },
    placeholderData: (previousData) => previousData,
    staleTime: 1000 * 30,
    enabled: !!endpoint,
  })

  const handlePageChange = (page: number) => {
    const params = new URLSearchParams(searchParams)
    params.set('page', String(page))
    if (debouncedSearchTerm) params.set('search', debouncedSearchTerm)
    else params.delete('search')
    setSearchParams(params)
  }

  const handleExport = async () => {
    setIsExporting(true)
    const exportPromise = api.get('/cases/export', { responseType: 'blob' })
    toast.promise(exportPromise, {
      loading: 'A gerar ficheiro de exporta√ß√£o...',
      success: (response) => {
        const url = window.URL.createObjectURL(new Blob([response.data]))
        const link = document.createElement('a')
        link.href = url
        const fileName = `export_casos_${new Date().toISOString().split('T')[0]}.csv`
        link.setAttribute('download', fileName)
        document.body.appendChild(link)
        link.click()
        link.remove()
        return 'Exporta√ß√£o conclu√≠da!'
      },
      error: (error) => getErrorMessage(error, 'Falha ao exportar dados.'),
      finally: () => setIsExporting(false)
    })
  }

  return (
    <div className="space-y-4">
      {/* Cabe√ßalho */}
      <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
        <div>
          <h2 className="text-2xl font-bold">{title}</h2>
          <p className="text-muted-foreground">{description}</p>
        </div>
        {endpoint === '/cases' && user?.cargo === 'Gerente' && (
          <Button variant="outline" size="sm" onClick={handleExport} disabled={isExporting}>
             {isExporting ? <Loader2 className="mr-2 h-4 w-4 animate-spin" /> : <FileDown className="mr-2 h-4 w-4" />}
             Exportar CSV
          </Button>
        )}
      </div>

      {/* Barra de Ferramentas (Busca + Filtros) */}
      <div className="flex flex-col gap-4">
        <div className="flex items-center gap-2">
           <div className="relative flex-1">
            <Search className="absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground" />
            <Input
              className="pl-9 h-9 w-full sm:w-[320px]"
              placeholder="Buscar por nome ou CPF..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
            />
          </div>
        </div>
        
        {/* Componente de Filtros (S√≥ exibe na lista principal, n√£o na closed se n√£o quiser) */}
        {endpoint === '/cases' && (
          <DataTableFilters 
            filters={filters} 
            setFilters={handleFilterChange} 
            onClear={clearFilters} 
          />
        )}
      </div>

      {/* Tabela de Dados */}
      <div className="rounded-md border bg-card">
        <Table>
          <TableHeader>
            <TableRow>
              <TableHead className="w-[140px]">Status</TableHead>
              <TableHead>Nome Completo</TableHead>
              <TableHead className="w-[140px]">CPF</TableHead>
              <TableHead className="w-[180px]">
                {endpoint === '/cases/closed' ? 'Data Deslig.' : 'Data Entrada'}
              </TableHead>
              <TableHead className="w-[200px]">Respons√°vel</TableHead>
              <TableHead className="w-[50px]"></TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {isLoading && Array.from({ length: 5 }).map((_, i) => (
               <TableRow key={i}>
                 <TableCell><Skeleton className="h-6 w-24" /></TableCell>
                 <TableCell><Skeleton className="h-6 w-full" /></TableCell>
                 <TableCell><Skeleton className="h-6 w-28" /></TableCell>
                 <TableCell><Skeleton className="h-6 w-32" /></TableCell>
                 <TableCell><Skeleton className="h-6 w-32" /></TableCell>
                 <TableCell><Skeleton className="h-8 w-8 rounded-full" /></TableCell>
               </TableRow>
             ))}

            {isError && (
              <TableRow>
                <TableCell colSpan={6} className="h-32 text-center text-destructive">
                   <div className="flex flex-col items-center justify-center gap-2">
                     <p>Erro ao carregar os casos.</p>
                     <Button variant="outline" size="sm" onClick={() => refetch()}>Tentar Novamente</Button>
                   </div>
                </TableCell>
              </TableRow>
            )}

            {!isLoading && !isError && result?.items.length === 0 && (
              <TableRow>
                <TableCell colSpan={6} className="h-32 text-center text-muted-foreground">
                  Nenhum caso encontrado.
                </TableCell>
              </TableRow>
            )}

            {!isLoading && !isError && result?.items.map((caseItem) => (
              <TableRow key={caseItem.id}>
                <TableCell><CaseStatusBadge status={caseItem.status} /></TableCell>
                <TableCell className="font-medium">
                  <Link to={ROUTES.CASE_DETAIL(caseItem.id)} className="hover:underline hover:text-primary transition-colors">
                    {caseItem.nomeCompleto}
                  </Link>
                </TableCell>
                <TableCell className="font-mono text-xs">{formatCPF(caseItem.cpf)}</TableCell>
                <TableCell className="text-muted-foreground text-sm">
                  {endpoint === '/cases/closed'
                    ? formatDateSafe(caseItem.dataDesligamento)
                    : formatDistanceToNow(new Date(caseItem.dataEntrada), { locale: ptBR, addSuffix: true })
                  }
                </TableCell>
                <TableCell className="text-muted-foreground text-sm truncate max-w-[200px]">
                  {caseItem.status === 'EM_ACOMPANHAMENTO_PAEFI' || (endpoint === '/cases/closed' && caseItem.especialistaPAEFI)
                    ? caseItem.especialistaPAEFI?.nome ?? 'N√£o atribu√≠do'
                    : caseItem.agenteAcolhida?.nome ?? 'N√£o atribu√≠do'}
                </TableCell>
                <TableCell>
                  <DropdownMenu>
                    <DropdownMenuTrigger asChild> 
                      <Button variant="ghost" size="icon" className="h-8 w-8">
                         <span className="sr-only">Abrir menu</span>
                         <MoreHorizontal className="h-4 w-4" />
                      </Button>
                    </DropdownMenuTrigger>
                    <DropdownMenuContent align="end">
                      <DropdownMenuItem className="p-0"> 
                        <Link to={ROUTES.CASE_DETAIL(caseItem.id)} className="flex w-full items-center px-2 py-1.5 cursor-pointer">
                          <Edit className="mr-2 h-4 w-4" /> Ver Detalhes
                        </Link>
                      </DropdownMenuItem>
                    </DropdownMenuContent>
                  </DropdownMenu>
                </TableCell>
              </TableRow>
            ))}
          </TableBody>
        </Table>
      </div>

      {result && result.total > 0 && (
        <Pagination
          currentPage={currentPage}
          totalPages={result.totalPages}
          totalItems={result.total}
          pageSize={result.pageSize}
          onPageChange={handlePageChange}
        />
      )}
    </div>
  )
}

==================================================
FILE: frontend\src\components\dashboard\DashboardStatCard.tsx
==================================================

// File: components/dashboard/DashboardStatCard.tsx
// This file contains a modernized and visually improved stat card component.

import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { LucideIcon } from 'lucide-react'
import { motion } from 'framer-motion'

interface DashboardStatCardProps {
  title: string
  value: number | undefined
  icon: LucideIcon
  colorClass: string
  description?: string
}

export function DashboardStatCard({ title, value, icon: Icon, colorClass, description }: DashboardStatCardProps) {
  return (
    <motion.div
      initial={{ opacity: 0, y: 10 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.2 }}
      className="w-full"
    >
      <Card className="shadow-sm hover:shadow-md transition-all rounded-2xl border border-border/40">
        <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
          <CardTitle className="text-sm font-medium text-muted-foreground tracking-tight">
            {title}
          </CardTitle>
          <Icon className={`h-5 w-5 ${colorClass}`} />
        </CardHeader>
        <CardContent>
          <div className="text-3xl font-bold leading-tight">{value ?? '-'}</div>
          {description && (
            <p className="text-xs text-muted-foreground mt-1 leading-relaxed">
              {description}
            </p>
          )}
        </CardContent>
      </Card>
    </motion.div>
  )
}

==================================================
FILE: frontend\src\components\dashboard\UpcomingPafDeadlines.tsx
==================================================

// frontend/src/components/dashboard/UpcomingPafDeadlines.tsx

import { useQuery } from '@tanstack/react-query'
import { api } from '@/lib/api' //
import { AlertTriangle, CalendarCheck, Loader2 } from 'lucide-react'
import { formatDistanceToNow } from 'date-fns'
import { ptBR } from 'date-fns/locale'
import { Link } from 'react-router-dom'

import {
  Card,
  CardContent,
  CardHeader,
  CardTitle,
  CardDescription,
} from '@/components/ui/card' //
import { Badge } from '@/components/ui/badge'
import { ROUTES } from '@/constants/routes' //
import { formatDateSafe } from '@/utils/formatters' //

interface PafDeadlineAlert {
  pafId: string
  deadline: string
  caseId: string
  caseName: string
  specialistName: string
  objetivosResumo: string
}

export function UpcomingPafDeadlines() {
  const {
    data: alerts,
    isLoading,
    isError,
  } = useQuery<PafDeadlineAlert[]>({
    queryKey: ['pafDeadlineAlerts'],
    queryFn: async () => {
      const response = await api.get('/alerts/paf-deadlines')
      return response.data
    },
    staleTime: 1000 * 60 * 5,
  })

  if (isLoading) {
    return (
      <Card aria-busy="true">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <CalendarCheck className="h-5 w-5 flex-shrink-0" /> {/* Impede √≠cone de esmagar */}
            Prazos de PAF Pr√≥ximos (7 dias)
          </CardTitle>
          <CardDescription>
            <span className="sr-only">Carregando prazos...</span>
            A carregar prazos...
          </CardDescription>
        </CardHeader>
        <CardContent className="flex h-32 items-center justify-center">
          <Loader2 className="h-8 w-8 animate-spin text-muted-foreground" />
        </CardContent>
      </Card>
    )
  }

  if (isError) {
    return (
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2 text-destructive">
            <AlertTriangle className="h-5 w-5 flex-shrink-0" />
            Erro ao Carregar Prazos
          </CardTitle>
          <CardDescription>
            N√£o foi poss√≠vel buscar os prazos de PAF.
          </CardDescription>
        </CardHeader>
      </Card>
    )
  }

  const sortedAlerts = [...(alerts ?? [])].sort(
    (a, b) => new Date(a.deadline).getTime() - new Date(b.deadline).getTime()
  )

  return (
    <Card className="h-full"> {/* Garante altura consistente se estiver em grid */}
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <CalendarCheck className="h-5 w-5 flex-shrink-0 text-primary" />
          Prazos de PAF Pr√≥ximos
        </CardTitle>
        <CardDescription>
          {sortedAlerts.length > 0
            ? `${sortedAlerts.length} PAF(s) vencendo nos pr√≥ximos 7 dias.`
            : 'Nenhum PAF com prazo cr√≠tico para esta semana.'}
        </CardDescription>
      </CardHeader>

      <CardContent>
        {sortedAlerts.length > 0 ? (
          <ul className="space-y-3">
            {sortedAlerts.map((alert) => {
              const deadlineDate = new Date(alert.deadline)

              return (
                <li
                  key={`${alert.caseId}-${alert.pafId}`}
                  // CORRE√á√ÉO DE LAYOUT:
                  // 'items-start' alinha ao topo (melhor para textos longos)
                  // 'overflow-hidden' impede vazamento
                  className="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 p-3 border rounded-md bg-background/50 hover:bg-accent/50 transition-colors"
                >
                  {/* Lado Esquerdo: Informa√ß√µes do Caso (com truncate) */}
                  <div className="flex-1 min-w-0 space-y-1">
                    <Link
                      to={ROUTES.CASE_DETAIL(alert.caseId)} //
                      className="font-semibold text-primary hover:underline block truncate"
                      title={`Ver caso: ${alert.caseName}`}
                    >
                      Caso: {alert.caseName}
                    </Link>

                    <p
                      className="text-sm text-muted-foreground line-clamp-2" // line-clamp-2 limita a 2 linhas
                      title={alert.objetivosResumo}
                    >
                      <span className="font-medium text-foreground/80">Objetivo:</span> {alert.objetivosResumo}
                    </p>

                    <p className="text-xs text-muted-foreground truncate">
                      Respons√°vel: {alert.specialistName}
                    </p>
                  </div>

                  {/* Lado Direito: Data (fixo, n√£o encolhe) */}
                  <div className="text-right flex-shrink-0 flex flex-row sm:flex-col items-center sm:items-end justify-between sm:justify-start gap-2">
                    <Badge variant="outline" className="whitespace-nowrap border-destructive/30 text-destructive bg-destructive/5">
                      {formatDateSafe(alert.deadline)}
                    </Badge>

                    <p className="text-xs font-medium text-destructive mt-0.5">
                      Vence {formatDistanceToNow(deadlineDate, {
                        addSuffix: true,
                        locale: ptBR,
                      })}
                    </p>
                  </div>
                </li>
              )
            })}
          </ul>
        ) : (
          <div className="flex flex-col items-center justify-center py-8 text-center text-muted-foreground">
            <CalendarCheck className="h-10 w-10 mb-2 opacity-20" />
            <p>Tudo em dia por aqui.</p>
          </div>
        )}
      </CardContent>
    </Card>
  )
}

==================================================
FILE: frontend\src\components\DataTableFilters.tsx
==================================================

import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select"
import { Button } from "@/components/ui/button"
import { X } from "lucide-react"

// Listas de Filtros
const LIST_URGENCIA = [
  "Risco de morte",
  "Viol√™ncia f√≠sica e/ou psicol√≥gica",
  "Trabalho infantil",
  "Acolhimento",
  "Sem risco imediato"
]

const LIST_STATUS = [
  { value: "AGUARDANDO_ACOLHIDA", label: "Aguardando Acolhida" },
  { value: "EM_ACOLHIDA", label: "Em Acolhida" },
  { value: "AGUARDANDO_DISTRIBUICAO_PAEFI", label: "Aguardando Distribui√ß√£o" },
  { value: "EM_ACOMPANHAMENTO_PAEFI", label: "Em Acompanhamento" },
]

const LIST_VIOLACAO = [
  "Neglig√™ncia",
  "Abandono",
  "Viol√™ncia f√≠sica",
  "Viol√™ncia psicol√≥gica",
  "Viol√™ncia sexual",
  "Trabalho infantil",
  "Outras viola√ß√µes"
]

interface FiltersProps {
  filters: {
    status: string
    urgencia: string
    violacao: string
  }
  setFilters: (key: string, value: string) => void
  onClear: () => void
}

export function DataTableFilters({ filters, setFilters, onClear }: FiltersProps) {
  const hasActiveFilters = filters.status || filters.urgencia || filters.violacao

  return (
    <div className="flex flex-wrap items-center gap-2 mb-4">

      {/* Filtro de Status */}
      <Select
        value={filters.status}
        onValueChange={(val) => setFilters("status", val)}
      >
        <SelectTrigger className="w-[180px] h-9">
          <SelectValue placeholder="Status" />
        </SelectTrigger>
        <SelectContent>
          <SelectItem value="all">Todos os Status</SelectItem>
          {LIST_STATUS.map((s) => (
            <SelectItem key={s.value} value={s.value}>
              {s.label}
            </SelectItem>
          ))}
        </SelectContent>
      </Select>

      {/* Filtro de Urg√™ncia */}
      <Select
        value={filters.urgencia}
        onValueChange={(val) => setFilters("urgencia", val)}
      >
        <SelectTrigger className="w-[180px] h-9">
          <SelectValue placeholder="Urg√™ncia" />
        </SelectTrigger>
        <SelectContent>
          <SelectItem value="all">Todas as Urg√™ncias</SelectItem>
          {LIST_URGENCIA.map((u) => (
            <SelectItem key={u} value={u}>
              {u}
            </SelectItem>
          ))}
        </SelectContent>
      </Select>

      {/* Filtro de Viola√ß√£o */}
      <Select
        value={filters.violacao}
        onValueChange={(val) => setFilters("violacao", val)}
      >
        <SelectTrigger className="w-[200px] h-9">
          <SelectValue placeholder="Tipo de Viola√ß√£o" />
        </SelectTrigger>
        <SelectContent>
          <SelectItem value="all">Todas as Viola√ß√µes</SelectItem>
          {LIST_VIOLACAO.map((v) => (
            <SelectItem key={v} value={v}>
              {v}
            </SelectItem>
          ))}
        </SelectContent>
      </Select>

      {/* Bot√£o Limpar */}
      {hasActiveFilters && (
        <Button
          variant="ghost"
          size="sm"
          onClick={onClear}
          className="h-9 px-2 text-muted-foreground hover:text-foreground"
        >
          <X className="mr-2 h-4 w-4" />
          Limpar
        </Button>
      )}
    </div>
  )
}


==================================================
FILE: frontend\src\components\layout\GdfLogo.tsx
==================================================

// frontend/src/components/layout/GdfLogo.tsx
import { SVGProps } from 'react'

export function GdfLogo(props: SVGProps<SVGSVGElement>) {
  return (
    <svg
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      strokeWidth="2"
      strokeLinecap="round"
      strokeLinejoin="round"
      {...props} // Permite passar className e outras props
    >
      <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
      <path d="m9 12 2 2 4-4" />
    </svg>
  )
}

==================================================
FILE: frontend\src\components\layout\Header.tsx
==================================================

// frontend/src/components/layout/Header.tsx
import { LogOut, Slash } from "lucide-react"
import { useAuth } from "@/hooks/useAuth"
import { ThemeToggle } from "@/components/ThemeToggle"
import { Button } from "@/components/ui/button"
import { MobileSidebar } from "./MobileSidebar"
import { useLocation } from "react-router-dom"
import { NotificationBell } from "./NotificationBell" // SININHO

export function Header() {
  const { user, logout } = useAuth()
  const location = useLocation()

  const pageName = location.pathname.split("/")[1] || "Dashboard"
  const formattedTitle = pageName.charAt(0).toUpperCase() + pageName.slice(1)

  return (
    <header className="sticky top-0 z-30 flex h-16 items-center gap-4 border-b bg-background/95 px-6 backdrop-blur">
      {/* MOBILE MENU */}
      <div className="md:hidden">
        <MobileSidebar />
      </div>

      {/* BREADCRUMB */}
      <div className="flex items-center gap-2 text-sm text-muted-foreground">
        <span className="hidden sm:inline-block font-medium text-foreground">
          SGAC
        </span>
        <Slash className="hidden sm:inline-block h-4 w-4 text-muted-foreground/40" />
        <span className="font-medium text-foreground">
          {formattedTitle}
        </span>
      </div>

      {/* A√á√ïES DO HEADER */}
      <div className="ml-auto flex items-center gap-2 md:gap-4">
        
        {/* üîî SININHO DE NOTIFICA√á√ïES */}
        <NotificationBell />

        <ThemeToggle />

        <div className="hidden md:flex flex-col items-end border-l pl-4 ml-2">
          <span className="text-sm font-medium leading-none">
            {user?.nome}
          </span>
          <span className="text-xs text-muted-foreground">
            {user?.cargo}
          </span>
        </div>

        <Button
          variant="ghost"
          size="icon"
          onClick={logout}
          className="text-muted-foreground hover:text-destructive"
          title="Sair"
        >
          <LogOut className="h-5 w-5" />
        </Button>
      </div>
    </header>
  )
}


==================================================
FILE: frontend\src\components\layout\MainLayout.tsx
==================================================

// frontend/src/components/layout/MainLayout.tsx
import { Outlet } from "react-router-dom"
import { Sidebar } from "./Sidebar"
import { Header } from "./Header"
import { NewCaseModal } from "../NewCaseModal"

export function MainLayout() {
  return (
    <div className="flex min-h-screen w-full bg-muted/20">
      {/* GRID GERAL */}
      <div className="grid w-full min-h-screen md:grid-cols-[260px_1fr] lg:grid-cols-[280px_1fr]">

        {/* SIDEBAR FIXA */}
        <Sidebar />

        {/* √ÅREA PRINCIPAL */}
        <div className="flex flex-col">
          {/* HEADER FIXO */}
          <Header />

          {/* CONTE√öDO SCROLL√ÅVEL */}
          <main className="flex-1 overflow-y-auto p-4 sm:p-6 lg:p-8 bg-background">
            <div className="mx-auto max-w-6xl space-y-6">
              <Outlet />
            </div>
          </main>
        </div>
      </div>

      {/* MODAL GLOBAL */}
      <NewCaseModal />
    </div>
  )
}


==================================================
FILE: frontend\src\components\layout\MobileSidebar.tsx
==================================================

// frontend/src/components/layout/MobileSidebar.tsx
import { useState } from "react"
import { NavLink } from "react-router-dom"
import { Menu, Plus } from "lucide-react"
import { clsx } from "clsx"

import { Button } from "@/components/ui/button"
import {
  Sheet,
  SheetContent,
  SheetTrigger,
  SheetTitle,
  SheetDescription,
} from "@/components/ui/sheet"

import { useAuth } from "@/hooks/useAuth"
import { useModal } from "@/hooks/useModal"
import { navLinks } from "@/constants/navigation"
import { GdfLogo } from "./GdfLogo"

export function MobileSidebar() {
  const { user } = useAuth()
  const { openNewCaseModal } = useModal()
  const [open, setOpen] = useState(false)

  const closeMenu = () => setOpen(false)

  const accessibleLinks = user
    ? navLinks.filter((link) => link.allowedRoles.includes(user.cargo))
    : []

  const groupedLinks = {
    Acompanhamento: accessibleLinks.filter(l => l.section === "Acompanhamento"),
    Administra√ß√£o: accessibleLinks.filter(l => l.section === "Administra√ß√£o"),
  }

  return (
    <Sheet open={open} onOpenChange={setOpen}>
      <SheetTrigger asChild>
        <Button variant="ghost" size="icon" className="-ml-2 md:hidden">
          <Menu className="h-6 w-6" />
        </Button>
      </SheetTrigger>

      <SheetContent side="left" className="flex flex-col w-[85%] max-w-[300px] p-6">
        <div className="sr-only">
          <SheetTitle>Menu</SheetTitle>
          <SheetDescription>Navega√ß√£o do sistema SGAC.</SheetDescription>
        </div>

        {/* LOGO */}
        <div className="flex items-center gap-2 mb-8">
          <GdfLogo className="h-6 w-6 text-primary" />
          <span className="font-bold text-lg">SGAC-BRAZ</span>
        </div>

        {/* BOT√ÉO PRINCIPAL */}
        <Button
          onClick={() => {
            closeMenu()
            openNewCaseModal()
          }}
          className="w-full shadow-sm mb-6"
          size="lg"
        >
          <Plus className="mr-2 h-4 w-4" /> Novo Caso
        </Button>

        {/* LINKS */}
        <div className="flex-1 overflow-y-auto">
          <nav className="grid gap-8">
            {groupedLinks.Acompanhamento.length > 0 && (
              <MobileGroup title="Acompanhamento" links={groupedLinks.Acompanhamento} close={closeMenu} />
            )}
            {groupedLinks.Administra√ß√£o.length > 0 && (
              <MobileGroup title="Administra√ß√£o" links={groupedLinks.Administra√ß√£o} close={closeMenu} />
            )}
          </nav>
        </div>

        {/* FOOTER */}
        <div className="border-t pt-4 mt-auto">
          <div className="px-2 text-sm font-medium">{user?.nome}</div>
          <div className="px-2 text-xs text-muted-foreground">{user?.cargo}</div>
        </div>
      </SheetContent>
    </Sheet>
  )
}

function MobileGroup({ title, links, close }: any) {
  return (
    <div className="grid gap-1">
      <h4 className="px-2 mb-2 text-xs font-semibold text-muted-foreground uppercase tracking-wide">
        {title}
      </h4>
      {links.map((link: any) => (
        <MobileLink key={link.to} {...link} onClick={close} />
      ))}
    </div>
  )
}

function MobileLink({ to, icon: Icon, label, onClick }: any) {
  return (
    <NavLink
      to={to}
      onClick={onClick}
      end
      className={({ isActive }) =>
        clsx(
          "flex items-center gap-3 rounded-md px-3 py-3 text-sm font-medium transition-colors",
          isActive
            ? "bg-primary/10 text-primary"
            : "text-muted-foreground hover:bg-muted hover:text-foreground"
        )
      }
    >
      <Icon className="h-5 w-5" />
      {label}
    </NavLink>
  )
}


==================================================
FILE: frontend\src\components\layout\NotificationBell.tsx
==================================================

import { useState } from 'react'
import { useQuery } from '@tanstack/react-query'
import { Bell } from 'lucide-react'
import { Link } from 'react-router-dom'
import { api } from '@/lib/api'
import { useAuth } from '@/hooks/useAuth'
import { ROUTES } from '@/constants/routes'

import {
  Popover,
  PopoverContent,
  PopoverTrigger,
} from '@/components/ui/popover'
import { Button } from '@/components/ui/button'
import { ScrollArea } from '@/components/ui/scroll-area'
import { Badge } from '@/components/ui/badge'

interface NotificationItem {
  id: string
  title: string
  description: string
  link: string
  type: 'critical' | 'info'
}

interface DeadlineAlert {
  pafId: string
  caseId: string
  caseName: string
}

export function NotificationBell() {
  const { user } = useAuth()
  const [isOpen, setIsOpen] = useState(false)

  const { data: notifications = [] } = useQuery<NotificationItem[]>({
    queryKey: ['notifications-bell', user?.cargo],
    queryFn: async () => {
      const items: NotificationItem[] = []

      // ---------------------------
      // 1. ALERTAS DE PAF (exceto agentes)
      // ---------------------------
      if (user?.cargo !== 'Agente Social') {
        try {
          const pafRes = await api.get('/alerts/paf-deadlines')
          const pafs: DeadlineAlert[] = Array.isArray(pafRes.data) ? pafRes.data : []

          pafs.forEach((p) => {
            items.push({
              id: `paf-${p.pafId}`,
              title: 'Prazo de PAF Vencendo',
              description: `Caso: ${p.caseName}. Prazo se encerra em breve.`,
              link: ROUTES.CASE_DETAIL(p.caseId),
              type: 'critical',
            })
          })
        } catch {
          // Evita quebra caso a rota falhe
        }
      }

      // ---------------------------
      // 2. NOVOS CASOS PARA ACOLHIDA (Agente Social e Gerente)
      // ---------------------------
      if (user?.cargo === 'Agente Social' || user?.cargo === 'Gerente') {
        try {
          const res = await api.get('/cases', {
            params: { status: 'AGUARDANDO_ACOLHIDA', pageSize: 5 },
          })

          const total = Number(res.data?.total ?? 0)

          if (total > 0) {
            items.push({
              id: 'new-cases-queue',
              title: 'Casos Aguardando Acolhida',
              description: `Existem ${total} casos aguardando acolhida.`,
              link: ROUTES.CASES,
              type: 'info',
            })
          }
        } catch {
          // Evita erro caso a rota n√£o esteja dispon√≠vel
        }
      }

      return items
    },
    refetchInterval: 60_000, // 1 vez por minuto
    staleTime: 30_000,
  })

  const criticalCount = notifications.filter((n) => n.type === 'critical').length
  const hasNotifications = notifications.length > 0

  return (
    <Popover open={isOpen} onOpenChange={setIsOpen}>
      <PopoverTrigger asChild>
        <Button variant="ghost" size="icon" className="relative">
          <Bell className="h-5 w-5 text-muted-foreground" />

          {hasNotifications && (
            <span
              className={`absolute top-2 right-2 h-2.5 w-2.5 rounded-full border border-background ${
                criticalCount > 0 ? 'bg-destructive' : 'bg-blue-500'
              }`}
            />
          )}
        </Button>
      </PopoverTrigger>

      <PopoverContent align="end" className="w-80 p-0">
        <div className="flex items-center justify-between border-b px-4 py-3">
          <h4 className="font-semibold">Notifica√ß√µes</h4>

          {hasNotifications && (
            <Badge variant="secondary">{notifications.length}</Badge>
          )}
        </div>

        <ScrollArea className="h-[300px]">
          {notifications.length === 0 ? (
            <div className="p-8 text-center text-sm text-muted-foreground">
              Nenhuma notifica√ß√£o nova.
            </div>
          ) : (
            <div className="grid gap-1">
              {notifications.map((item) => (
                <Link
                  key={item.id}
                  to={item.link}
                  onClick={() => setIsOpen(false)}
                  className="flex flex-col gap-1 px-4 py-3 hover:bg-muted/50 transition-colors border-b last:border-0"
                >
                  <div className="flex items-center gap-2">
                    <span
                      className={`h-2 w-2 rounded-full ${
                        item.type === 'critical' ? 'bg-destructive' : 'bg-blue-500'
                      }`}
                    />
                    <span className="font-medium text-sm">{item.title}</span>
                  </div>

                  <p className="text-xs text-muted-foreground pl-4">
                    {item.description}
                  </p>
                </Link>
              ))}
            </div>
          )}
        </ScrollArea>
      </PopoverContent>
    </Popover>
  )
}


==================================================
FILE: frontend\src\components\layout\Sidebar.tsx
==================================================

// frontend/src/components/layout/Sidebar.tsx
import { memo } from "react"
import { NavLink } from "react-router-dom"
import { Plus } from "lucide-react"
import { clsx } from "clsx"

import { useAuth } from "@/hooks/useAuth"
import { useModal } from "@/hooks/useModal"
import { ROUTES } from "@/constants/routes"
import { GdfLogo } from "./GdfLogo"
import { Button } from "@/components/ui/button"
import { navLinks } from "@/constants/navigation"

export const Sidebar = memo(function Sidebar() {
  const { user } = useAuth()
  const { openNewCaseModal } = useModal()

  const accessibleLinks = user
    ? navLinks.filter((link) => link.allowedRoles.includes(user.cargo))
    : []

  const groupedLinks = {
    Acompanhamento: accessibleLinks.filter((l) => l.section === "Acompanhamento"),
    Administra√ß√£o: accessibleLinks.filter((l) => l.section === "Administra√ß√£o"),
  }

  return (
    <aside className="hidden md:flex flex-col border-r bg-card min-h-screen">
      
      {/* LOGO */}
      <div className="flex h-16 items-center border-b px-6">
        <NavLink
          to={user?.cargo === "Gerente" ? ROUTES.DASHBOARD : ROUTES.CASES}
          className="flex items-center gap-2 font-bold text-lg tracking-tight"
        >
          <GdfLogo className="h-6 w-6 text-primary" />
          <span>SGAC-BRAZ</span>
        </NavLink>
      </div>

      {/* LINKS + SCROLL */}
      <div className="flex-1 overflow-y-auto py-6 px-4">
        <nav className="grid gap-8">
          
          {/* BOT√ÉO NOVO CASO */}
          <Button onClick={openNewCaseModal} className="w-full shadow-sm" size="lg">
            <Plus className="mr-2 h-4 w-4" /> Novo Caso
          </Button>

          {/* SE√á√ïES */}
          {groupedLinks.Acompanhamento.length > 0 && (
            <SidebarSection title="ACOMPANHAMENTO" links={groupedLinks.Acompanhamento} />
          )}
          {groupedLinks.Administra√ß√£o.length > 0 && (
            <SidebarSection title="ADMINISTRA√á√ÉO" links={groupedLinks.Administra√ß√£o} />
          )}

        </nav>
      </div>

      {/* FOOTER */}
      <div className="border-t p-4 text-center text-xs text-muted-foreground">
        v1.0.0 ‚Ä¢ SEDES/DF
      </div>
    </aside>
  )
})

function SidebarSection({ title, links }: any) {
  return (
    <div className="grid gap-2">
      <h4 className="mb-1 px-2 text-xs font-semibold text-muted-foreground uppercase tracking-wide">
        {title}
      </h4>

      {links.map((link: any) => (
        <SidebarLink key={link.to} {...link} />
      ))}
    </div>
  )
}

function SidebarLink({ to, icon: Icon, label }: any) {
  return (
    <NavLink
      to={to}
      end
      className={({ isActive }) =>
        clsx(
          "flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium transition-colors",
          isActive
            ? "bg-primary/10 text-primary"
            : "text-muted-foreground hover:bg-muted hover:text-foreground"
        )
      }
    >
      <Icon className="h-4 w-4" />
      {label}
    </NavLink>
  )
}


==================================================
FILE: frontend\src\components\modals\AssignSpecialistModal.tsx
==================================================

// frontend/src/components/modals/AssignSpecialistModal.tsx
import { useState } from 'react'
import { useMutation, useQueryClient } from '@tanstack/react-query'
import { toast } from 'sonner'
import { Loader2 } from 'lucide-react'

import { api } from '@/lib/api' //
import { useSpecialists } from '@/hooks/api/useCaseQueries' //
import { getErrorMessage } from '@/utils/error' //
import { Button } from '@/components/ui/button' //
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogDescription,
  DialogFooter,
} from '@/components/ui/dialog' //
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select' //
import { Label } from '@/components/ui/label' //

interface AssignSpecialistModalProps {
  caseId: string
  isOpen: boolean
  onClose: () => void
}

export function AssignSpecialistModal({
  caseId,
  isOpen,
  onClose,
}: AssignSpecialistModalProps) {
  const queryClient = useQueryClient()
  const [selectedSpecialist, setSelectedSpecialist] = useState('')

  // Busca a lista de especialistas dispon√≠veis
  const { data: specialists, isLoading: isLoadingSpecialists } =
    useSpecialists() //

  // Mutation para atribuir o especialista
  const { mutate: assignSpecialist, isPending } = useMutation({
    mutationFn: async (specialistId: string) => {
      return await api.patch(`/cases/${caseId}/assign`, { specialistId }) //
    },
    onSuccess: () => {
      toast.success('Especialista atribu√≠do com sucesso!')
      queryClient.invalidateQueries({ queryKey: ['cases'] }) //
      queryClient.invalidateQueries({ queryKey: ['case', caseId] }) //
      onClose() // Fecha o modal
    },
    onError: (error) => {
      toast.error(getErrorMessage(error, 'Falha ao atribuir especialista.')) //
    },
  })

  const handleAssign = () => {
    if (!selectedSpecialist) {
      toast.error('Por favor, selecione um especialista.')
      return
    }
    assignSpecialist(selectedSpecialist)
  }

  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      <DialogContent>
        <DialogHeader>
          <DialogTitle>Atribuir Especialista PAEFI</DialogTitle>
          <DialogDescription>
            Selecione o profissional que ficar√° respons√°vel pelo acompanhamento
            PAEFI deste caso.
          </DialogDescription>
        </DialogHeader>

        <div className="space-y-4 py-4">
          <div className="space-y-2">
            <Label htmlFor="specialist">Especialista</Label>
            <Select
              onValueChange={setSelectedSpecialist}
              value={selectedSpecialist}
              disabled={isLoadingSpecialists || isPending}
            >
              <SelectTrigger id="specialist">
                <SelectValue
                  placeholder={
                    isLoadingSpecialists ? 'A carregar...' : 'Selecione...'
                  }
                />
              </SelectTrigger>
              <SelectContent>
                {specialists?.map((s) => (
                  <SelectItem key={s.id} value={s.id}>
                    {s.nome}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>
        </div>

        <DialogFooter>
          <Button type="button" variant="ghost" onClick={onClose}>
            Cancelar
          </Button>
          <Button
            onClick={handleAssign}
            disabled={isPending || !selectedSpecialist}
          >
            {isPending && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
            Confirmar Atribui√ß√£o
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  )
}

==================================================
FILE: frontend\src\components\modals\CloseCaseModal.tsx
==================================================

// frontend/src/components/modals/CloseCaseModal.tsx
import { useForm, type SubmitHandler, Controller } from 'react-hook-form' //
import { zodResolver } from '@hookform/resolvers/zod'
import { useMutation, useQueryClient } from '@tanstack/react-query'
import { toast } from 'sonner'
import { z } from 'zod' //
import { Loader2 } from 'lucide-react' //

import { api } from '@/lib/api' //
import { getErrorMessage } from '@/utils/error' //
import { closeCaseFormSchema } from '@/schemas/caseSchemas' //
import { MOTIVOS_DESLIGAMENTO } from '@/constants/caseConstants' //
import { Button } from '@/components/ui/button' //
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogDescription,
  DialogFooter,
} from '@/components/ui/dialog' //
import { Textarea } from '@/components/ui/textarea' //
import { Label } from '@/components/ui/label' //
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select' //

type CloseCaseFormData = z.infer<typeof closeCaseFormSchema> //

interface CloseCaseModalProps {
  caseId: string
  isOpen: boolean
  onOpenChange: (open: boolean) => void
}

export function CloseCaseModal({ caseId, isOpen, onOpenChange }: CloseCaseModalProps) { //
  const queryClient = useQueryClient()
  const {
    control,
    register,
    handleSubmit,
    formState: { errors },
    reset, // Adicionado para limpar o formul√°rio
  } = useForm<CloseCaseFormData>({
    resolver: zodResolver(closeCaseFormSchema), //
    defaultValues: {
      motivoDesligamento: '',
      parecerFinal: '',
    },
  })

  const { mutate: closeCase, isPending } = useMutation({
    mutationFn: async (data: CloseCaseFormData) => {
      return await api.patch(`/cases/${caseId}/close`, data) //
    },
    onSuccess: () => {
      toast.success('Caso desligado com sucesso!')
      queryClient.invalidateQueries({ queryKey: ['cases'] }) //
      queryClient.invalidateQueries({ queryKey: ['case', caseId] }) //
      onOpenChange(false) //
      reset() // Limpa o formul√°rio
    },
    onError: (error) => {
      toast.error(getErrorMessage(error, 'Falha ao desligar o caso.')) //
    },
  })

  const onSubmit: SubmitHandler<CloseCaseFormData> = (data) => { //
    closeCase(data)
  }

  // Fun√ß√£o para fechar o modal e limpar o formul√°rio
  const handleClose = () => {
    onOpenChange(false)
    reset()
  }

  return (
    <Dialog open={isOpen} onOpenChange={handleClose}>
      <DialogContent>
        <DialogHeader>
          <DialogTitle>Desligar Caso</DialogTitle> {/* */}
          <DialogDescription>
            Para finalizar o caso, por favor, selecione o motivo e insira o
            parecer final.
          </DialogDescription>
        </DialogHeader>
        <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
          <div className="space-y-2">
            <Label htmlFor="motivoDesligamento">Motivo do Desligamento</Label> {/* */}
            <Controller
              name="motivoDesligamento"
              control={control}
              render={({ field }) => (
                <Select onValueChange={field.onChange} value={field.value}>
                  <SelectTrigger id="motivoDesligamento">
                    <SelectValue placeholder="Selecione um motivo..." />
                  </SelectTrigger>
                  <SelectContent>
                    {MOTIVOS_DESLIGAMENTO.map((motivo) => ( //
                      <SelectItem key={motivo} value={motivo}>
                        {motivo}
                      </SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              )}
            />
            {errors.motivoDesligamento && (
              <p className="text-sm text-destructive">
                {errors.motivoDesligamento.message}
              </p>
            )}
          </div>
          <div className="space-y-2">
            <Label htmlFor="parecerFinal">Parecer Final</Label> {/* */}
            <Textarea
              id="parecerFinal"
              rows={5}
              {...register('parecerFinal')}
              placeholder="Descreva o motivo e o parecer t√©cnico para o desligamento..."
            />
            {errors.parecerFinal && (
              <p className="text-sm text-destructive">
                {errors.parecerFinal.message}
              </p>
            )}
          </div>
          <DialogFooter>
            <Button type="button" variant="ghost" onClick={handleClose}>
              Cancelar
            </Button>
            <Button type="submit" variant="destructive" disabled={isPending}>
              {isPending && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
              Confirmar Desligamento
            </Button>
          </DialogFooter>
        </form>
      </DialogContent>
    </Dialog>
  )
}

==================================================
FILE: frontend\src\components\NewAppointmentModal.tsx
==================================================

// frontend/src/components/NewAppointmentModal.tsx
import { useEffect } from 'react'
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'
import { useForm, type SubmitHandler, Controller } from 'react-hook-form'
import { z } from 'zod'
import { zodResolver } from '@hookform/resolvers/zod'
import { toast } from 'sonner'
import { Loader2 } from 'lucide-react'

import { api } from '@/lib/api'
import { getErrorMessage } from '@/utils/error'
import { Button } from '@/components/ui/button'
import {
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogDescription,
  DialogFooter,
} from '@/components/ui/dialog'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Textarea } from '@/components/ui/textarea'
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select'

interface CaseOption {
  id: string
  nomeCompleto: string
}

// Schema do formul√°rio
const appointmentFormSchema = z.object({
  titulo: z.string().min(3, 'O t√≠tulo √© muito curto.'),
  data: z.string().min(1, 'A data √© obrigat√≥ria.'),
  time: z
    .string()
    .regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/, 'Hora inv√°lida.'),
  casoId: z.string().uuid('Selecione um caso v√°lido.'),
  observacoes: z.string().optional(),
})

type AppointmentFormData = z.infer<typeof appointmentFormSchema>

interface NewAppointmentModalProps {
  onOpenChange: (isOpen: boolean) => void
  defaultCaseId?: string | null
}

export function NewAppointmentModal({
  onOpenChange,
  defaultCaseId,
}: NewAppointmentModalProps) {
  const queryClient = useQueryClient()

  // Busca todos os casos (rota ajustada para trazer tudo)
  const { data: casesResponse, isLoading: isLoadingCases } = useQuery<{
    items: CaseOption[]
  }>({
    queryKey: ['cases', 'all'],
    queryFn: async () => {
      const response = await api.get('/cases', {
        params: {
          page: 1,
          pageSize: 9999,
        },
      })
      return response.data
    },
    staleTime: 60_000,
  })

  const cases = casesResponse?.items ?? []

  const {
    control,
    handleSubmit,
    formState: { errors },
    reset,
    setValue,
  } = useForm<AppointmentFormData>({
    resolver: zodResolver(appointmentFormSchema),
    defaultValues: {
      titulo: '',
      data: '',
      time: '',
      casoId: defaultCaseId ?? '',
      observacoes: '',
    },
  })

  // Pr√©-seleciona automaticamente casoId quando passado
  useEffect(() => {
    if (defaultCaseId) {
      setValue('casoId', defaultCaseId)
    }
  }, [defaultCaseId, setValue])

  const { mutate: createAppointment, isPending } = useMutation({
    mutationFn: async (data: AppointmentFormData) => {
      const [hours, minutes] = data.time.split(':').map(Number)
      const appointmentDate = new Date(data.data + 'T00:00:00')
      appointmentDate.setHours(hours, minutes, 0, 0)

      const payload = {
        titulo: data.titulo,
        casoId: data.casoId,
        observacoes: data.observacoes,
        data: appointmentDate.toISOString(),
      }

      return await api.post('/appointments', payload)
    },
    onSuccess: () => {
      toast.success('Agendamento criado com sucesso!')
      queryClient.invalidateQueries({ queryKey: ['appointments'] })
      queryClient.invalidateQueries({ queryKey: ['myAgendaStats'] })
      reset()
      onOpenChange(false)
    },
    onError: (error) => {
      toast.error(getErrorMessage(error, 'Falha ao criar agendamento.'))
    },
  })

  const onSubmit: SubmitHandler<AppointmentFormData> = (data) => {
    createAppointment(data)
  }

  return (
    <DialogContent className="sm:max-w-[500px]">
      <DialogHeader>
        <DialogTitle>Novo Agendamento</DialogTitle>
        <DialogDescription>
          Preencha os dados para criar um novo evento na sua agenda.
        </DialogDescription>
      </DialogHeader>

      <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
        {/* T√≠tulo */}
        <div className="space-y-2">
          <Label htmlFor="titulo">T√≠tulo do Agendamento</Label>
          <Controller
            name="titulo"
            control={control}
            render={({ field }) => <Input id="titulo" {...field} />}
          />
          {errors.titulo && (
            <p className="text-sm text-destructive">
              {errors.titulo.message}
            </p>
          )}
        </div>

        {/* Data e Hora */}
        <div className="grid grid-cols-2 gap-4">
          <div className="space-y-2">
            <Label htmlFor="data">Data</Label>
            <Controller
              name="data"
              control={control}
              render={({ field }) => <Input type="date" id="data" {...field} />}
            />
            {errors.data && (
              <p className="text-sm text-destructive">{errors.data.message}</p>
            )}
          </div>

          <div className="space-y-2">
            <Label htmlFor="time">Hora</Label>
            <Controller
              name="time"
              control={control}
              render={({ field }) => <Input type="time" id="time" {...field} />}
            />
            {errors.time && (
              <p className="text-sm text-destructive">{errors.time.message}</p>
            )}
          </div>
        </div>

        {/* Sele√ß√£o do caso */}
        <div className="space-y-2">
          <Label htmlFor="casoId">Vincular ao Caso</Label>

          <Controller
            name="casoId"
            control={control}
            render={({ field }) => (
              <Select
                onValueChange={field.onChange}
                value={field.value}
                disabled={isLoadingCases || !!defaultCaseId}
              >
                <SelectTrigger id="casoId">
                  <SelectValue
                    placeholder={
                      isLoadingCases ? 'Carregando casos...' : 'Selecione um caso...'
                    }
                  />
                </SelectTrigger>

                <SelectContent>
                  {cases.map((c) => (
                    <SelectItem key={c.id} value={c.id}>
                      {c.nomeCompleto}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            )}
          />

          {errors.casoId && (
            <p className="text-sm text-destructive">{errors.casoId.message}</p>
          )}
        </div>

        {/* Observa√ß√µes */}
        <div className="space-y-2">
          <Label htmlFor="observacoes">Observa√ß√µes (Opcional)</Label>
          <Controller
            name="observacoes"
            control={control}
            render={({ field }) => (
              <Textarea
                id="observacoes"
                placeholder="Detalhes adicionais..."
                className="min-h-[80px]"
                {...field}
              />
            )}
          />
        </div>

        <DialogFooter>
          <Button type="submit" disabled={isPending}>
            {isPending && (
              <Loader2 className="mr-2 h-4 w-4 animate-spin" />
            )}
            Agendar
          </Button>
        </DialogFooter>
      </form>
    </DialogContent>
  )
}


==================================================
FILE: frontend\src\components\NewCaseModal.tsx
==================================================

// frontend/src/components/NewCaseModal.tsx
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogDescription,
} from '@/components/ui/dialog' //
import { useModal } from '@/hooks/useModal' //
import { CaseForm } from './CaseForm' //

export function NewCaseModal() {
  const { isNewCaseModalOpen, closeNewCaseModal } = useModal() //

  return (
    <Dialog
      open={isNewCaseModalOpen} //
      onOpenChange={(open) => {
        // Se o modal est√° tentando fechar (open = false), fechamos via hook
        if (!open) closeNewCaseModal() //
      }}
    >
      <DialogContent className="sm:max-w-[900px] p-0"> {/* Remove padding padr√£o para layout customizado */}
        <DialogHeader className="p-6 pb-2"> {/* Padding espec√≠fico para o header */}
          <DialogTitle>Novo Caso</DialogTitle>
          <DialogDescription>
            Preencha os dados abaixo para registar um novo atendimento.
          </DialogDescription>
        </DialogHeader>

        {/* Conte√∫do com scroll interno e Header fixo */}
        <div className="max-h-[80vh] overflow-y-auto px-6 pb-6"> {/* */}
          <CaseForm onCaseCreated={closeNewCaseModal} />
        </div>
      </DialogContent>
    </Dialog>
  )
}

==================================================
FILE: frontend\src\components\Pagination.tsx
==================================================

// frontend/src/components/Pagination.tsx
import {
  ChevronLeft,
  ChevronRight,
  ChevronsLeft,
  ChevronsRight,
} from 'lucide-react'

import { Button } from '@/components/ui/button'

interface PaginationProps {
  currentPage: number
  totalPages: number
  totalItems: number
  pageSize: number
  onPageChange: (page: number) => void
}

export function Pagination({
  currentPage,
  totalPages,
  totalItems,
  pageSize,
  onPageChange,
}: PaginationProps) {
  // --- SANITIZA√á√ÉO DOS VALORES ---
  const safeTotalPages = Math.max(1, totalPages || 1)
  const safePage = Math.max(1, Math.min(currentPage || 1, safeTotalPages))

  const firstItem = Math.min((safePage - 1) * pageSize + 1, totalItems)
  const lastItem = Math.min(safePage * pageSize, totalItems)

  if (safeTotalPages <= 1) return null

  return (
    <div className="flex items-center justify-between px-2 w-full">
      
      {/* Informa√ß√£o da tabela */}
      <div className="flex-1 text-sm text-muted-foreground hidden sm:block">
        Mostrando {firstItem}‚Äì{lastItem} de {totalItems} resultados
      </div>

      <div className="flex items-center space-x-6 lg:space-x-8">
        
        {/* Status da p√°gina */}
        <div className="flex w-[100px] items-center justify-center text-sm font-medium">
          P√°gina {safePage} de {safeTotalPages}
        </div>

        {/* Controles */}
        <div className="flex items-center space-x-2">

          <Button
            variant="outline"
            className="hidden h-8 w-8 p-0 lg:flex"
            onClick={() => onPageChange(1)}
            disabled={safePage <= 1}
            aria-label="Ir para a primeira p√°gina"
          >
            <ChevronsLeft className="h-4 w-4" />
          </Button>

          <Button
            variant="outline"
            className="h-8 w-8 p-0"
            onClick={() => onPageChange(safePage - 1)}
            disabled={safePage <= 1}
            aria-label="P√°gina anterior"
          >
            <ChevronLeft className="h-4 w-4" />
          </Button>

          <Button
            variant="outline"
            className="h-8 w-8 p-0"
            onClick={() => onPageChange(safePage + 1)}
            disabled={safePage >= safeTotalPages}
            aria-label="Pr√≥xima p√°gina"
          >
            <ChevronRight className="h-4 w-4" />
          </Button>

          <Button
            variant="outline"
            className="hidden h-8 w-8 p-0 lg:flex"
            onClick={() => onPageChange(safeTotalPages)}
            disabled={safePage >= safeTotalPages}
            aria-label="Ir para a √∫ltima p√°gina"
          >
            <ChevronsRight className="h-4 w-4" />
          </Button>

        </div>
      </div>
    </div>
  )
}


==================================================
FILE: frontend\src\components\RmaReport.tsx
==================================================

// frontend/src/components/RmaReport.tsx
import { useState } from 'react'
import { useQuery } from '@tanstack/react-query'
import { format } from 'date-fns'
import { ptBR } from 'date-fns/locale'
import { Loader2 } from 'lucide-react'
import { toast } from 'sonner'

import { api } from '@/lib/api'
import {
  Card,
  CardContent,
  CardHeader,
  CardTitle,
  CardDescription,
} from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table'

interface RmaData {
  initialCount: number
  newEntries: number
  closedCases: number
  finalCount: number
  profileBySex: {
    masculino: number
    feminino: number
    outro: number
  }
  profileByAgeGroup: {
    '0-6': number
    '7-12': number
    '13-17': number
    '18-29': number
    '30-59': number
    '60+': number
  }
}

export function RmaReport() {
  const [selectedMonth, setSelectedMonth] = useState(
    format(new Date(), 'yyyy-MM')
  )

  const {
    data: rmaData,
    isLoading,
    isError,
    refetch,
    isFetched,
  } = useQuery<RmaData>({
    queryKey: ['rmaReport', selectedMonth],
    queryFn: async () => {
      const response = await api.get('/reports/rma', {
        params: { month: selectedMonth },
      })
      return response.data
    },
    enabled: false,
  })

  const handleGenerateReport = async () => {
    if (!selectedMonth) {
      toast.warning("Selecione um m√™s v√°lido.")
      return
    }

    const result = await refetch()

    if (result.isError) {
      toast.error("Falha ao gerar relat√≥rio.")
    }
  }

  // Gerar data segura para nome do m√™s
  const [year, month] = selectedMonth.split('-').map(Number)
  const monthDate = new Date(year, (month ?? 1) - 1, 1)
  const monthName = format(monthDate, 'MMMM \'de\' yyyy', { locale: ptBR })

  return (
    <Card className="mt-6">
      <CardHeader>
        <CardTitle>Gera√ß√£o do RMA (Relat√≥rio Mensal)</CardTitle>
        <CardDescription>
          Selecione o m√™s de refer√™ncia para gerar os dados consolidados do PAEFI.
        </CardDescription>
      </CardHeader>

      <CardContent>
        {/* Controles */}
        <div className="flex flex-col sm:flex-row sm:items-end gap-4 mb-6 p-4 border rounded-lg bg-muted/50">
          <div className="space-y-2 flex-1">
            <Label htmlFor="month">M√™s de Refer√™ncia</Label>
            <Input
              id="month"
              type="month"
              value={selectedMonth}
              onChange={(e: React.ChangeEvent<HTMLInputElement>) => setSelectedMonth(e.target.value)}
/>
          </div>

          <Button
            onClick={handleGenerateReport}
            disabled={isLoading}
            className="w-full sm:w-auto"
          >
            {isLoading && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
            Gerar Relat√≥rio
          </Button>
        </div>

        {/* Loading */}
        {isLoading && (
          <div className="flex justify-center items-center py-10">
            <Loader2 className="h-8 w-8 animate-spin text-primary" />
          </div>
        )}

        {/* Erro */}
        {isError && (
          <p className="text-destructive text-center py-10">
            Ocorreu um erro ao gerar o relat√≥rio.
          </p>
        )}

        {/* Estado inicial */}
        {!isLoading && !rmaData && !isFetched && (
          <p className="text-center text-muted-foreground py-10">
            Selecione um m√™s e clique em <strong>Gerar Relat√≥rio</strong>.
          </p>
        )}

        {/* Relat√≥rio */}
        {rmaData && (
          <div className="space-y-6 animate-fade-in">
            <h3 className="font-bold text-lg text-primary border-b pb-2">
              Resultado do RMA para {monthName}
            </h3>

            {/* Bloco B */}
            <div>
              <h4 className="font-semibold mb-2 text-sm text-muted-foreground">
                Bloco B: Movimenta√ß√£o de Usu√°rios
              </h4>
              <div className="rounded-md border">
                <Table>
                  <TableHeader>
                    <TableRow>
                      <TableHead>Indicador</TableHead>
                      <TableHead className="text-right w-[100px]">Total</TableHead>
                    </TableRow>
                  </TableHeader>
                  <TableBody>
                    <TableRow>
                      <TableCell>B1. Em acompanhamento no in√≠cio</TableCell>
                      <TableCell className="text-right font-bold">
                        {rmaData.initialCount}
                      </TableCell>
                    </TableRow>
                    <TableRow>
                      <TableCell>B2. Novos inseridos no m√™s</TableCell>
                      <TableCell className="text-right font-bold">
                        {rmaData.newEntries}
                      </TableCell>
                    </TableRow>
                    <TableRow>
                      <TableCell>B3. Desligados no m√™s</TableCell>
                      <TableCell className="text-right font-bold">
                        {rmaData.closedCases}
                      </TableCell>
                    </TableRow>
                    <TableRow className="bg-muted/50">
                      <TableCell className="font-medium">
                        B4. Total final (B1+B2-B3)
                      </TableCell>
                      <TableCell className="text-right font-bold text-primary">
                        {rmaData.finalCount}
                      </TableCell>
                    </TableRow>
                  </TableBody>
                </Table>
              </div>
            </div>

            {/* Bloco C */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {/* Sexo */}
              <div>
                <h4 className="font-semibold mb-2 text-sm text-muted-foreground">
                  C1. Perfil por Sexo
                </h4>
                <div className="rounded-md border">
                  <Table>
                    <TableHeader>
                      <TableRow>
                        <TableHead>Sexo</TableHead>
                        <TableHead className="text-right w-[80px]">Total</TableHead>
                      </TableRow>
                    </TableHeader>
                    <TableBody>
                      <TableRow>
                        <TableCell>Masculino</TableCell>
                        <TableCell className="text-right">
                          {rmaData.profileBySex.masculino}
                        </TableCell>
                      </TableRow>
                      <TableRow>
                        <TableCell>Feminino</TableCell>
                        <TableCell className="text-right">
                          {rmaData.profileBySex.feminino}
                        </TableCell>
                      </TableRow>
                      <TableRow>
                        <TableCell>Outro/N√£o informado</TableCell>
                        <TableCell className="text-right">
                          {rmaData.profileBySex.outro}
                        </TableCell>
                      </TableRow>
                    </TableBody>
                  </Table>
                </div>
              </div>

              {/* Faixa et√°ria */}
              <div>
                <h4 className="font-semibold mb-2 text-sm text-muted-foreground">
                  C2. Perfil por Faixa Et√°ria
                </h4>
                <div className="rounded-md border">
                  <Table>
                    <TableHeader>
                      <TableRow>
                        <TableHead>Faixa Et√°ria</TableHead>
                        <TableHead className="text-right w-[80px]">Total</TableHead>
                      </TableRow>
                    </TableHeader>
                    <TableBody>
                      {Object.entries(rmaData.profileByAgeGroup).map(([range, value]) => (
                        <TableRow key={range}>
                          <TableCell>{range.replace('-', ' a ') + (range === '60+' ? ' anos ou mais' : ' anos')}</TableCell>
                          <TableCell className="text-right">{value}</TableCell>
                        </TableRow>
                      ))}
                    </TableBody>
                  </Table>
                </div>
              </div>
            </div>
          </div>
        )}
      </CardContent>
    </Card>
  )
}


==================================================
FILE: frontend\src\components\theme-provider.tsx
==================================================

// frontend/src/components/theme-provider.tsx
import {
  createContext,
  useContext,
  useEffect,
  useLayoutEffect,
  useState,
} from "react"

type Theme = "dark" | "light" | "system"

interface ThemeProviderProps {
  children: React.ReactNode
  defaultTheme?: Theme
  storageKey?: string
}

interface ThemeProviderState {
  theme: Theme
  setTheme: (theme: Theme) => void
}

const ThemeContext = createContext<ThemeProviderState | undefined>(undefined)

export function ThemeProvider({
  children,
  defaultTheme = "system",
  storageKey = "vite-ui-theme",
}: ThemeProviderProps) {
  const [theme, setTheme] = useState<Theme>(defaultTheme)

  // Carregar tema salvo (evita acessar localStorage no SSR)
  useEffect(() => {
    const stored = localStorage.getItem(storageKey) as Theme | null
    if (stored) setTheme(stored)
  }, [storageKey])

  // Aplicar tema ao DOM
  useLayoutEffect(() => {
    const root = document.documentElement
    root.classList.remove("light", "dark")

    if (theme === "system") {
      const systemPrefersDark = window.matchMedia(
        "(prefers-color-scheme: dark)"
      ).matches

      root.classList.add(systemPrefersDark ? "dark" : "light")
      return
    }

    root.classList.add(theme)
  }, [theme])

  // Atualizar tema se usu√°rio alterar tema do sistema
  useEffect(() => {
    if (theme !== "system") return

    const media = window.matchMedia("(prefers-color-scheme: dark)")
    const handler = () => {
      setTheme("system") // for√ßa recalcular
    }
    media.addEventListener("change", handler)

    return () => media.removeEventListener("change", handler)
  }, [theme])

  const value: ThemeProviderState = {
    theme,
    setTheme: (newTheme: Theme) => {
      localStorage.setItem(storageKey, newTheme)
      setTheme(newTheme)
    },
  }

  return (
    <ThemeContext.Provider value={value}>
      {children}
    </ThemeContext.Provider>
  )
}

export function useTheme() {
  const context = useContext(ThemeContext)
  if (!context) {
    throw new Error("useTheme must be used within a ThemeProvider")
  }
  return context
}


==================================================
FILE: frontend\src\components\ThemeToggle.tsx
==================================================

// frontend/src/components/ThemeToggle.tsx
import { Moon, Sun, Monitor } from "lucide-react"
import { Button } from "@/components/ui/button"
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu"
import { useTheme } from "@/components/theme-provider"

export function ThemeToggle() {
  const { theme, setTheme } = useTheme()

  return (
    <DropdownMenu>
      <DropdownMenuTrigger asChild>
        <Button
          variant="outline"
          size="icon"
          className="relative transition-colors"
          aria-label="Alternar tema"
        >
          <Sun className="h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-transform duration-300 dark:-rotate-90 dark:scale-0" />
          <Moon className="absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-transform duration-300 dark:rotate-0 dark:scale-100" />
        </Button>
      </DropdownMenuTrigger>

      <DropdownMenuContent align="end" className="w-36">
        <DropdownMenuItem
          onClick={() => setTheme("light")}
          className={theme === "light" ? "font-semibold text-primary" : ""}
        >
          <Sun className="mr-2 h-4 w-4" />
          Claro
        </DropdownMenuItem>

        <DropdownMenuItem
          onClick={() => setTheme("dark")}
          className={theme === "dark" ? "font-semibold text-primary" : ""}
        >
          <Moon className="mr-2 h-4 w-4" />
          Escuro
        </DropdownMenuItem>

        <DropdownMenuItem
          onClick={() => setTheme("system")}
          className={theme === "system" ? "font-semibold text-primary" : ""}
        >
          <Monitor className="mr-2 h-4 w-4" />
          Sistema
        </DropdownMenuItem>
      </DropdownMenuContent>
    </DropdownMenu>
  )
}


==================================================
FILE: frontend\src\components\ui\accordion.tsx
==================================================

// frontend/src/components/ui/accordion.tsx
import * as React from "react"
import * as AccordionPrimitive from "@radix-ui/react-accordion"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const Accordion = AccordionPrimitive.Root

const AccordionItem = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>
>(({ className, ...props }, ref) => (
  <AccordionPrimitive.Item
    ref={ref}
    className={cn("border-b", className)}
    {...props}
  />
))
AccordionItem.displayName = "AccordionItem"

const AccordionTrigger = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Header className="flex">
    <AccordionPrimitive.Trigger
      ref={ref}
      className={cn(
        "flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",
        className
      )}
      {...props}
    >
      {children}
      <ChevronDown className="h-4 w-4 shrink-0 transition-transform duration-200" />
    </AccordionPrimitive.Trigger>
  </AccordionPrimitive.Header>
))
AccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName

const AccordionContent = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Content
    ref={ref}
    className="overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down"
    {...props}
  >
    <div className={cn("pb-4 pt-0", className)}>{children}</div>
  </AccordionPrimitive.Content>
))
AccordionContent.displayName = AccordionPrimitive.Content.displayName

export { Accordion, AccordionItem, AccordionTrigger, AccordionContent }


==================================================
FILE: frontend\src\components\ui\alert-dialog.tsx
==================================================

// frontend/src/components/ui/alert-dialog.tsx
import * as React from "react"
import * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog"

import { cn } from "@/lib/utils"
import { buttonVariants } from "@/components/ui/button"

const AlertDialog = AlertDialogPrimitive.Root
const AlertDialogTrigger = AlertDialogPrimitive.Trigger
const AlertDialogPortal = AlertDialogPrimitive.Portal

const AlertDialogOverlay = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
    ref={ref}
  />
))
AlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName

const AlertDialogContent = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>
>(({ className, ...props }, ref) => (
  <AlertDialogPortal>
    <AlertDialogOverlay />
    <AlertDialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-card p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    />
  </AlertDialogPortal>
))
AlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName

const AlertDialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
AlertDialogHeader.displayName = "AlertDialogHeader"

const AlertDialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
AlertDialogFooter.displayName = "AlertDialogFooter"

const AlertDialogTitle = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold", className)}
    {...props}
  />
))
AlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName

const AlertDialogDescription = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
AlertDialogDescription.displayName =
  AlertDialogPrimitive.Description.displayName

const AlertDialogAction = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Action>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Action
    ref={ref}
    className={cn(buttonVariants(), className)}
    {...props}
  />
))
AlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName

const AlertDialogCancel = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Cancel
    ref={ref}
    className={cn(
      buttonVariants({ variant: "outline" }),
      "mt-2 sm:mt-0",
      className
    )}
    {...props}
  />
))
AlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName

export {
  AlertDialog,
  AlertDialogPortal,
  AlertDialogOverlay,
  AlertDialogTrigger,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogFooter,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogAction,
  AlertDialogCancel,
}


==================================================
FILE: frontend\src\components\ui\badge.tsx
==================================================

import { cn } from "@/lib/utils"

export function Badge({ className, variant = "info", ...props }: any) {
  const variants: any = {
    info: "bg-primary text-white",
    success: "bg-green-600 text-white",
    warning: "bg-yellow-500 text-white",
    danger: "bg-red-600 text-white",
    muted: "bg-muted text-foreground",
  }

  return (
    <span
      className={cn(
        "inline-flex items-center px-2 py-0.5 text-xs font-semibold rounded-md",
        variants[variant],
        className
      )}
      {...props}
    />
  )
}


==================================================
FILE: frontend\src\components\ui\button.tsx
==================================================

// frontend/src/components/ui/button.tsx
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive:
          "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline:
          "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button"
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    )
  }
)
Button.displayName = "Button"

export { Button, buttonVariants }


==================================================
FILE: frontend\src\components\ui\card.tsx
==================================================

import * as React from "react"
import { cn } from "@/lib/utils"

/**
 * CARD ‚Äî GOV-BR Moderno
 * --------------------------------------------------
 * ‚Ä¢ Bordas suaves (radius baseado no theme)
 * ‚Ä¢ Sombra leve e consistente
 * ‚Ä¢ Transi√ß√£o suave para hover
 * ‚Ä¢ Corre√ß√µes de hierarquia tipogr√°fica
 */

const Card = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "rounded-xl border bg-card text-card-foreground shadow-sm",
      "transition-all duration-200 hover:shadow-md hover:border-primary/40",
      className
    )}
    {...props}
  />
))
Card.displayName = "Card"

const CardHeader = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "flex flex-col space-y-1.5 p-6 pb-3",
      "bg-gradient-to-b from-background to-muted/20 rounded-t-xl",
      className
    )}
    {...props}
  />
))
CardHeader.displayName = "CardHeader"

const CardTitle = React.forwardRef<
  HTMLHeadingElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h3
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      "text-foreground",
      className
    )}
    {...props}
  />
))
CardTitle.displayName = "CardTitle"

const CardDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <p
    ref={ref}
    className={cn(
      "text-sm text-muted-foreground",
      "leading-relaxed",
      className
    )}
    {...props}
  />
))
CardDescription.displayName = "CardDescription"

const CardContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("p-6 pt-0", className)}
    {...props}
  />
))
CardContent.displayName = "CardContent"

const CardFooter = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex items-center p-6 pt-0", className)}
    {...props}
  />
))
CardFooter.displayName = "CardFooter"

export {
  Card,
  CardHeader,
  CardFooter,
  CardTitle,
  CardDescription,
  CardContent
}


==================================================
FILE: frontend\src\components\ui\checkbox.tsx
==================================================

// frontend/src/components/ui/checkbox.tsx
import * as React from "react"
import * as CheckboxPrimitive from "@radix-ui/react-checkbox"
import { Check } from "lucide-react"

import { cn } from "@/lib/utils"

const Checkbox = React.forwardRef<
  React.ElementRef<typeof CheckboxPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>
>(({ className, ...props }, ref) => (
  <CheckboxPrimitive.Root
    ref={ref}
    className={cn(
      "peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",
      className
    )}
    {...props}
  >
    <CheckboxPrimitive.Indicator
      className={cn("flex items-center justify-center text-current")}
    >
      <Check className="h-4 w-4" />
    </CheckboxPrimitive.Indicator>
  </CheckboxPrimitive.Root>
))
Checkbox.displayName = CheckboxPrimitive.Root.displayName

export { Checkbox }

==================================================
FILE: frontend\src\components\ui\command.tsx
==================================================

import * as React from "react"
import { type DialogProps } from "@radix-ui/react-dialog"
import { Command as CommandPrimitive } from "cmdk"
import { Search } from "lucide-react"

import { cn } from "@/lib/utils"
import { Dialog, DialogContent } from "@/components/ui/dialog"

const Command = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive>
>(({ className, ...props }, ref) => (
  <CommandPrimitive
    ref={ref}
    className={cn(
      "flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",
      className
    )}
    {...props}
  />
))
Command.displayName = CommandPrimitive.displayName

const CommandDialog = ({ children, ...props }: DialogProps) => {
  return (
    <Dialog {...props}>
      <DialogContent className="overflow-hidden p-0">
        <Command className="[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5">
          {children}
        </Command>
      </DialogContent>
    </Dialog>
  )
}

const CommandInput = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Input>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>
>(({ className, ...props }, ref) => (
  <div className="flex items-center border-b px-3" cmdk-input-wrapper="">
    <Search className="mr-2 h-4 w-4 shrink-0 opacity-50" />
    <CommandPrimitive.Input
      ref={ref}
      className={cn(
        "flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    />
  </div>
))

CommandInput.displayName = CommandPrimitive.Input.displayName

const CommandList = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.List
    ref={ref}
    className={cn("max-h-[300px] overflow-y-auto overflow-x-hidden", className)}
    {...props}
  />
))

CommandList.displayName = CommandPrimitive.List.displayName

const CommandEmpty = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Empty>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>
>((props, ref) => (
  <CommandPrimitive.Empty
    ref={ref}
    className="py-6 text-center text-sm"
    {...props}
  />
))

CommandEmpty.displayName = CommandPrimitive.Empty.displayName

const CommandGroup = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Group>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Group
    ref={ref}
    className={cn(
      "overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",
      className
    )}
    {...props}
  />
))

CommandGroup.displayName = CommandPrimitive.Group.displayName

const CommandSeparator = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 h-px bg-border", className)}
    {...props}
  />
))
CommandSeparator.displayName = CommandPrimitive.Separator.displayName

const CommandItem = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
      className
    )}
    {...props}
  />
))

CommandItem.displayName = CommandPrimitive.Item.displayName

const CommandShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
CommandShortcut.displayName = "CommandShortcut"

export {
  Command,
  CommandDialog,
  CommandInput,
  CommandList,
  CommandEmpty,
  CommandGroup,
  CommandItem,
  CommandShortcut,
  CommandSeparator,
}


==================================================
FILE: frontend\src\components\ui\dialog.tsx
==================================================

// frontend/src/components/ui/dialog.tsx
import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const Dialog = DialogPrimitive.Root
const DialogTrigger = DialogPrimitive.Trigger
const DialogPortal = DialogPrimitive.Portal
const DialogClose = DialogPrimitive.Close

const DialogOverlay = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Overlay
    ref={ref}
    className={cn(
      "fixed inset-0 z-50 bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
  />
))
DialogOverlay.displayName = DialogPrimitive.Overlay.displayName

const DialogContent = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DialogPortal>
    <DialogOverlay />
    <DialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-card p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    >
      {children}
      <DialogPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </DialogPrimitive.Close>
    </DialogPrimitive.Content>
  </DialogPortal>
))
DialogContent.displayName = DialogPrimitive.Content.displayName

const DialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-1.5 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
DialogHeader.displayName = "DialogHeader"

const DialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
DialogFooter.displayName = "DialogFooter"

const DialogTitle = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
DialogTitle.displayName = DialogPrimitive.Title.displayName

const DialogDescription = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
DialogDescription.displayName = DialogPrimitive.Description.displayName

export {
  Dialog,
  DialogPortal,
  DialogOverlay,
  DialogClose,
  DialogTrigger,
  DialogContent,
  DialogHeader,
  DialogFooter,
  DialogTitle,
  DialogDescription,
}


==================================================
FILE: frontend\src\components\ui\dropdown-menu.tsx
==================================================

// frontend/src/components/ui/dropdown-menu.tsx
import * as React from "react"
import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu"

import { cn } from "@/lib/utils"

const DropdownMenu = DropdownMenuPrimitive.Root
const DropdownMenuTrigger = DropdownMenuPrimitive.Trigger
const DropdownMenuGroup = DropdownMenuPrimitive.Group
const DropdownMenuPortal = DropdownMenuPrimitive.Portal
const DropdownMenuSub = DropdownMenuPrimitive.Sub
const DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup

const DropdownMenuContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <DropdownMenuPrimitive.Portal>
    <DropdownMenuPrimitive.Content
      ref={ref}
      sideOffset={sideOffset}
      className={cn(
        "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </DropdownMenuPrimitive.Portal>
))
DropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName

const DropdownMenuItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName

export {
  DropdownMenu,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuGroup,
  DropdownMenuPortal,
  DropdownMenuSub,
  DropdownMenuRadioGroup,
}


==================================================
FILE: frontend\src\components\ui\form.tsx
==================================================

"use client"

import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { Slot } from "@radix-ui/react-slot"
import {
  Controller,
  FormProvider,
  useFormContext,
  type ControllerProps,
  type FieldPath,
  type FieldValues,
} from "react-hook-form"

import { cn } from "@/lib/utils"
import { Label } from "@/components/ui/label"

const Form = FormProvider

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
> = {
  name: TName
}

const FormFieldContext = React.createContext<FormFieldContextValue | null>(null)

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  )
}

const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext)
  const itemContext = React.useContext(FormItemContext)
  const { getFieldState, formState } = useFormContext()

  if (!fieldContext) {
    throw new Error("useFormField should be used within <FormField>")
  }

  if (!itemContext) {
    throw new Error("useFormField should be used within <FormItem>")
  }

  const fieldState = getFieldState(fieldContext.name, formState)

  const { id } = itemContext

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  }
}

type FormItemContextValue = {
  id: string
}

const FormItemContext = React.createContext<FormItemContextValue | null>(null)

const FormItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const id = React.useId()

  return (
    <FormItemContext.Provider value={{ id }}>
      <div ref={ref} className={cn("space-y-2", className)} {...props} />
    </FormItemContext.Provider>
  )
})
FormItem.displayName = "FormItem"

const FormLabel = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>
>(({ className, ...props }, ref) => {
  const { error, formItemId } = useFormField()

  return (
    <Label
      ref={ref}
      className={cn(error && "text-destructive", className)}
      htmlFor={formItemId}
      {...props}
    />
  )
})
FormLabel.displayName = "FormLabel"

const FormControl = React.forwardRef<
  React.ElementRef<typeof Slot>,
  React.ComponentPropsWithoutRef<typeof Slot>
>(({ ...props }, ref) => {
  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()

  return (
    <Slot
      ref={ref}
      id={formItemId}
      aria-describedby={
        !error
          ? `${formDescriptionId}`
          : `${formDescriptionId} ${formMessageId}`
      }
      aria-invalid={!!error}
      {...props}
    />
  )
})
FormControl.displayName = "FormControl"

const FormDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => {
  const { formDescriptionId } = useFormField()

  return (
    <p
      ref={ref}
      id={formDescriptionId}
      className={cn("text-[0.8rem] text-muted-foreground", className)}
      {...props}
    />
  )
})
FormDescription.displayName = "FormDescription"

const FormMessage = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, children, ...props }, ref) => {
  const { error, formMessageId } = useFormField()
  const body = error ? String(error?.message ?? "") : children

  if (!body) {
    return null
  }

  return (
    <p
      ref={ref}
      id={formMessageId}
      className={cn("text-[0.8rem] font-medium text-destructive", className)}
      {...props}
    >
      {body}
    </p>
  )
})
FormMessage.displayName = "FormMessage"

export {
  useFormField,
  Form,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
  FormField,
}


==================================================
FILE: frontend\src\components\ui\input.tsx
==================================================

import { cn } from "@/lib/utils"

export function Input({ className, ...props }: any) {
  return (
    <input
      className={cn(
        "h-10 w-full rounded-md border border-border bg-white px-3 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/60 disabled:bg-muted",
        className
      )}
      {...props}
    />
  )
}


==================================================
FILE: frontend\src\components\ui\label.tsx
==================================================

import { cn } from "@/lib/utils"

export function Label({ className, ...props }: any) {
  return (
    <label
      className={cn("text-sm font-medium text-foreground", className)}
      {...props}
    />
  )
}


==================================================
FILE: frontend\src\components\ui\pagination.tsx
==================================================

// frontend/src/components/ui/pagination.tsx
import * as React from "react"
import { ChevronLeft, ChevronRight, MoreHorizontal } from "lucide-react"

import { cn } from "@/lib/utils"
import { ButtonProps, buttonVariants } from "@/components/ui/button"

const Pagination = ({ className, ...props }: React.ComponentProps<"nav">) => (
  <nav
    role="navigation"
    aria-label="pagination"
    className={cn("mx-auto flex w-full justify-center", className)}
    {...props}
  />
)
Pagination.displayName = "Pagination"

const PaginationContent = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    className={cn("flex flex-row items-center gap-1", className)}
    {...props}
  />
))
PaginationContent.displayName = "PaginationContent"

const PaginationItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ className, ...props }, ref) => (
  <li ref={ref} className={cn("", className)} {...props} />
))
PaginationItem.displayName = "PaginationItem"

type PaginationLinkProps = {
  isActive?: boolean
} & Pick<ButtonProps, "size"> &
  React.ComponentProps<"a">

const PaginationLink = ({
  className,
  isActive,
  size = "icon",
  ...props
}: PaginationLinkProps) => (
  <a
    aria-current={isActive ? "page" : undefined}
    className={cn(
      buttonVariants({
        variant: isActive ? "outline" : "ghost",
        size,
      }),
      className
    )}
    {...props}
  />
)
PaginationLink.displayName = "PaginationLink" // Corre√ß√£o aqui

const PaginationPrevious = ({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink
    aria-label="Go to previous page"
    size="default"
    className={cn("gap-1 pl-2.5", className)}
    {...props}
  >
    <ChevronLeft className="h-4 w-4" />
    <span>Anterior</span>
  </PaginationLink>
)
PaginationPrevious.displayName = "PaginationPrevious"

const PaginationNext = ({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink
    aria-label="Go to next page"
    size="default"
    className={cn("gap-1 pr-2.5", className)}
    {...props}
  >
    <span>Pr√≥xima</span>
    <ChevronRight className="h-4 w-4" />
  </PaginationLink>
)
PaginationNext.displayName = "PaginationNext"

const PaginationEllipsis = ({
  className,
  ...props
}: React.ComponentProps<"span">) => (
  <span
    aria-hidden
    className={cn("flex h-9 w-9 items-center justify-center", className)}
    {...props}
  >
    <MoreHorizontal className="h-4 w-4" />
    <span className="sr-only">More pages</span>
  </span>
)
PaginationEllipsis.displayName = "PaginationEllipsis"

export {
  Pagination,
  PaginationContent,
  PaginationEllipsis,
  PaginationItem,
  PaginationLink,
  PaginationNext,
  PaginationPrevious,
}



==================================================
FILE: frontend\src\components\ui\popover.tsx
==================================================

import * as React from "react"
import * as PopoverPrimitive from "@radix-ui/react-popover"

import { cn } from "@/lib/utils"

const Popover = PopoverPrimitive.Root

const PopoverTrigger = PopoverPrimitive.Trigger

const PopoverAnchor = PopoverPrimitive.Anchor

const PopoverContent = React.forwardRef<
  React.ElementRef<typeof PopoverPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <PopoverPrimitive.Portal>
    <PopoverPrimitive.Content
      ref={ref}
      align={align}
      sideOffset={sideOffset}
      className={cn(
        "z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",
        className
      )}
      {...props}
    />
  </PopoverPrimitive.Portal>
))
PopoverContent.displayName = PopoverPrimitive.Content.displayName

export { Popover, PopoverTrigger, PopoverContent, PopoverAnchor }


==================================================
FILE: frontend\src\components\ui\scroll-area.tsx
==================================================

import * as React from "react"
import * as ScrollAreaPrimitive from "@radix-ui/react-scroll-area"

import { cn } from "@/lib/utils"

const ScrollArea = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <ScrollAreaPrimitive.Root
    ref={ref}
    className={cn("relative overflow-hidden", className)}
    {...props}
  >
    <ScrollAreaPrimitive.Viewport className="h-full w-full rounded-[inherit]">
      {children}
    </ScrollAreaPrimitive.Viewport>
    <ScrollAreaPrimitive.Scrollbar
      orientation="vertical"
      className="flex touch-none select-none p-0.5"
    >
      <ScrollAreaPrimitive.Thumb className="flex-1 rounded-full bg-border" />
    </ScrollAreaPrimitive.Scrollbar>
    <ScrollAreaPrimitive.Corner />
  </ScrollAreaPrimitive.Root>
))
ScrollArea.displayName = ScrollAreaPrimitive.Root.displayName

export { ScrollArea }


==================================================
FILE: frontend\src\components\ui\select.tsx
==================================================

// frontend/src/components/ui/select.tsx
import * as React from "react"
import * as SelectPrimitive from "@radix-ui/react-select"
import { Check, ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const Select = SelectPrimitive.Root

const SelectGroup = SelectPrimitive.Group

const SelectValue = SelectPrimitive.Value

const SelectTrigger = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
      className
    )}
    {...props}
  >
    {children}
    <SelectPrimitive.Icon asChild>
      <ChevronDown className="h-4 w-4 opacity-50" />
    </SelectPrimitive.Icon>
  </SelectPrimitive.Trigger>
))
SelectTrigger.displayName = SelectPrimitive.Trigger.displayName

const SelectContent = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>
>(({ className, children, position = "popper", ...props }, ref) => (
  <SelectPrimitive.Portal>
    <SelectPrimitive.Content
      ref={ref}
      className={cn(
        "relative z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        position === "popper" &&
          "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
        className
      )}
      position={position}
      {...props}
    >
      <SelectPrimitive.Viewport
        className={cn(
          "p-1",
          position === "popper" &&
            "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"
        )}
      >
        {children}
      </SelectPrimitive.Viewport>
    </SelectPrimitive.Content>
  </SelectPrimitive.Portal>
))
SelectContent.displayName = SelectPrimitive.Content.displayName

const SelectLabel = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Label
    ref={ref}
    className={cn("py-1.5 pl-8 pr-2 text-sm font-semibold", className)}
    {...props}
  />
))
SelectLabel.displayName = SelectPrimitive.Label.displayName

const SelectItem = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <SelectPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </SelectPrimitive.ItemIndicator>
    </span>

    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
  </SelectPrimitive.Item>
))
SelectItem.displayName = SelectPrimitive.Item.displayName

const SelectSeparator = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
SelectSeparator.displayName = SelectPrimitive.Separator.displayName

export {
  Select,
  SelectGroup,
  SelectValue,
  SelectTrigger,
  SelectContent,
  SelectLabel,
  SelectItem,
  SelectSeparator,
}

==================================================
FILE: frontend\src\components\ui\separator.tsx
==================================================

export function Separator({ className = "", ...props }: any) {
  return (
    <div
      className={`w-full h-px bg-border ${className}`}
      {...props}
    />
  )
}


==================================================
FILE: frontend\src\components\ui\sheet.tsx
==================================================

import * as SheetPrimitive from "@radix-ui/react-dialog"
import { cn } from "@/lib/utils"

export function Sheet({ ...props }) {
  return <SheetPrimitive.Root {...props} />
}

export const SheetTrigger = SheetPrimitive.Trigger

export function SheetContent({ side = "left", className, ...props }: any) {
  return (
    <SheetPrimitive.Content
      className={cn(
        "fixed z-50 bg-white shadow-xl border-border border",
        side === "left" && "top-0 left-0 h-full w-72",
        side === "right" && "top-0 right-0 h-full w-72",
        "data-[state=open]:animate-in data-[state=closed]:animate-out",
        className
      )}
      {...props}
    />
  )
}

export const SheetTitle = SheetPrimitive.Title
export const SheetDescription = SheetPrimitive.Description


==================================================
FILE: frontend\src\components\ui\skeleton.tsx
==================================================

// frontend/src/components/ui/skeleton.tsx
import { cn } from "@/lib/utils"

function Skeleton({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div
      className={cn("animate-pulse rounded-md bg-muted", className)}
      {...props}
    />
  )
}

export { Skeleton }


==================================================
FILE: frontend\src\components\ui\sonner.tsx
==================================================

// frontend/src/components/ui/sonner.tsx
import { Toaster as Sonner } from "sonner"

type ToasterProps = React.ComponentProps<typeof Sonner>

const Toaster = ({ ...props }: ToasterProps) => {
  return (
    <Sonner
      theme={'system'}
      className="toaster group"
      toastOptions={{
        classNames: {
          toast:
            "group toast group-[.toaster]:bg-card group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",
          description: "group-[.toast]:text-muted-foreground",
          actionButton:
            "group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",
          cancelButton:
            "group-[.toast]:bg-muted group-[.toast]:text-muted-foreground",
        },
      }}
      {...props}
    />
  )
}

export { Toaster }



==================================================
FILE: frontend\src\components\ui\table.tsx
==================================================

// frontend/src/components/ui/table.tsx
import * as React from "react"

import { cn } from "@/lib/utils"

const Table = React.forwardRef<
  HTMLTableElement,
  React.HTMLAttributes<HTMLTableElement>
>(({ className, ...props }, ref) => (
  <div className="relative w-full overflow-auto">
    <table
      ref={ref}
      className={cn("w-full caption-bottom text-sm", className)}
      {...props}
    />
  </div>
))
Table.displayName = "Table"

const TableHeader = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <thead ref={ref} className={cn("[&_tr]:border-b", className)} {...props} />
))
TableHeader.displayName = "TableHeader"

const TableBody = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tbody
    ref={ref}
    className={cn("[&_tr:last-child]:border-0", className)}
    {...props}
  />
))
TableBody.displayName = "TableBody"

const TableRow = React.forwardRef<
  HTMLTableRowElement,
  React.HTMLAttributes<HTMLTableRowElement>
>(({ className, ...props }, ref) => (
  <tr
    ref={ref}
    className={cn(
      "border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",
      className
    )}
    {...props}
  />
))
TableRow.displayName = "TableRow"

const TableHead = React.forwardRef<
  HTMLTableCellElement,
  React.ThHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <th
    ref={ref}
    className={cn(
      "h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",
      className
    )}
    {...props}
  />
))
TableHead.displayName = "TableHead"

const TableCell = React.forwardRef<
  HTMLTableCellElement,
  React.TdHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <td
    ref={ref}
    className={cn("p-4 align-middle [&:has([role=checkbox])]:pr-0", className)}
    {...props}
  />
))
TableCell.displayName = "TableCell"

export {
  Table,
  TableHeader,
  TableBody,
  TableRow,
  TableHead,
  TableCell,
}


==================================================
FILE: frontend\src\components\ui\tabs.tsx
==================================================

// frontend/src/components/ui/tabs.tsx ‚Äî Componente de abas atualizado, modernizado e com melhorias visuais e acessibilidade.

import * as React from "react"
import * as TabsPrimitive from "@radix-ui/react-tabs"

import { cn } from "@/lib/utils"

// Mant√©m o Root original, pois j√° √© est√°vel e robusto.
const Tabs = TabsPrimitive.Root

/**
 * TabsList ‚Äî Agora com melhor contraste, padding mais equilibrado,
 * suporte a dark mode fluido e bordas suavizadas (rounded-lg).
 */
const TabsList = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.List
    ref={ref}
    className={cn(
      "inline-flex h-10 items-center justify-center rounded-lg bg-muted/60 backdrop-blur-sm p-1 text-muted-foreground shadow-sm",
      "border border-border/40 dark:border-border/20",
      className
    )}
    {...props}
  />
))
TabsList.displayName = TabsPrimitive.List.displayName

/**
 * TabsTrigger ‚Äî Agora com destaque mais elegante quando ativo, transi√ß√£o suave,
 * sombra sutil, foco mais vis√≠vel e comportamento moderno responsivo.
 */
const TabsTrigger = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Trigger
    ref={ref}
    className={cn(
      "inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5",
      "text-sm font-medium transition-all duration-200",
      "focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/40 focus-visible:ring-offset-2",
      "data-[state=active]:bg-background data-[state=active]:text-foreground",
      "data-[state=active]:shadow-md data-[state=active]:border data-[state=active]:border-border/40",
      "hover:bg-accent/50",
      "disabled:pointer-events-none disabled:opacity-50",
      className
    )}
    {...props}
  />
))
TabsTrigger.displayName = TabsPrimitive.Trigger.displayName

/**
 * TabsContent ‚Äî Recebe melhorias de spacing, anima√ß√£o suave de entrada
 * e foco acess√≠vel aprimorado.
 */
const TabsContent = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Content
    ref={ref}
    className={cn(
      "mt-3 outline-none",
      "animate-fade-in data-[state=inactive]:animate-fade-out",
      "focus-visible:ring-2 focus-visible:ring-primary/40 focus-visible:ring-offset-2",
      className
    )}
    {...props}
  />
))
TabsContent.displayName = TabsPrimitive.Content.displayName

export { Tabs, TabsList, TabsTrigger, TabsContent }


==================================================
FILE: frontend\src\components\ui\textarea.tsx
==================================================

// frontend/src/components/ui/textarea.tsx
import * as React from "react"

import { cn } from "@/lib/utils"

export interface TextareaProps
  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}

const Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(
  ({ className, ...props }, ref) => {
    return (
      <textarea
        className={cn(
          "flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Textarea.displayName = "Textarea"

export { Textarea }



==================================================
FILE: frontend\src\components\ui\tooltip.tsx
==================================================

// frontend/src/components/ui/tooltip.tsx
import * as React from "react"
import * as TooltipPrimitive from "@radix-ui/react-tooltip"

import { cn } from "@/lib/utils"

const TooltipProvider = TooltipPrimitive.Provider

const Tooltip = TooltipPrimitive.Root

const TooltipTrigger = TooltipPrimitive.Trigger

const TooltipContent = React.forwardRef<
  React.ElementRef<typeof TooltipPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <TooltipPrimitive.Content
    ref={ref}
    sideOffset={sideOffset}
    className={cn(
      "z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
TooltipContent.displayName = TooltipPrimitive.Content.displayName

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }


==================================================
FILE: frontend\src\components\UpcomingAppointments.tsx
==================================================

// frontend/src/components/UpcomingAppointments.tsx
import { useQuery } from '@tanstack/react-query'
import { api } from '@/lib/api' //
import {
  Card,
  CardContent,
  CardHeader,
  CardTitle,
  CardDescription,
} from '@/components/ui/card' //
import { Skeleton } from '@/components/ui/skeleton'
import { Link } from 'react-router-dom'
import { ROUTES } from '@/constants/routes' //
import { formatDateSafe } from '@/utils/formatters' //
import { format } from 'date-fns'
import { ptBR } from 'date-fns/locale'
import type { UpcomingAppointment } from '@/types/agenda' //

function AppointmentSkeleton() {
  return (
    <div className="space-y-4">
      {Array.from({ length: 3 }).map((_, i) => (
        <div key={i} className="flex items-center gap-4">
          <Skeleton className="h-10 w-10 rounded-md" />
          <div className="space-y-2">
            <Skeleton className="h-4 w-48" />
            <Skeleton className="h-4 w-32" />
          </div>
        </div>
      ))}
    </div>
  )
}

export function UpcomingAppointments() {
  const { data: appointments, isLoading, isError } = useQuery<UpcomingAppointment[]>({
    queryKey: ['myAgendaStats'],
    queryFn: async () => {
      // (Rota GET /stats/my-agenda)
      const response = await api.get('/stats/my-agenda')
      return response.data
    },
    // Recarrega os dados a cada 5 minutos
    staleTime: 1000 * 60 * 5, 
  })

  return (
    <Card>
      <CardHeader>
        <CardTitle>Pr√≥ximos Agendamentos</CardTitle>
        <CardDescription>
          Os seus pr√≥ximos 5 compromissos agendados no sistema.
        </CardDescription>
      </CardHeader>
      <CardContent>
        {isLoading && <AppointmentSkeleton />}
        
        {isError && (
          <p className="text-sm text-destructive">
            N√£o foi poss√≠vel carregar os seus agendamentos.
          </p>
        )}

        {!isLoading && !isError && appointments?.length === 0 && (
          <p className="text-sm text-muted-foreground">
            Voc√™ n√£o tem nenhum agendamento futuro.
          </p>
        )}

        {!isLoading && !isError && appointments && appointments.length > 0 && (
          <ul className="space-y-4">
            {appointments.map((app) => (
              <li key={app.id} className="flex items-center gap-4">
                <div className="flex-none text-center border rounded-md px-3 py-1 bg-muted/30">
                  <span className="block text-xs uppercase text-primary font-semibold">
                    {format(new Date(app.data), 'MMM', { locale: ptBR })}
                  </span>
                  <span className="block text-lg font-bold text-foreground">
                    {format(new Date(app.data), 'dd')}
                  </span>
                </div>
                <div>
                  <p className="font-semibold text-foreground">{app.titulo}</p>
                  <p className="text-sm text-muted-foreground">
                    {/* --- CORRE√á√ÉO AQUI --- */}
                    {/* Agora chamamos a fun√ß√£o ROUTES.CASE_DETAIL(id) */}
                    <Link
                      to={ROUTES.CASE_DETAIL(app.caso.id)} //
                      className="hover:underline hover:text-primary transition-colors"
                    >
                      Caso: {app.caso.nomeCompleto}
                    </Link>
                    {/* --- FIM DA CORRE√á√ÉO --- */}
                  </p>
                  <p className="text-xs text-muted-foreground mt-0.5">
                    {formatDateSafe(app.data)} √†s {format(new Date(app.data), 'HH:mm')}
                  </p>
                </div>
              </li>
            ))}
          </ul>
        )}
      </CardContent>
    </Card>
  )
}

==================================================
FILE: frontend\src\constants\caseConstants.ts
==================================================

// frontend/src/constants/caseConstants.ts

// O mapa √© a "Fonte da Verdade" e usa tokens de cor do tema.
export const CASE_STATUS_MAP = {
  AGUARDANDO_ACOLHIDA: {
    text: 'Aguardando Acolhida',
    style: 'bg-secondary text-secondary-foreground', // Amarelo/Laranja -> Mapeado para Secund√°rio (cinza)
  },
  EM_ACOLHIDA: {
    text: 'Em Acolhida',
    style: 'bg-primary/10 text-primary', // Azul -> Mapeado para Prim√°rio (com opacidade)
  },
  AGUARDANDO_DISTRIBUICAO_PAEFI: {
    text: 'Aguardando Distribui√ß√£o',
    style: 'bg-secondary text-secondary-foreground', // Amarelo/Laranja -> Mapeado para Secund√°rio (cinza)
  },
  EM_ACOMPANHAMENTO_PAEFI: {
    text: 'Acompanhamento PAEFI',
    style: 'bg-primary text-primary-foreground', // Verde -> Mapeado para Prim√°rio (s√≥lido)
  },
  DESLIGADO: {
    text: 'Desligado',
    style: 'bg-muted text-muted-foreground', // Cinza -> Mapeado para Muted
  },
} as const // 'as const' √© crucial para a infer√™ncia de tipo

// O Tipo agora √© inferido automaticamente do mapa
export type CaseStatusIdentifier = keyof typeof CASE_STATUS_MAP
// --- FIM DA SUGEST√ÉO 3 ---

// --- SUGEST√ÉO 1 APLICADA ---
// Helper function para buscar os dados do mapa com seguran√ßa
/**
 * Retorna o texto e a classe de estilo para um determinado status de caso.
 */
export function getCaseStatusInfo(status: string | null | undefined) {
  if (status && status in CASE_STATUS_MAP) {
    // Se o status for v√°lido, retorna suas propriedades
    return CASE_STATUS_MAP[status as CaseStatusIdentifier]
  }
  // Fallback para status desconhecido ou nulo
  return { text: 'Desconhecido', style: 'bg-muted text-muted-foreground' }
}
// --- FIM DA SUGEST√ÉO 1 ---

// Lista oficial de motivos de desligamento (do arquivo original)
export const MOTIVOS_DESLIGAMENTO = [ //
  'Mudan√ßa de territ√≥rio',
  'Falecimento',
  'Recusa de atendimento',
  'Viola√ß√£o cessada',
  'Contrareferenciamento',
  'N√£o localizado',
  'Acolhimento',
] //

==================================================
FILE: frontend\src\constants\caseStatus.ts
==================================================

// frontend/src/constants/caseStatus.ts

// Define os tipos de status poss√≠veis que v√™m do backend
export const CASE_STATUSES = [ //
  'AGUARDANDO_ACOLHIDA', //
  'EM_ACOLHIDA', //
  'AGUARDANDO_DISTRIBUICAO_PAEFI', //
  'EM_ACOMPANHAMENTO_PAEFI', //
  'DESLIGADO', //
] as const // 'as const' torna o array readonly e os tipos literais

// Define o tipo CaseStatus baseado nas chaves do array
export type CaseStatus = (typeof CASE_STATUSES)[number]

// Define as propriedades de exibi√ß√£o para cada status (cor e texto)
type StatusDisplayConfig = {
  label: string
  color: 'blue' | 'yellow' | 'green' | 'red' | 'gray'
}

// --- ESTA √â A CONSTANTE QUE ESTAVA FALTANDO ---
// Mapeia cada status para sua configura√ß√£o de exibi√ß√£o
export const CASE_STATUS_MAP: Record<CaseStatus | 'DESCONHECIDO', StatusDisplayConfig> = { //
  AGUARDANDO_ACOLHIDA: { //
    label: 'Aguardando Acolhida',
    color: 'yellow',
  },
  EM_ACOLHIDA: { //
    label: 'Em Acolhida',
    color: 'blue',
  },
  AGUARDANDO_DISTRIBUICAO_PAEFI: { //
    label: 'Aguardando Distribui√ß√£o',
    color: 'yellow',
  },
  EM_ACOMPANHAMENTO_PAEFI: { //
    label: 'Acompanhamento PAEFI',
    color: 'green',
  },
  DESLIGADO: { //
    label: 'Desligado',
    color: 'red',
  },
  DESCONHECIDO: { // Um valor padr√£o para status inesperados
    label: 'Desconhecido',
    color: 'gray',
  },
}
// --- FIM DA CONSTANTE ---

// Fun√ß√£o auxiliar para obter o texto leg√≠vel do status
export function getCaseStatusDisplay(status: string | null | undefined): StatusDisplayConfig { //
  if (!status || !Object.keys(CASE_STATUS_MAP).includes(status)) { //
    return CASE_STATUS_MAP.DESCONHECIDO //
  }
  return CASE_STATUS_MAP[status as CaseStatus] //
}

==================================================
FILE: frontend\src\constants\caseTransitions.ts
==================================================

// frontend/src/constants/caseTransitions.ts
import {
  type CaseStatusIdentifier,
  // REMOVIDO: getCaseStatusInfo
} from './caseConstants'
// ADICIONADO: Importa√ß√£o correta do tipo UserRole
import type { UserRole } from '@/types/user'

const buttonStyles = {
  success: 'bg-emerald-600 hover:bg-emerald-700 text-white',
  danger: 'bg-destructive text-destructive-foreground hover:bg-destructive/90',
  neutral: 'bg-muted text-muted-foreground hover:bg-muted/90',
  accent: 'bg-purple-600 hover:bg-purple-700 text-white',
  primary: 'bg-primary text-primary-foreground hover:bg-primary/90',
}

export type ActionType = 'status' | 'assign' | 'close'

export interface StatusAction {
  label: string
  type: ActionType
  nextStatus?: CaseStatusIdentifier
  allowedRoles: UserRole[]
  style: string
}

// ... (O objeto caseTransitions permanece igual) ...
export const caseTransitions: Partial<
  Record<CaseStatusIdentifier, StatusAction[]>
> = {
  AGUARDANDO_ACOLHIDA: [
    {
      label: 'Iniciar Acolhida',
      type: 'status',
      nextStatus: 'EM_ACOLHIDA',
      allowedRoles: ['Gerente', 'Agente Social'],
      style: buttonStyles.success,
    },
    {
      label: 'Desligamento Simplificado',
      type: 'close',
      allowedRoles: ['Gerente', 'Agente Social'],
      style: buttonStyles.neutral,
    },
  ],
  EM_ACOLHIDA: [
    {
      label: 'Desligamento Simplificado',
      type: 'close',
      allowedRoles: ['Gerente', 'Agente Social'],
      style: buttonStyles.neutral,
    },
    {
      label: 'Encaminhar para PAEFI',
      type: 'status',
      nextStatus: 'AGUARDANDO_DISTRIBUICAO_PAEFI',
      allowedRoles: ['Gerente', 'Agente Social'],
      style: buttonStyles.accent,
    },
  ],
  AGUARDANDO_DISTRIBUICAO_PAEFI: [
    {
      label: 'Atribuir Especialista',
      type: 'assign',
      allowedRoles: ['Gerente'],
      style: buttonStyles.primary,
    },
  ],
  EM_ACOMPANHAMENTO_PAEFI: [
    {
      label: 'Desligar Acompanhamento',
      type: 'close',
      allowedRoles: ['Gerente', 'Especialista'],
      style: buttonStyles.danger,
    },
  ],
  DESLIGADO: [
    {
      label: 'Reabrir Caso',
      type: 'status',
      nextStatus: 'AGUARDANDO_ACOLHIDA',
      allowedRoles: ['Gerente'],
      style: buttonStyles.primary,
    },
  ],
}

// ... (A fun√ß√£o getAvailableActions permanece igual) ...
export function getAvailableActions(
  status: CaseStatusIdentifier,
  cargo: UserRole,
): StatusAction[] {
  const possibleActions = caseTransitions[status] || []
  
  return possibleActions.filter(action => 
    action.allowedRoles.includes(cargo)
  )
}

==================================================
FILE: frontend\src\constants\navigation.ts
==================================================

// frontend/src/constants/navigation.ts
import {
  PieChart,
  LayoutDashboard,
  Calendar,
  Users,
  FolderKanban,
  Archive,
  // --- SUGEST√ÉO 1 APLICADA ---
  UserCog, // √çcone diferente para 'Utilizadores'
} from 'lucide-react'
// --- SUGEST√ÉO 2 APLICADA ---
import type { LucideIcon } from 'lucide-react' // Tipo gen√©rico para √≠cones
import { ROUTES } from './routes' //
import type { UserRole } from '@/types/user' //

interface NavLink {
  to: string
  icon: LucideIcon // Usa o tipo gen√©rico
  label: string
  allowedRoles: UserRole[]
  // --- SUGEST√ÉO 3 APLICADA ---
  section: 'Acompanhamento' | 'Administra√ß√£o' // Adiciona o agrupamento
}

export const navLinks: NavLink[] = [
  {
    to: ROUTES.DASHBOARD, //
    icon: LayoutDashboard,
    label: 'Painel',
    allowedRoles: ['Gerente', 'Agente Social', 'Especialista'], //
    section: 'Acompanhamento',
  },
  {
    to: ROUTES.CASES, //
    icon: FolderKanban,
    label: 'Meus Casos Ativos',
    allowedRoles: ['Gerente', 'Agente Social', 'Especialista'], //
    section: 'Acompanhamento',
  },
  {
    to: ROUTES.TEAM_OVERVIEW, //
    icon: Users,
    label: 'Casos Ativos (Equipe)',
    allowedRoles: ['Gerente'], //
    section: 'Acompanhamento',
  },
  {
    to: ROUTES.CLOSED_CASES, //
    icon: Archive,
    label: 'Casos Finalizados',
    allowedRoles: ['Gerente', 'Agente Social', 'Especialista'], //
    section: 'Acompanhamento',
  },
  {
    to: ROUTES.AGENDA, //
    icon: Calendar,
    label: 'Agenda',
    allowedRoles: ['Gerente', 'Agente Social', 'Especialista'], //
    section: 'Acompanhamento',
  },
  {
    to: ROUTES.USERS, //
    icon: UserCog, // √çcone atualizado
    label: 'Utilizadores',
    allowedRoles: ['Gerente'], //
    section: 'Administra√ß√£o',
  },
  {
    to: ROUTES.REPORTS, //
    icon: PieChart,
    label: 'Relat√≥rios',
    allowedRoles: ['Gerente'], //
    section: 'Administra√ß√£o',
  },
]

==================================================
FILE: frontend\src\constants\routes.ts
==================================================

// frontend/src/constants/routes.ts

/**
 * Define os caminhos exatos (paths) que o React Router usa no App.tsx.
 * Nomes de rotas-pai s√£o absolutos (come√ßam com '/')
 * Nomes de rotas-filhas s√£o relativos (N√ÉO come√ßam com '/')
 */
export const ROUTE_PATHS = { //
  LOGIN: '/', //
  DASHBOARD: '/dashboard', // Rota "Pai" que usa o MainLayout
  CASES: 'cases', // Rota "Filha" de /dashboard
  CLOSED_CASES: 'cases/closed', // Rota "Filha" de /dashboard
  CASE_DETAIL: 'cases/:id', // Rota "Filha" de /dashboard
  AGENDA: 'agenda', // Rota "Filha" de /dashboard
  TEAM: 'team-overview', // Rota "Filha" de /dashboard
  REPORTS: 'reports', // Rota "Filha" de /dashboard
  USERS: 'users', // Rota "Filha" de /dashboard
  NOT_FOUND: '*', //
} as const

/**
 * Define as rotas absolutas (completas) para serem usadas em componentes
 * como <Link to={...}> ou navigate(...).
 */
export const ROUTES = { //
  LOGIN: ROUTE_PATHS.LOGIN, //
  DASHBOARD: ROUTE_PATHS.DASHBOARD, //
  CASES: `${ROUTE_PATHS.DASHBOARD}/${ROUTE_PATHS.CASES}`, // ex: /dashboard/cases
  CLOSED_CASES: `${ROUTE_PATHS.DASHBOARD}/${ROUTE_PATHS.CLOSED_CASES}`, // ex: /dashboard/cases/closed
  AGENDA: `${ROUTE_PATHS.DASHBOARD}/${ROUTE_PATHS.AGENDA}`, // ex: /dashboard/agenda
  TEAM_OVERVIEW: `${ROUTE_PATHS.DASHBOARD}/${ROUTE_PATHS.TEAM}`, // ex: /dashboard/team-overview
  REPORTS: `${ROUTE_PATHS.DASHBOARD}/${ROUTE_PATHS.REPORTS}`, // ex: /dashboard/reports
  USERS: `${ROUTE_PATHS.DASHBOARD}/${ROUTE_PATHS.USERS}`, // ex: /dashboard/users
  NOT_FOUND: ROUTE_PATHS.NOT_FOUND, //

  // Fun√ß√£o para o √∫nico link din√¢mico que temos
  CASE_DETAIL: (id: string) => `${ROUTE_PATHS.DASHBOARD}/cases/${id}`, // ex: /dashboard/cases/123-abc
} as const

==================================================
FILE: frontend\src\constants\storage.ts
==================================================

// frontend/src/constants/storage.ts

export const STORAGE_KEYS = {
  TOKEN: '@sgac-braz:token', //
} as const

==================================================
FILE: frontend\src\contexts\AuthContext.tsx
==================================================

// frontend/src/contexts/AuthContext.tsx
import { createContext, useState, useEffect, type ReactNode } from 'react'
import { useNavigate } from 'react-router-dom'
import { toast } from 'sonner'
import { jwtDecode } from 'jwt-decode' //
import { Loader2 } from 'lucide-react'
import { getErrorMessage } from '@/utils/error'
import { api } from '@/lib/api' //
import { ROUTES } from '@/constants/routes' //
import { STORAGE_KEYS } from '@/constants/storage' //
import type { User, UserRole } from '@/types/user' //

// Define o que o token JWT cont√©m
interface DecodedToken {
  exp: number
  iat: number
  sub: string // O ID do usu√°rio
  nome: string
  cargo: UserRole
}

interface LoginData {
  email: string
  senha: string
}

interface AuthContextType {
  isAuthenticated: boolean
  user: User | null
  login: (data: LoginData) => Promise<boolean>
  logout: () => void
  isSessionLoading: boolean // Para saber se a sess√£o inicial est√° carregando
  isLoginLoading: boolean // Para o bot√£o de login
}

export const AuthContext = createContext({} as AuthContextType)

export function AuthProvider({ children }: { children: ReactNode }) {
  const [user, setUser] = useState<User | null>(null)
  const [isSessionLoading, setIsSessionLoading] = useState(true)
  const [isLoginLoading, setIsLoginLoading] = useState(false)
  const navigate = useNavigate()

  // Fun√ß√£o de Logout
  const logout = () => {
    setUser(null)
    localStorage.removeItem(STORAGE_KEYS.TOKEN) //
    delete api.defaults.headers.common.Authorization //
    
    // Navega para o login. O <Navigate> no App.tsx cuidar√° do resto.
    navigate(ROUTES.LOGIN) //
  }

  // Efeito para carregar o usu√°rio do localStorage na inicializa√ß√£o
  useEffect(() => {
    async function loadUserFromStorage() {
      const storedToken = localStorage.getItem(STORAGE_KEYS.TOKEN) //
      
      if (storedToken) {
        try {
          const decodedToken = jwtDecode<DecodedToken>(storedToken)
          // Verifica se o token n√£o est√° expirado
          if (decodedToken.exp * 1000 > Date.now()) {
            // Define o token no axios ANTES de fazer a chamada /me
            api.defaults.headers.common.Authorization = `Bearer ${storedToken}` //
            
            // Busca os dados mais recentes do usu√°rio
            const response = await api.get('/me') //
            setUser(response.data)
          } else {
            // Token expirado
            logout()
          }
        } catch (error) {
          // Token inv√°lido ou erro na API
          console.error("Falha ao carregar sess√£o:", error)
          logout()
        }
      }
      setIsSessionLoading(false)
    }
    loadUserFromStorage()
    // O 'navigate' n√£o √© uma depend√™ncia est√°vel, ent√£o o desabilitamos
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [])

  // Fun√ß√£o de Login
  const login = async ({ email, senha }: LoginData): Promise<boolean> => {
    setIsLoginLoading(true)
    try {
      const response = await api.post('/login', { email, senha }) //
      const { token: newToken } = response.data

      // 1. Salva o token
      localStorage.setItem(STORAGE_KEYS.TOKEN, newToken) //
      api.defaults.headers.common.Authorization = `Bearer ${newToken}` //

      // 2. Busca os dados do usu√°rio com o novo token
      const userResponse = await api.get('/me') //
      const loggedUser: User = userResponse.data
      setUser(loggedUser) //

      toast.success('Login bem-sucedido!')

      // 3. Redireciona com base no cargo
      // Gerente vai para o Dashboard, outros para a lista de casos
      navigate(loggedUser.cargo === 'Gerente' ? ROUTES.DASHBOARD : ROUTES.CASES) //
      return true
    } catch (error) {
      const errMsg = getErrorMessage(error, 'Verifique suas credenciais.') //
      toast.error(errMsg)
      return false
    } finally {
      setIsLoginLoading(false)
    }
  }

  // Mostra um loader em tela cheia enquanto a sess√£o (do localStorage) est√° sendo validada
  if (isSessionLoading) {
    return (
      <div className="flex h-screen items-center justify-center bg-background">
        <Loader2 className="h-8 w-8 animate-spin text-primary" />
      </div>
    )
  }

  return (
    <AuthContext.Provider
      value={{
        isAuthenticated: !!user, // Verdadeiro se 'user' n√£o for nulo
        user,
        login,
        logout,
        isSessionLoading,
        isLoginLoading,
      }}
    >
      {children}
    </AuthContext.Provider>
  )
}

==================================================
FILE: frontend\src\contexts\ModalContext.tsx
==================================================

// frontend/src/contexts/ModalContext.tsx
import { createContext, useState, type ReactNode } from 'react'

interface ModalContextType {
  isNewCaseModalOpen: boolean
  openNewCaseModal: () => void
  closeNewCaseModal: () => void
}

export const ModalContext = createContext({} as ModalContextType)

export function ModalProvider({ children }: { children: ReactNode }) {
  const [isNewCaseModalOpen, setIsNewCaseModalOpen] = useState(false)

  const openNewCaseModal = () => setIsNewCaseModalOpen(true)
  const closeNewCaseModal = () => setIsNewCaseModalOpen(false)

  return (
    <ModalContext.Provider
      value={{
        isNewCaseModalOpen,
        openNewCaseModal,
        closeNewCaseModal,
      }}
    >
      {children}
    </ModalContext.Provider>
  )
}



==================================================
FILE: frontend\src\hooks\api\useCaseQueries.ts
==================================================

// frontend/src/hooks/api/useCaseQueries.ts
import { useQuery } from '@tanstack/react-query'
import { api } from '@/lib/api'
import type { CaseDetailData, Evolution, PafData, UserOption } from '@/types/case'

export function useCaseDetail(caseId?: string) {
  return useQuery<CaseDetailData>({
    queryKey: ['case', caseId],
    queryFn: async () => {
      const response = await api.get(`/cases/${caseId}`)
      return response.data
    },
    enabled: !!caseId,
  })
}

export function useEvolutions(caseId?: string) {
  return useQuery<Evolution[]>({
    queryKey: ['evolutions', caseId],
    queryFn: async () => {
      const response = await api.get(`/cases/${caseId}/evolutions`)
      return response.data
    },
    enabled: !!caseId,
  })
}

export function usePaf(caseId?: string) {
  return useQuery<PafData | null>({
    queryKey: ['paf', caseId],
    queryFn: async () => {
      const response = await api.get(`/cases/${caseId}/paf`)
      return response.data
    },
    enabled: !!caseId,
  })
}

export function useAgents() {
  return useQuery<UserOption[]>({
    queryKey: ['agents'],
    queryFn: async () => {
      const response = await api.get('/users/agents')
      return response.data
    },
  })
}

export function useSpecialists() {
  return useQuery<UserOption[]>({
    queryKey: ['specialists'],
    queryFn: async () => {
      const response = await api.get('/users/specialists')
      return response.data
    },
  })
}

==================================================
FILE: frontend\src\hooks\useAuth.ts
==================================================

// frontend/src/hooks/useAuth.ts
import { useContext } from 'react'
import { AuthContext } from '@/contexts/AuthContext'

export function useAuth() {
  const context = useContext(AuthContext)

  if (!context) {
    throw new Error('useAuth must be used within an AuthProvider')
  }

  return context
}


==================================================
FILE: frontend\src\hooks\useDebounce.ts
==================================================

// frontend/src/hooks/useDebounce.ts
import { useState, useEffect } from 'react'

/**
 * Hook que atrasa a atualiza√ß√£o de um valor.
 * √ötil para evitar chamadas de API excessivas em campos de busca.
 *
 * @param value - O valor a ser "debounceado"
 * @param delay - Tempo de atraso em milissegundos
 * @returns O valor "debounceado"
 */
export function useDebounce<T>(value: T, delay: number): T {
  const [debouncedValue, setDebouncedValue] = useState<T>(value)

  useEffect(() => {
    const handler = setTimeout(() => setDebouncedValue(value), delay)

    return () => clearTimeout(handler)
  }, [value, delay])

  return debouncedValue
}


==================================================
FILE: frontend\src\hooks\useModal.ts
==================================================

// frontend/src/hooks/useModal.ts
import { useContext } from 'react'
import { ModalContext } from '@/contexts/ModalContext'

/**
 * Hook customizado para acessar o contexto de modais.
 */
export function useModal() {
  const context = useContext(ModalContext)

  if (!context) {
    throw new Error('useModal must be used within a ModalProvider')
  }

  return context
}


==================================================
FILE: frontend\src\lib\api.ts
==================================================

// frontend/src/lib/api.ts
import axios from 'axios'
import { STORAGE_KEYS } from '../constants/storage'

const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:3333'

export const api = axios.create({
  baseURL: API_URL,
})

// Interceptor para adicionar o token a cada requisi√ß√£o
api.interceptors.request.use((config) => {
  const token = localStorage.getItem(STORAGE_KEYS.TOKEN)
  if (token) {
    config.headers.Authorization = `Bearer ${token}`
  }
  return config
})

// Interceptor para tratar erros 401 (N√£o Autorizado) globalmente
// Isto √© √∫til para deslogar o utilizador quando o token expira.
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      // Limpa o token e recarrega a p√°gina para o ecr√£ de login.
      localStorage.removeItem(STORAGE_KEYS.TOKEN)
      // O AuthContext ir√° detetar a aus√™ncia de token e redirecionar.
      window.location.href = '/'
    }
    return Promise.reject(error)
  },
)



==================================================
FILE: frontend\src\lib\react-query.ts
==================================================

// frontend/src/lib/react-query.ts
import { QueryClient } from '@tanstack/react-query'

// Cria uma inst√¢ncia √∫nica (singleton) do QueryClient
// Esta inst√¢ncia gerenciar√° todo o cache de dados,
// novas buscas (refetching), etc., para a aplica√ß√£o.
export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 5 * 60 * 1000,
      gcTime: 10 * 60 * 1000,
      refetchOnWindowFocus: false,
      retry: 1,
    },
  },
})

==================================================
FILE: frontend\src\lib\utils.ts
==================================================

// frontend/src/lib/utils.ts
import { type ClassValue, clsx } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}

==================================================
FILE: frontend\src\main.tsx
==================================================

// frontend/src/main.tsx
import React from "react";
import { createRoot } from "react-dom/client";
import { App } from "./App";

// Agora S√ì usa o index.css (que cont√©m todo o tema)
import "./styles/index.css";

const container = document.getElementById("root");

if (!container) {
  throw new Error("Elemento #root n√£o encontrado no index.html");
}

const root = createRoot(container);

root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);

==================================================
FILE: frontend\src\pages\Agenda.tsx
==================================================

// frontend/src/pages/Agenda.tsx
import { useState, useEffect } from 'react'
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'
import { format, startOfMonth } from 'date-fns'
import { ptBR } from 'date-fns/locale'
import { DayPicker } from 'react-day-picker'
import 'react-day-picker/dist/style.css'
import { Link, useSearchParams } from 'react-router-dom'
import { useForm, type SubmitHandler, Controller } from 'react-hook-form'
import { z } from 'zod'
import { zodResolver } from '@hookform/resolvers/zod'
import { toast } from 'sonner'
import { Loader2 } from 'lucide-react'

import { api } from '@/lib/api'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { ROUTES } from '@/constants/routes'
import { Button } from '@/components/ui/button'
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
  DialogDescription,
  DialogFooter,
} from '@/components/ui/dialog'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select'
import { Textarea } from '@/components/ui/textarea'
import { getErrorMessage } from '@/utils/error'

interface Appointment {
  id: string
  titulo: string
  data: string
  caso: {
    id: string
    nomeCompleto: string
  }
}

interface CaseOption {
  id: string
  nomeCompleto: string
}

const appointmentFormSchema = z.object({
  titulo: z.string().min(3, 'O t√≠tulo √© muito curto.'),
  data: z.string().min(1, 'A data √© obrigat√≥ria.'),
  time: z.string().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/, 'Hora inv√°lida.'),
  casoId: z.string().uuid('Selecione um caso.'),
  observacoes: z.string().optional(),
})

type AppointmentFormData = z.infer<typeof appointmentFormSchema>

function NewAppointmentModal({
  onOpenChange,
  defaultCaseId,
}: {
  onOpenChange: (isOpen: boolean) => void
  defaultCaseId?: string | null
}) {
  const queryClient = useQueryClient()

  const { data: casesResponse } = useQuery<{ items: CaseOption[] }>({
    queryKey: ['cases'],
    queryFn: async () => {
      const response = await api.get('/cases')
      return response.data
    },
  })

  const cases = casesResponse?.items

  const {
    control,
    handleSubmit,
    formState: { errors },
    reset,
    setValue,
  } = useForm<AppointmentFormData>({
    resolver: zodResolver(appointmentFormSchema),
    defaultValues: {
      titulo: '',
      data: '',
      time: '',
      casoId: defaultCaseId ?? '',
    },
  })

  useEffect(() => {
    if (defaultCaseId) {
      setValue('casoId', defaultCaseId)
    }
  }, [defaultCaseId, setValue])

  const { mutate: createAppointment, isPending } = useMutation({
    mutationFn: async (data: AppointmentFormData) => {
      return await api.post('/appointments', data)
    },
    onSuccess: () => {
      toast.success('Agendamento criado com sucesso!')
      queryClient.invalidateQueries({ queryKey: ['appointments'] })
      onOpenChange(false)
      reset()
    },
    onError: (error) => {
      toast.error(getErrorMessage(error, 'Falha ao criar agendamento.'))
    },
  })

  const onSubmit: SubmitHandler<AppointmentFormData> = (data) => {
    createAppointment(data)
  }

  return (
    <DialogContent>
      <DialogHeader>
        <DialogTitle>Novo Agendamento</DialogTitle>
        <DialogDescription>
          Preencha os dados para criar um novo evento na sua agenda.
        </DialogDescription>
      </DialogHeader>

      <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
        <div className="space-y-2">
          <Label htmlFor="titulo">T√≠tulo do Agendamento</Label>
          <Controller
            name="titulo"
            control={control}
            render={({ field }) => <Input id="titulo" {...field} />}
          />
          {errors.titulo && (
            <p className="text-sm text-destructive">{errors.titulo.message}</p>
          )}
        </div>

        <div className="grid grid-cols-2 gap-4">
          <div className="space-y-2">
            <Label htmlFor="data">Data</Label>
            <Controller
              name="data"
              control={control}
              render={({ field }) => <Input type="date" id="data" {...field} />}
            />
            {errors.data && (
              <p className="text-sm text-destructive">{errors.data.message}</p>
            )}
          </div>

          <div className="space-y-2">
            <Label htmlFor="time">Hora</Label>
            <Controller
              name="time"
              control={control}
              render={({ field }) => <Input type="time" id="time" {...field} />}
            />
            {errors.time && (
              <p className="text-sm text-destructive">{errors.time.message}</p>
            )}
          </div>
        </div>

        <div className="space-y-2">
          <Label>Vincular ao Caso</Label>
          <Controller
            name="casoId"
            control={control}
            render={({ field }) => (
              <Select
                onValueChange={field.onChange}
                value={field.value}
                disabled={!!defaultCaseId}
              >
                <SelectTrigger>
                  <SelectValue placeholder="Selecione um caso..." />
                </SelectTrigger>
                <SelectContent>
                  {cases?.map((c) => (
                    <SelectItem key={c.id} value={c.id}>
                      {c.nomeCompleto}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            )}
          />
          {errors.casoId && (
            <p className="text-sm text-destructive">{errors.casoId.message}</p>
          )}
        </div>

        <div className="space-y-2">
          <Label>Observa√ß√µes (Opcional)</Label>
          <Controller
            name="observacoes"
            control={control}
            render={({ field }) => (
              <Textarea placeholder="Detalhes adicionais..." {...field} />
            )}
          />
        </div>

        <DialogFooter>
          <Button type="submit" disabled={isPending}>
            {isPending && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
            Agendar
          </Button>
        </DialogFooter>
      </form>
    </DialogContent>
  )
}

// =====================================================
// ===================  P√ÅGINA PRINCIPAL  ===============
// =====================================================

export function Agenda() {
  const [selectedDay, setSelectedDay] = useState<Date | undefined>(new Date())
  const [currentMonth, setCurrentMonth] = useState(startOfMonth(new Date()))
  const [isModalOpen, setIsModalOpen] = useState(false)

  const [searchParams] = useSearchParams()
  const defaultCaseId = searchParams.get('caseId')

  useEffect(() => {
    if (defaultCaseId) setIsModalOpen(true)
  }, [defaultCaseId])

  const monthQuery = format(currentMonth, 'yyyy-MM')

  const { data: appointments, isLoading: isLoadingAppointments } =
    useQuery<Appointment[]>({
      queryKey: ['appointments', monthQuery],
      queryFn: async () => {
        const response = await api.get('/appointments', {
          params: { month: monthQuery },
        })
        return response.data
      },
    })

  const appointmentsOnSelectedDay =
    selectedDay && appointments
      ? appointments.filter(
          (app) =>
            format(new Date(app.data), 'yyyy-MM-dd') ===
            format(selectedDay, 'yyyy-MM-dd'),
        )
      : []

  return (
    <div className="space-y-6">
      <div className="flex justify-between items-center">
        <h2 className="text-2xl font-bold">Agenda de Atendimentos</h2>

        <Dialog open={isModalOpen} onOpenChange={setIsModalOpen}>
          <DialogTrigger asChild>
            <Button>Novo Agendamento</Button>
          </DialogTrigger>

          <NewAppointmentModal
            onOpenChange={setIsModalOpen}
            defaultCaseId={defaultCaseId}
          />
        </Dialog>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <Card className="lg:col-span-1">
          <CardContent className="p-0 flex justify-center">
            <DayPicker
              mode="single"
              selected={selectedDay}
              onSelect={setSelectedDay}
              month={currentMonth}
              onMonthChange={setCurrentMonth}
              locale={ptBR}
              modifiers={{
                scheduled: appointments?.map((app) => new Date(app.data)) ?? [],
              }}
              modifiersClassNames={{
                scheduled: 'font-bold text-primary',
              }}
            />
          </CardContent>
        </Card>

        <Card className="lg:col-span-2">
          <CardHeader>
            <CardTitle>
              Agendamentos para{' '}
              {selectedDay
                ? format(selectedDay, 'PPP', { locale: ptBR })
                : 'Nenhum dia selecionado'}
            </CardTitle>
          </CardHeader>

          <CardContent>
            {isLoadingAppointments && (
              <p className="text-sm text-muted-foreground">
                Carregando agendamentos...
              </p>
            )}

            {!isLoadingAppointments &&
            appointmentsOnSelectedDay.length > 0 ? (
              <ul className="space-y-4">
                {appointmentsOnSelectedDay.map((app) => (
                  <li
                    key={app.id}
                    className="border-l-4 border-primary pl-4"
                  >
                    <p className="font-semibold">{app.titulo}</p>

                    <Link
                      to={ROUTES.CASE_DETAIL(app.caso.id)}
                      className="text-sm text-muted-foreground hover:underline"
                    >
                      Caso: {app.caso.nomeCompleto}
                    </Link>

                    <p className="text-xs text-muted-foreground mt-1">
                      {format(new Date(app.data), 'HH:mm')}
                    </p>
                  </li>
                ))}
              </ul>
            ) : (
              !isLoadingAppointments && (
                <p className="text-muted-foreground">
                  Nenhum agendamento para este dia.
                </p>
              )
            )}
          </CardContent>
        </Card>
      </div>
    </div>
  )
}


==================================================
FILE: frontend\src\pages\CaseDetail.tsx
==================================================

// frontend/src/pages/CaseDetail.tsx
import { useParams } from "react-router-dom"
import { ExternalLink } from "lucide-react"
import { clsx } from "clsx"

import { getCaseStatusInfo } from "@/constants/caseConstants"
import { useCaseDetail } from "@/hooks/api/useCaseQueries"
import { formatCPF, formatPhone, formatDateSafe } from "@/utils/formatters"

import { CaseActions } from "@/components/case/CaseActions"
import { PafSection } from "@/components/case/PafSection"
import { EvolutionsSection } from "@/components/case/EvolutionsSection"
import { DetailField } from "@/components/case/DetailField"
import { DetailSkeleton } from "@/components/case/DetailSkeleton"
import { CaseHistory } from "@/components/case/CaseHistory"

import { Badge } from "@/components/ui/badge"
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs"

export function CaseDetail() {
  const { id } = useParams<{ id: string }>()
  const { data: caseDetail, isLoading, isError } = useCaseDetail(id)

  if (!id) {
    return <p className="text-center text-destructive">ID inv√°lido.</p>
  }

  if (isLoading) return <DetailSkeleton />

  if (isError || !caseDetail) {
    return (
      <div className="flex h-full items-center justify-center text-center p-8">
        <div>
          <h2 className="text-xl font-bold text-destructive">Erro ao carregar o caso.</h2>
          <p className="text-muted-foreground mt-1">
            O caso pode n√£o existir ou ocorreu um problema no servidor.
          </p>
        </div>
      </div>
    )
  }

  const statusInfo = getCaseStatusInfo(caseDetail.status)

  return (
    <div className="space-y-6 pb-8">

      {/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî CABE√áALHO ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */}
      <div className="border-b pb-4">
        <h2 className="text-2xl font-bold tracking-tight text-foreground">
          {caseDetail.nomeCompleto}
        </h2>

        <div className="mt-2 flex flex-wrap items-center gap-4">
          <Badge className={clsx("border-transparent", statusInfo.style)}>
            {statusInfo.text}
          </Badge>

          <p className="text-sm text-muted-foreground">
            Criado por: {caseDetail.criadoPor.nome}
          </p>
        </div>

        {/* Bot√µes de a√ß√£o */}
        <CaseActions caseData={caseDetail} />
      </div>

      {/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî ABAS ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */}
      <Tabs defaultValue="prontuario" className="w-full">

        <TabsList className="grid w-full max-w-[420px] grid-cols-2 mx-auto">
          <TabsTrigger value="prontuario">Prontu√°rio & Atendimento</TabsTrigger>
          <TabsTrigger value="historico">Hist√≥rico do Sistema</TabsTrigger>
        </TabsList>

        {/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî ABA 1 ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */}
        <TabsContent
          value="prontuario"
          className="space-y-6 mt-4 animate-in fade-in-50"
        >
          {/* Informa√ß√µes pessoais */}
          <div className="rounded-lg border bg-background p-4 shadow-sm">
            <h3 className="text-base font-semibold mb-4">Informa√ß√µes Pessoais</h3>
            <dl className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-6">
              <DetailField label="Nome Completo" value={caseDetail.nomeCompleto} />
              <DetailField label="CPF" value={formatCPF(caseDetail.cpf)} />
              <DetailField label="Data de Nascimento" value={formatDateSafe(caseDetail.nascimento)} />
              <DetailField label="Sexo" value={caseDetail.sexo} />
              <DetailField label="Telefone" value={formatPhone(caseDetail.telefone)} />
              <DetailField label="Endere√ßo" value={caseDetail.endereco} className="lg:col-span-2" />
            </dl>
          </div>

          {/* Detalhes gerais */}
          <div className="rounded-lg border bg-background p-4 shadow-sm">
            <h3 className="text-base font-semibold mb-4">Detalhes do Caso & Benef√≠cios</h3>

            <dl className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-6">

              <DetailField label="Data de Entrada" value={formatDateSafe(caseDetail.dataEntrada)} />
              <DetailField label="Urg√™ncia" value={caseDetail.urgencia} />
              <DetailField label="Viola√ß√£o" value={caseDetail.violacao} />
              <DetailField label="Categoria" value={caseDetail.categoria} />
              <DetailField label="√ìrg√£o Demandante" value={caseDetail.orgaoDemandante} />

              <DetailField
                label="Agente Social (Acolhida)"
                value={caseDetail.agenteAcolhida?.nome ?? "-"}
              />

              <DetailField
                label="Especialista PAEFI"
                value={caseDetail.especialistaPAEFI?.nome ?? "-"}
              />

              <DetailField label="N√∫mero do SEI" value={caseDetail.numeroSei ?? "-"} />

              <DetailField
                label="Link do SEI"
                value={
                  caseDetail.linkSei ? (
                    <a
                      href={caseDetail.linkSei}
                      target="_blank"
                      rel="noopener noreferrer"
                      className="flex items-center gap-1 text-primary hover:underline"
                    >
                      Abrir no SEI <ExternalLink size={14} />
                    </a>
                  ) : "-"}
              />

              {/* Observa√ß√µes */}
              <div className="lg:col-span-3">
                <DetailField label="Observa√ß√µes Iniciais" value={caseDetail.observacoes ?? "-"} />
              </div>

              {/* Benef√≠cios */}
              <div className="lg:col-span-3">
                <DetailField
                  label="Benef√≠cios Registrados"
                  value={
                    caseDetail.beneficios.length > 0 ? (
                      caseDetail.beneficios.map((b) => (
                        <Badge key={b} variant="secondary" className="mr-1 mb-1">
                          {b}
                        </Badge>
                      ))
                    ) : (
                      "Nenhum benef√≠cio registrado."
                    )
                  }
                />
              </div>

              {caseDetail.status === "DESLIGADO" && (
                <div className="lg:col-span-3 mt-6 pt-6 border-t space-y-4">
                  <DetailField
                    label="Motivo do Desligamento"
                    value={caseDetail.motivoDesligamento ?? "-"}
                  />
                  <DetailField
                    label="Parecer Final"
                    value={caseDetail.parecerFinal ?? "-"}
                  />
                </div>
              )}
            </dl>
          </div>

          <PafSection caseData={caseDetail} />
          <EvolutionsSection caseId={caseDetail.id} />
        </TabsContent>

        {/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî ABA 2 ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */}
        <TabsContent
          value="historico"
          className="mt-4 animate-in fade-in-50"
        >
          <CaseHistory logs={caseDetail.logs} />
        </TabsContent>

      </Tabs>
    </div>
  )
}


==================================================
FILE: frontend\src\pages\Cases.tsx
==================================================

// frontend/src/pages/Cases.tsx
import { CaseTable } from '@/components/CaseTable'
import { useAuth } from '@/hooks/useAuth'
import { Loader2 } from 'lucide-react'

export function Cases() {
  const { user, isSessionLoading } = useAuth()

  // Evita piscar a interface
  if (isSessionLoading) {
    return (
      <div className="flex h-full items-center justify-center">
        <Loader2 className="h-8 w-8 animate-spin text-primary" />
      </div>
    )
  }

  // Sess√£o inv√°lida (token expirado ou falha no /me)
  if (!user) {
    return (
      <div className="flex h-full items-center justify-center">
        <p className="text-sm text-muted-foreground">
          Sess√£o expirada. Fa√ßa login novamente.
        </p>
      </div>
    )
  }

  // T√≠tulo din√¢mico por cargo
  const titlesByRole = {
    Gerente: 'Todos os Casos',
    'Agente Social': 'Casos de Acolhida',
    Especialista: 'Casos em Acompanhamento PAEFI',
  }

  const title = titlesByRole[user.cargo] ?? 'Meus Casos'

  // Descri√ß√µes din√¢micas
  const descriptionText = {
    Gerente: 'Visualize todos os casos que aguardam distribui√ß√£o para o PAEFI.',
    'Agente Social': 'Visualize todos os seus casos em acolhida ou aguardando acolhida.',
    Especialista: 'Visualize todos os seus casos em acompanhamento PAEFI.',
  }

  const description =
    descriptionText[user.cargo] ??
    'Visualize os seus casos ativos.'

  return (
    <CaseTable
      title={title}
      description={description}
      endpoint="/cases"
    />
  )
}


==================================================
FILE: frontend\src\pages\ClosedCases.tsx
==================================================

// frontend/src/pages/ClosedCases.tsx
import { CaseTable } from '@/components/CaseTable'
import { useAuth } from '@/hooks/useAuth'
import { Loader2 } from 'lucide-react'

export function ClosedCases() {
  const { user, isSessionLoading } = useAuth()

  // Loader inicial (igual ao Cases.tsx)
  if (isSessionLoading) {
    return (
      <div className="flex h-full items-center justify-center">
        <Loader2 className="h-8 w-8 animate-spin text-primary" />
      </div>
    )
  }

  // Caso raro mas importante: usu√°rio nulo ap√≥s validar sess√£o
  if (!user) {
    return (
      <div className="flex h-full items-center justify-center">
        <p className="text-sm text-muted-foreground">
          Sess√£o expirada. Fa√ßa login novamente.
        </p>
      </div>
    )
  }

  // T√≠tulo din√¢mico por cargo
  const titlesByRole = {
    Gerente: 'Todos os Casos Finalizados',
    'Agente Social': 'Meus Casos Finalizados',
    Especialista: 'Meus Casos Finalizados',
  }

  const title = titlesByRole[user.cargo] ?? 'Casos Finalizados'

  // Descri√ß√£o por cargo
  const description =
    user.cargo === 'Gerente'
      ? 'Consulte todos os casos finalizados do sistema.'
      : 'Consulte todos os seus casos que j√° foram desligados.'

  return (
    <CaseTable
      title={title}
      description={description}
      endpoint="/cases/closed"
    />
  )
}


==================================================
FILE: frontend\src\pages\Dashboard.tsx
==================================================

// frontend/src/pages/Dashboard.tsx
import { useAuth } from '@/hooks/useAuth'
import { Loader2 } from 'lucide-react'
import { ManagerDashboard } from './ManagerDashboard'
import { TechnicianDashboard } from './TechnicianDashboard'
import { SocialAgentDashboard } from './SocialAgentDashboard'

type Cargo = 'Gerente' | 'Agente Social' | 'Especialista' | string

const DASHBOARD_BY_ROLE: Record<Cargo, JSX.Element> = {
  Gerente: <ManagerDashboard />,
  'Agente Social': <SocialAgentDashboard />,
  Especialista: <TechnicianDashboard />,
}

export function Dashboard() {
  const { user, isSessionLoading } = useAuth()

  if (isSessionLoading) {
    return (
      <div className="flex h-full items-center justify-center">
        <Loader2 className="h-8 w-8 animate-spin text-primary" />
      </div>
    )
  }

  if (!user) {
    return (
      <div className="flex h-full items-center justify-center">
        <p className="text-muted-foreground text-sm">
          Sess√£o expirada. Fa√ßa login novamente.
        </p>
      </div>
    )
  }

  const dashboard = DASHBOARD_BY_ROLE[user.cargo] ?? (
    <div className="text-center p-6 border rounded-md">
      Cargo "{user.cargo}" n√£o possui dashboard configurado.
    </div>
  )

  const subtitle =
    user.cargo === 'Agente Social'
      ? 'Painel de Acolhida e Triagem.'
      : user.cargo === 'Gerente'
      ? 'Resumo geral da unidade.'
      : 'Seus alertas e atividades recentes.'

  return (
    <div className="space-y-6">
      <header>
        <h1 className="text-2xl font-bold">Bem-vindo, {user.nome}!</h1>
        <p className="text-muted-foreground">{subtitle}</p>
      </header>

      {dashboard}
    </div>
  )
}


==================================================
FILE: frontend\src\pages\Login.tsx
==================================================

// frontend/src/pages/Login.tsx
import { useForm, type SubmitHandler } from 'react-hook-form'
import { z } from 'zod'
import { zodResolver } from '@hookform/resolvers/zod'
import { Loader2 } from 'lucide-react'

import { useAuth } from '@/hooks/useAuth'
import {
  Card,
  CardContent,
  CardDescription,
  CardFooter,
  CardHeader,
  CardTitle,
} from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'

// Schema de valida√ß√£o
const loginFormSchema = z.object({
  email: z.string().email('Por favor, insira um email v√°lido.'),
  senha: z.string().min(6, 'A senha deve ter pelo menos 6 caracteres.'),
})

type LoginFormData = z.infer<typeof loginFormSchema>

export function Login() {
  const { login, isLoginLoading } = useAuth()

  const {
    register,
    handleSubmit,
    formState: { errors },
  } = useForm<LoginFormData>({
    resolver: zodResolver(loginFormSchema),
  })

  const onSubmit: SubmitHandler<LoginFormData> = async (data) => {
    try {
      await login(data)
    } catch (error) {
      console.error('Falha inesperada no componente de Login:', error)
    }
  }

  return (
    <div className="min-h-screen bg-background flex items-center justify-center p-4">
      <Card className="w-full max-w-md shadow-sm">
        <CardHeader className="text-center">
          <CardTitle className="text-xl font-bold">SGAC-BRAZ</CardTitle>
          <CardDescription>
            Sistema de Gest√£o de Atendimentos do CREAS
          </CardDescription>
        </CardHeader>

        <form onSubmit={handleSubmit(onSubmit)}>
          <CardContent className="space-y-4">
            
            {/* Campo Email */}
            <div className="space-y-2">
              <Label htmlFor="email">Email</Label>
              <Input
                id="email"
                type="email"
                placeholder="gerente@creas.com"
                aria-invalid={!!errors.email}
                aria-describedby="email-error"
                disabled={isLoginLoading}
                {...register('email')}
              />
              {errors.email && (
                <p id="email-error" className="text-sm text-destructive">
                  {errors.email.message}
                </p>
              )}
            </div>

            {/* Campo Senha */}
            <div className="space-y-2">
              <Label htmlFor="senha">Senha</Label>
              <Input
                id="senha"
                type="password"
                placeholder="********"
                autoComplete="off"
                aria-invalid={!!errors.senha}
                aria-describedby="senha-error"
                disabled={isLoginLoading}
                {...register('senha')}
              />
              {errors.senha && (
                <p id="senha-error" className="text-sm text-destructive">
                  {errors.senha.message}
                </p>
              )}
            </div>

          </CardContent>

          <CardFooter>
            <Button type="submit" className="w-full" disabled={isLoginLoading}>
              {isLoginLoading && (
                <Loader2 className="mr-2 h-4 w-4 animate-spin" />
              )}
              Entrar
            </Button>
          </CardFooter>
        </form>

      </Card>
    </div>
  )
}


==================================================
FILE: frontend\src\pages\ManagerDashboard.tsx
==================================================

// frontend/src/pages/ManagerDashboard.tsx ‚Äî Painel do Gerente (Dashboard Geral), modernizado e otimizado.

import { useQuery } from '@tanstack/react-query'
import { api } from '@/lib/api'
import { motion } from 'framer-motion'

import {
  Card,
  CardHeader,
  CardTitle,
  CardDescription,
  CardContent,
} from '@/components/ui/card'

import { Skeleton } from '@/components/ui/skeleton'
import { Button } from '@/components/ui/button'

import { Users, UserPlus, FolderOpen, FolderCheck } from 'lucide-react'

import {
  BarChart,
  Bar,
  ResponsiveContainer,
  XAxis,
  YAxis,
  Tooltip,
} from 'recharts'

import { UpcomingAppointments } from '@/components/UpcomingAppointments'
import { UpcomingPafDeadlines } from '@/components/dashboard/UpcomingPafDeadlines'
import { DashboardStatCard } from '@/components/dashboard/DashboardStatCard'

interface StatData {
  name: string
  value: number
}

interface ManagerStats {
  newCasesThisMonth: number
  closedCasesThisMonth: number
  acolhidasCount: number
  acompanhamentosCount: number
  workloadByAgent: StatData[]
  workloadBySpecialist: StatData[]
}

export function ManagerDashboard() {
  const {
    data: stats,
    isLoading,
    isError,
    refetch,
  } = useQuery<ManagerStats>({
    queryKey: ['stats', 'manager'],
    queryFn: async () => {
      const res = await api.get('/stats')
      return res.data
    },
    staleTime: 1000 * 60 * 5,
    retry: 1,
  })

  /* Skeleton Loader (padr√£o global do sistema) */
  const renderSkeletons = () => (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
      {[1, 2, 3, 4].map((i) => (
        <Skeleton key={i} className="h-28 w-full rounded-2xl" />
      ))}
    </div>
  )

  /* Estado de erro elegante */
  if (isError) {
    return (
      <Card className="border-destructive/40 bg-destructive/10 text-destructive">
        <CardHeader>
          <CardTitle>Erro ao carregar dados</CardTitle>
          <CardDescription>
            N√£o foi poss√≠vel carregar as estat√≠sticas do painel.
          </CardDescription>
        </CardHeader>
        <CardContent>
          <Button variant="destructive" onClick={() => refetch()}>
            Tentar novamente
          </Button>
        </CardContent>
      </Card>
    )
  }

  return (
    <>
      {/* ESTADO ‚Äî LOADING */}
      {isLoading && renderSkeletons()}

      {/* ESTADO ‚Äî OK */}
      {!isLoading && stats && (
        <>
          {/* ===================== */}
          {/* TOP CARDS ‚Äî DESTAQUES */}
          {/* ===================== */}

          <motion.div
            className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.25 }}
          >
            <DashboardStatCard
              title="Novos Casos (M√™s)"
              value={stats.newCasesThisMonth}
              icon={UserPlus}
              colorClass="text-blue-500"
            />

            <DashboardStatCard
              title="Acolhidas Ativas"
              value={stats.acolhidasCount}
              icon={Users}
              colorClass="text-amber-500"
            />

            <DashboardStatCard
              title="Acompanhamentos PAEFI"
              value={stats.acompanhamentosCount}
              icon={FolderOpen}
              colorClass="text-purple-500"
            />

            <DashboardStatCard
              title="Desligados (M√™s)"
              value={stats.closedCasesThisMonth}
              icon={FolderCheck}
              colorClass="text-emerald-500"
            />
          </motion.div>

          <p className="text-xs text-muted-foreground mt-3 text-right">
            Atualizado em: {new Date().toLocaleString('pt-BR')}
          </p>

          {/* ================== */}
          {/* GR√ÅFICOS PRINCIPAIS */}
          {/* ================== */}

          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
            <Card>
              <CardHeader>
                <CardTitle>Carga de Trabalho ‚Äî Acolhida</CardTitle>
                <CardDescription>
                  Distribui√ß√£o de casos por agente social.
                </CardDescription>
              </CardHeader>

              <CardContent>
                <ResponsiveContainer width="100%" height={260}>
                  <BarChart data={stats.workloadByAgent} layout="vertical">
                    <XAxis type="number" hide />
                    <YAxis
                      dataKey="name"
                      type="category"
                      width={120}
                      tickLine={false}
                      axisLine={false}
                    />
                    <Tooltip />
                    <Bar
                      dataKey="value"
                      fill="hsl(var(--primary))"
                      radius={[0, 4, 4, 0]}
                    />
                  </BarChart>
                </ResponsiveContainer>
              </CardContent>
            </Card>

            <Card>
              <CardHeader>
                <CardTitle>Carga de Trabalho ‚Äî PAEFI</CardTitle>
                <CardDescription>
                  Distribui√ß√£o de casos entre especialistas t√©cnicos.
                </CardDescription>
              </CardHeader>

              <CardContent>
                <ResponsiveContainer width="100%" height={260}>
                  <BarChart data={stats.workloadBySpecialist} layout="vertical">
                    <XAxis type="number" hide />
                    <YAxis
                      dataKey="name"
                      type="category"
                      width={120}
                      tickLine={false}
                      axisLine={false}
                    />
                    <Tooltip />
                    <Bar
                      dataKey="value"
                      fill="hsl(var(--primary))"
                      radius={[0, 4, 4, 0]}
                    />
                  </BarChart>
                </ResponsiveContainer>
              </CardContent>
            </Card>
          </div>

          {/* ==================== */}
          {/* SE√á√ïES COMPLEMENTARES */}
          {/* ==================== */}

          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
            <UpcomingAppointments />
            <UpcomingPafDeadlines />
          </div>
        </>
      )}
    </>
  )
}


==================================================
FILE: frontend\src\pages\NotFound.tsx
==================================================

// frontend/src/pages/NotFound.tsx
import { Link } from 'react-router-dom'
import { ROUTES } from '@/constants/routes' //
import { Button } from '@/components/ui/button' //
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card' //

export function NotFound() {
¬† return (
    // CORRE√á√ÉO 1: Usa 'min-h-screen' para centralizar na tela inteira
¬† ¬† <div className="flex min-h-screen w-full items-center justify-center bg-background p-4">
¬† ¬† ¬† <Card className="max-w-md w-full text-center shadow-md"> {/* */}
¬† ¬† ¬† ¬† <CardHeader> {/* */}
¬† ¬† ¬† ¬† ¬† <CardTitle className="text-4xl font-bold text-destructive">404</CardTitle> {/* */}
¬† ¬† ¬† ¬† </CardHeader>
¬† ¬† ¬† ¬† <CardContent> {/* */}
¬† ¬† ¬† ¬† ¬† <p className="mt-2 text-lg text-muted-foreground">
¬† ¬† ¬† ¬† ¬† ¬† P√°gina n√£o encontrada.
¬† ¬† ¬† ¬† ¬† </p>
¬† ¬† ¬† ¬† ¬† <p className="mt-1 text-sm text-muted-foreground">
¬† ¬† ¬† ¬† ¬† ¬† A p√°gina que voc√™ procura n√£o existe ou foi movida.
¬† ¬† ¬† ¬† ¬† </p>

          {/* CORRE√á√ÉO 2: Usa o padr√£o 'asChild' do Shadcn/ui */}
¬† ¬† ¬† ¬† ¬† <Button asChild className="mt-6 w-full">
¬† ¬† ¬† ¬† ¬† ¬† <Link to={ROUTES.DASHBOARD}>Voltar para o Painel</Link> {/* */}
¬† ¬† ¬† ¬† ¬† </Button>
¬† ¬† ¬† ¬† </CardContent>
¬† ¬† ¬† </Card>
¬† ¬† </div>
¬† )
}

==================================================
FILE: frontend\src\pages\Reports.tsx
==================================================

// frontend/src/pages/Reports.tsx
import { useQuery } from '@tanstack/react-query'
import { api } from '@/lib/api'
import {
  Bar,
  BarChart,
  ResponsiveContainer,
  XAxis,
  YAxis,
  Tooltip,
  PieChart,
  Pie,
  Cell,
  Legend,
} from 'recharts'
import { Loader2 } from 'lucide-react'
import {
  Card,
  CardContent,
  CardHeader,
  CardTitle,
  CardDescription,
} from '@/components/ui/card'
import { RmaReport } from '@/components/RmaReport'

// Define compatibilidade e previne crash
interface StatData {
  name: string
  value: number
  [key: string]: any
}

interface Stats {
  totalCases: number
  acolhidasCount: number
  acompanhamentosCount: number
  casesByViolation: StatData[]
  casesByCategory: StatData[]
  casesByUrgency: StatData[]
  productivity: StatData[]
}

const COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#AF19FF', '#FF4560', '#775DD0']

export function Reports() {
  const {
    data: stats,
    isLoading,
    isError,
  } = useQuery<Stats>({
    queryKey: ['reports-stats'], // Corre√ß√£o: evita colis√£o de cache
    queryFn: async () => {
      const response = await api.get('/stats')
      return response.data
    },
  })

  if (isLoading) {
    return (
      <div className="flex h-full items-center justify-center">
        <Loader2 className="h-8 w-8 animate-spin text-primary" />
      </div>
    )
  }

  if (isError || !stats) {
    return (
      <div className="p-8 text-center text-destructive">
        Falha ao carregar as estat√≠sticas.
      </div>
    )
  }

  return (
    <div className="space-y-6">
      <h1 className="text-3xl font-bold">Painel Gerencial</h1>

      {/* Cards de estat√≠sticas principais */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
        <Card>
          <CardHeader>
            <CardTitle>Total de Casos</CardTitle>
            <CardDescription>N√∫mero total de casos no sistema.</CardDescription>
          </CardHeader>
          <CardContent>
            <p className="text-4xl font-bold">{stats.totalCases}</p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle>Acolhidas</CardTitle>
            <CardDescription>Casos atualmente em acolhida.</CardDescription>
          </CardHeader>
          <CardContent>
            <p className="text-4xl font-bold">{stats.acolhidasCount}</p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle>Acompanhamentos</CardTitle>
            <CardDescription>Casos atualmente em PAEFI.</CardDescription>
          </CardHeader>
          <CardContent>
            <p className="text-4xl font-bold">{stats.acompanhamentosCount}</p>
          </CardContent>
        </Card>
      </div>

      {/* Gr√°ficos */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* Casos por Urg√™ncia */}
        <Card>
          <CardHeader>
            <CardTitle>Casos por N√≠vel de Urg√™ncia</CardTitle>
          </CardHeader>
          <CardContent>
            {stats.casesByUrgency.length === 0 ? (
              <p className="text-muted-foreground">Sem dados suficientes.</p>
            ) : (
              <ResponsiveContainer width="100%" height={300}>
                <BarChart
                  data={stats.casesByUrgency}
                  margin={{ top: 10, right: 10, left: 10, bottom: 20 }}
                >
                  <XAxis
                    dataKey="name"
                    stroke="hsl(var(--muted-foreground))"
                    fontSize={10}
                    tickLine={false}
                    axisLine={false}
                    angle={-45}
                    textAnchor="end"
                    interval={0}
                    height={80}
                  />
                  <YAxis stroke="hsl(var(--muted-foreground))" />
                  <Tooltip />
                  <Bar dataKey="value">
                    {stats.casesByUrgency.map((_entry, index) => (
                      <Cell key={index} fill={COLORS[index % COLORS.length]} />
                    ))}
                  </Bar>
                </BarChart>
              </ResponsiveContainer>
            )}
          </CardContent>
        </Card>

        {/* Casos por Categoria */}
        <Card>
          <CardHeader>
            <CardTitle>Casos por Categoria de P√∫blico</CardTitle>
          </CardHeader>
          <CardContent>
            {stats.casesByCategory.length === 0 ? (
              <p className="text-muted-foreground">Sem dados suficientes.</p>
            ) : (
              <ResponsiveContainer width="100%" height={300}>
                <PieChart>
                  <Pie
                    data={stats.casesByCategory}
                    cx="50%"
                    cy="50%"
                    outerRadius={90}
                    label
                    labelLine={false}
                    dataKey="value"
                    nameKey="name"
                  >
                    {stats.casesByCategory.map((_entry, index) => (
                      <Cell key={index} fill={COLORS[index % COLORS.length]} />
                    ))}
                  </Pie>
                  <Tooltip />
                  <Legend />
                </PieChart>
              </ResponsiveContainer>
            )}
          </CardContent>
        </Card>
      </div>

      {/* Produtividade */}
      <Card>
        <CardHeader>
          <CardTitle>Produtividade por T√©cnico</CardTitle>
          <CardDescription>
            Distribui√ß√£o de casos por profissional respons√°vel.
          </CardDescription>
        </CardHeader>
        <CardContent>
          {stats.productivity.length === 0 ? (
            <p className="text-muted-foreground">Nenhum registro dispon√≠vel.</p>
          ) : (
            <ResponsiveContainer width="100%" height={300}>
              <BarChart data={stats.productivity}>
                <XAxis
                  dataKey="name"
                  stroke="hsl(var(--muted-foreground))"
                  fontSize={12}
                  tickLine={false}
                  axisLine={false}
                />
                <YAxis stroke="hsl(var(--muted-foreground))" />
                <Tooltip />
                <Bar dataKey="value">
                  {stats.productivity.map((_entry, index) => (
                    <Cell key={index} fill={COLORS[index % COLORS.length]} />
                  ))}
                </Bar>
              </BarChart>
            </ResponsiveContainer>
          )}
        </CardContent>
      </Card>

      {/* Relat√≥rio RMA */}
      <RmaReport />
    </div>
  )
}


==================================================
FILE: frontend\src\pages\SocialAgentDashboard.tsx
==================================================

import { useQuery } from '@tanstack/react-query'
import { api } from '@/lib/api'
import { Users, UserCheck, FolderInput, LucideIcon } from 'lucide-react'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { Skeleton } from '@/components/ui/skeleton'
import { UpcomingAppointments } from '@/components/UpcomingAppointments'
import { Button } from '@/components/ui/button'
import { Link } from 'react-router-dom'
import { ROUTES } from '@/constants/routes'

interface AgentStats {
  role: 'Agente Social'
  myActiveCases: number
  myClosedMonth: number
  myNewCasesMonth: number
}

interface StatCardProps {
  title: string
  value: number | undefined
  icon: LucideIcon
  colorClass: string
}

function StatCard({ title, value, icon: Icon, colorClass }: StatCardProps) {
  return (
    <Card>
      <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
        <CardTitle className="text-sm font-medium text-muted-foreground">
          {title}
        </CardTitle>
        <Icon className={`h-4 w-4 ${colorClass}`} />
      </CardHeader>
      <CardContent>
        <div className="text-2xl font-bold">{value ?? '-'}</div>
      </CardContent>
    </Card>
  )
}

export function SocialAgentDashboard() {
  const { data: stats, isLoading, isError } = useQuery<AgentStats>({
    queryKey: ['stats', 'agent'],
    queryFn: async () => {
      const res = await api.get('/stats')
      return res.data
    },
    retry: 1,
  })

  if (isLoading) {
    return (
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        {[1, 2, 3].map((i) => (
          <Skeleton key={i} className="h-32 w-full" />
        ))}
      </div>
    )
  }

  if (isError || !stats) {
    return (
      <div className="text-center text-sm text-red-600">
        N√£o foi poss√≠vel carregar as estat√≠sticas.
      </div>
    )
  }

  return (
    <div className="space-y-6">
      {/* 1. Cart√µes de Estat√≠sticas */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <StatCard
          title="Em Acolhida (Ativos)"
          value={stats.myActiveCases}
          icon={Users}
          colorClass="text-blue-500"
        />
        <StatCard
          title="Novos (Este M√™s)"
          value={stats.myNewCasesMonth}
          icon={FolderInput}
          colorClass="text-amber-500"
        />
        <StatCard
          title="Finalizados (Este M√™s)"
          value={stats.myClosedMonth}
          icon={UserCheck}
          colorClass="text-emerald-500"
        />
      </div>

      {/* 2. √Årea de A√ß√£o R√°pida */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* Lado Esquerdo: Agenda */}
        <UpcomingAppointments />

        {/* Lado Direito: Atalho para gest√£o */}
        <Card className="flex flex-col justify-center items-center p-6 text-center space-y-4">
          <h3 className="text-lg font-semibold">Gest√£o de Casos</h3>
          <p className="text-sm text-muted-foreground max-w-xs">
            Acesse a lista completa para realizar evolu√ß√µes ou encaminhamentos.
          </p>
          <Button asChild size="lg" className="w-full max-w-xs">
            <Link to={ROUTES.CASES}>Ver Minha Caixa de Acolhida</Link>
          </Button>
        </Card>
      </div>
    </div>
  )
}


==================================================
FILE: frontend\src\pages\TeamOverview.tsx
==================================================

// frontend/src/pages/TeamOverview.tsx
import { useQuery } from '@tanstack/react-query'
import { Link } from 'react-router-dom'
import { Loader2 } from 'lucide-react'

import { api } from '@/lib/api'
import { ROUTES } from '@/constants/routes'
import {
  Card,
  CardContent,
  CardHeader,
  CardTitle,
  CardDescription,
} from '@/components/ui/card'
import {
  Accordion,
  AccordionContent,
  AccordionItem,
  AccordionTrigger,
} from "@/components/ui/accordion"
import { Badge } from '@/components/ui/badge'

interface CaseInfo {
  id: string
  nomeCompleto: string
}

interface TechnicianOverview {
  nome: string
  cargo: string
  cases: CaseInfo[]
}

export function TeamOverview() {
  const { data: overview, isLoading, isError } = useQuery<TechnicianOverview[]>({
    queryKey: ['reports', 'team-overview'], // üî• corre√ß√£o importante
    queryFn: async () => {
      const response = await api.get('/reports/team-overview')
      return response.data
    },
  })

  return (
    <div className="space-y-6">
      <div>
        <h1 className="text-2xl font-bold">Casos Ativos (Equipe)</h1>
        <p className="text-muted-foreground">
          Visualize todos os casos ativos distribu√≠dos por cada t√©cnico.
        </p>
      </div>

      <Card>
        <CardHeader>
          <CardTitle>Distribui√ß√£o de Casos por T√©cnico</CardTitle>
          <CardDescription>
            Clique num t√©cnico para expandir e ver seus casos atribu√≠dos.
          </CardDescription>
        </CardHeader>

        <CardContent>
          {/* LOADING */}
          {isLoading && (
            <div className="flex h-64 items-center justify-center">
              <Loader2 className="mx-auto h-8 w-8 animate-spin text-primary" />
            </div>
          )}

          {/* ERRO */}
          {isError && (
            <p className="text-destructive text-center py-8">
              N√£o foi poss√≠vel carregar os dados da equipe.
            </p>
          )}

          {/* VAZIO */}
          {!isLoading && !isError && overview?.length === 0 && (
            <p className="text-muted-foreground text-center py-8">
              Nenhum t√©cnico encontrado.
            </p>
          )}

          {/* LISTA */}
          {!isLoading && !isError && overview && overview.length > 0 && (
            <Accordion type="single" collapsible className="w-full">
              {overview.map((tech, index) => (
                <AccordionItem
                  value={`tech-${tech.nome}-${index}`} // üîí valor √∫nico e seguro
                  key={index}
                >
                  <AccordionTrigger>
                    <div className="flex w-full justify-between items-center">
                      <span className="font-semibold">{tech.nome}</span>

                      <Badge variant="secondary">
                        {tech.cases?.length ?? 0} casos
                      </Badge>
                    </div>
                  </AccordionTrigger>

                  <AccordionContent>
                    <ul className="space-y-2 pt-2 pl-4 border-l-2 ml-2 border-muted">
                      {(tech.cases ?? []).map((c) => (
                        <li key={c.id} className="text-sm py-1">
                          <Link
                            to={ROUTES.CASE_DETAIL(c.id)}
                            className="text-primary hover:underline font-medium"
                          >
                            {c.nomeCompleto}
                          </Link>
                        </li>
                      ))}

                      {tech.cases?.length === 0 && (
                        <li className="text-sm text-muted-foreground italic">
                          Nenhum caso ativo atribu√≠do.
                        </li>
                      )}
                    </ul>
                  </AccordionContent>
                </AccordionItem>
              ))}
            </Accordion>
          )}
        </CardContent>
      </Card>
    </div>
  )
}


==================================================
FILE: frontend\src\pages\TechnicianDashboard.tsx
==================================================

// frontend/src/pages/TechnicianDashboard.tsx ‚Äî P√°gina do painel do Especialista (PAEFI), modernizada e otimizada.

import { useQuery } from '@tanstack/react-query'
import { api } from '@/lib/api'
import { Activity, CheckCircle, Clock } from 'lucide-react'
import { Skeleton } from '@/components/ui/skeleton'
import { UpcomingAppointments } from '@/components/UpcomingAppointments'
import { UpcomingPafDeadlines } from '@/components/dashboard/UpcomingPafDeadlines'
import { DashboardStatCard } from '@/components/dashboard/DashboardStatCard'
import { motion } from 'framer-motion'

interface SpecialistStats {
  role: 'Especialista'
  myActiveCases: number
  myClosedMonth: number
  myNewCasesMonth: number
}

export function TechnicianDashboard() {
  const {
    data: stats,
    isLoading,
    isError,
    refetch,
  } = useQuery<SpecialistStats>({
    queryKey: ['stats', 'specialist'],
    queryFn: async () => {
      const res = await api.get('/stats')
      return res.data
    },
    staleTime: 1000 * 60 * 5, // cache suave de 5 min
    retry: 1, // evita loops de erro
  })

  /** Skeleton padronizado */
  const renderSkeletons = () => (
    <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
      {[1, 2, 3].map((i) => (
        <Skeleton key={i} className="h-28 w-full rounded-2xl" />
      ))}
    </div>
  )

  /** Estado de erro elegante */
  if (isError) {
    return (
      <div className="p-4 rounded-xl border bg-destructive/10 text-destructive">
        <p className="font-medium">‚ùå Erro ao carregar os dados.</p>
        <button
          onClick={() => refetch()}
          className="mt-2 text-sm underline hover:text-destructive/70"
        >
          Tentar novamente
        </button>
      </div>
    )
  }

  return (
    <div className="space-y-6">
      {/* 1 ‚Äî Cards de estat√≠stica */}
      {isLoading ? (
        renderSkeletons()
      ) : (
        <motion.div
          className="grid grid-cols-1 md:grid-cols-3 gap-4"
          initial={{ opacity: 0, y: 10 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.25 }}
        >
          <DashboardStatCard
            title="Meus Casos PAEFI"
            value={stats?.myActiveCases}
            icon={Activity}
            colorClass="text-blue-500"
            description="Em acompanhamento ativo"
          />

          <DashboardStatCard
            title="Novos (M√™s)"
            value={stats?.myNewCasesMonth}
            icon={Clock}
            colorClass="text-amber-500"
            description="Atribu√≠dos este m√™s"
          />

          <DashboardStatCard
            title="Finalizados (M√™s)"
            value={stats?.myClosedMonth}
            icon={CheckCircle}
            colorClass="text-emerald-500"
            description="Desligamentos realizados"
          />
        </motion.div>
      )}

      {/* 2 ‚Äî √Årea de trabalho */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <UpcomingAppointments />
        <UpcomingPafDeadlines />
      </div>
    </div>
  )
}


==================================================
FILE: frontend\src\pages\UserManagement.tsx
==================================================

// frontend/src/pages/UserManagement.tsx
import { useState } from 'react'
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'
import { useForm, Controller } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { z } from 'zod' // Importa√ß√£o adicionada
import { api } from '@/lib/api'
import { Loader2, Trash2, Edit } from 'lucide-react'
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table'
import { Button } from '@/components/ui/button'
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card'
import { toast } from 'sonner'
import { getErrorMessage } from '@/utils/error'
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
  AlertDialogTrigger,
} from '@/components/ui/alert-dialog'
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
  DialogFooter,
  DialogClose,
} from '@/components/ui/dialog'
import { Label } from '@/components/ui/label'
import { Input } from '@/components/ui/input'
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select'
import { editUserFormSchema } from '@/schemas/userSchemas'
import type { User } from '@/types/user'

type EditUserFormData = z.infer<typeof editUserFormSchema>

function EditUserModal({ user, onOpenChange }: { user: User; onOpenChange: (open: boolean) => void }) {
  const queryClient = useQueryClient()
  const {
    control,
    handleSubmit,
    formState: { errors },
  } = useForm<EditUserFormData>({
    resolver: zodResolver(editUserFormSchema),
    defaultValues: user,
  })

  const { mutate: updateUser, isPending } = useMutation({
    mutationFn: async (data: EditUserFormData) => {
      return api.put(`/users/${user.id}`, data)
    },
    onSuccess: () => {
      toast.success('Utilizador atualizado com sucesso!')
      queryClient.invalidateQueries({ queryKey: ['users'] })
      onOpenChange(false)
    },
    onError: (error) => {
      toast.error(getErrorMessage(error))
    },
  })

  const onSubmit = (data: EditUserFormData) => {
    updateUser(data)
  }

  return (
    <DialogContent>
      <DialogHeader>
        <DialogTitle>Editar Utilizador</DialogTitle>
      </DialogHeader>
      <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
        <div className="space-y-2">
          <Label htmlFor="nome">Nome Completo</Label>
          <Controller name="nome" control={control} render={({ field }) => <Input id="nome" {...field} />} />
          {errors.nome && <p className="text-sm text-destructive">{errors.nome.message}</p>}
        </div>
        <div className="space-y-2">
          <Label htmlFor="email">Email</Label>
          <Controller name="email" control={control} render={({ field }) => <Input id="email" type="email" {...field} />} />
          {errors.email && <p className="text-sm text-destructive">{errors.email.message}</p>}
        </div>
        <div className="space-y-2">
          <Label htmlFor="cargo">Cargo</Label>
          <Controller
            name="cargo"
            control={control}
            render={({ field }) => (
              <Select onValueChange={field.onChange} value={field.value}>
                <SelectTrigger><SelectValue /></SelectTrigger>
                <SelectContent>
                  <SelectItem value="Agente Social">Agente Social</SelectItem>
                  <SelectItem value="Especialista">Especialista</SelectItem>
                  <SelectItem value="Gerente">Gerente</SelectItem>
                </SelectContent>
              </Select>
            )}
          />
          {errors.cargo && <p className="text-sm text-destructive">{errors.cargo.message}</p>}
        </div>
        <DialogFooter>
          <DialogClose asChild>
            <Button type="button" variant="outline">Cancelar</Button>
          </DialogClose>
          <Button type="submit" disabled={isPending}>
            {isPending && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
            Salvar Altera√ß√µes
          </Button>
        </DialogFooter>
      </form>
    </DialogContent>
  )
}

export function UserManagement() {
  const queryClient = useQueryClient()
  const [editingUser, setEditingUser] = useState<User | null>(null)

  const { data: users, isLoading, isError } = useQuery<User[]>({
    queryKey: ['users'],
    queryFn: async () => {
      const response = await api.get('/users')
      return response.data
    },
  })

  const { mutate: deleteUser, isPending: isDeleting } = useMutation({
    mutationFn: async (userId: string) => {
      return api.delete(`/users/${userId}`)
    },
    onSuccess: () => {
      toast.success('Utilizador desativado com sucesso!')
      queryClient.invalidateQueries({ queryKey: ['users'] })
    },
    onError: (error) => {
      toast.error(getErrorMessage(error, 'Falha ao desativar o utilizador.'))
    },
  })

  return (
    <div className="space-y-6">
      <div>
        <h1 className="text-2xl font-bold">Gest√£o de Utilizadores</h1>
        <p className="text-muted-foreground">
          Edite ou desative os profissionais do sistema.
        </p>
      </div>
      <Card>
        <CardHeader>
          <CardTitle>Profissionais Ativos</CardTitle>
          <CardDescription>Lista de todos os agentes e especialistas.</CardDescription>
        </CardHeader>
        <CardContent>
          <div className="rounded-lg border">
            <Table>
              <TableHeader>
                <TableRow>
                  <TableHead>Nome</TableHead>
                  <TableHead>Email</TableHead>
                  <TableHead>Cargo</TableHead>
                  <TableHead className="text-right">A√ß√µes</TableHead>
                </TableRow>
              </TableHeader>
              <TableBody>
                {isLoading && ( <TableRow><TableCell colSpan={4} className="h-24 text-center"><Loader2 className="mx-auto h-8 w-8 animate-spin text-primary" /></TableCell></TableRow> )}
                {isError && ( <TableRow><TableCell colSpan={4} className="py-10 text-center text-destructive">Falha ao carregar os utilizadores.</TableCell></TableRow> )}
                {users?.map((user) => (
                  <TableRow key={user.id}>
                    <TableCell className="font-medium">{user.nome}</TableCell>
                    <TableCell>{user.email}</TableCell>
                    <TableCell>{user.cargo}</TableCell>
                    <TableCell className="text-right">
                      <Dialog open={editingUser?.id === user.id} onOpenChange={(isOpen) => !isOpen && setEditingUser(null)}>
                        <DialogTrigger asChild>
                          <Button variant="ghost" size="icon" onClick={() => setEditingUser(user)}>
                            <Edit className="h-4 w-4" />
                          </Button>
                        </DialogTrigger>
                        {editingUser?.id === user.id && <EditUserModal user={editingUser} onOpenChange={(isOpen) => !isOpen && setEditingUser(null)} />}
                      </Dialog>
                      
                      <AlertDialog>
                        <AlertDialogTrigger asChild>
                          <Button variant="ghost" size="icon" className="text-destructive">
                            <Trash2 className="h-4 w-4" />
                          </Button>
                        </AlertDialogTrigger>
                        <AlertDialogContent>
                          <AlertDialogHeader>
                            <AlertDialogTitle>Tem a certeza?</AlertDialogTitle>
                            <AlertDialogDescription>Esta a√ß√£o ir√° desativar o utilizador "{user.nome}". Ele n√£o poder√° mais aceder ao sistema. Esta a√ß√£o n√£o pode ser desfeita facilmente.</AlertDialogDescription>
                          </AlertDialogHeader>
                          <AlertDialogFooter>
                            <AlertDialogCancel>Cancelar</AlertDialogCancel>
                            <AlertDialogAction onClick={() => deleteUser(user.id)} disabled={isDeleting}>Confirmar</AlertDialogAction>
                          </AlertDialogFooter>
                        </AlertDialogContent>
                      </AlertDialog>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </div>
        </CardContent>
      </Card>
    </div>
  )
}

==================================================
FILE: frontend\src\ProtectedRoute.tsx
==================================================

import { Navigate, Outlet, useLocation } from 'react-router-dom'
import { useAuth } from './hooks/useAuth'
import { ROUTES } from './constants/routes'
import { ReactNode } from 'react'
import { Loader2 } from 'lucide-react'
import type { UserRole } from '@/types/user'

interface ProtectedRouteProps {
  children?: ReactNode
  allowedRoles: UserRole[]
}

export function ProtectedRoute({ children, allowedRoles }: ProtectedRouteProps) {
  const { user, isSessionLoading } = useAuth()
  const location = useLocation()

  // Enquanto a sess√£o √© validada
  if (isSessionLoading || user === undefined) {
    return (
      <div className="flex h-full w-full items-center justify-center p-10">
        <Loader2 className="h-12 w-12 animate-spin text-primary" />
      </div>
    )
  }

  // Usu√°rio n√£o autenticado ‚Üí login
  if (!user) {
    return <Navigate to={ROUTES.LOGIN} state={{ from: location }} replace />
  }

  // Usu√°rio sem permiss√£o ‚Üí dashboard
  if (!allowedRoles.includes(user.cargo as UserRole)) {
    return <Navigate to={ROUTES.DASHBOARD} replace />
  }

  // Usu√°rio autorizado ‚Üí renderiza filhos ou Outlet
  return children || <Outlet />
}


==================================================
FILE: frontend\src\schemas\caseSchemas.ts
==================================================

// frontend/src/schemas/caseSchemas.ts
import { z } from 'zod' //

// --- Fun√ß√µes de Valida√ß√£o Customizadas ---
function validaCPF(cpf: string): boolean { //
  cpf = cpf.replace(/[^\d]+/g, '') //
  if (cpf.length !== 11 || /^(\d)\1+$/.test(cpf)) return false //
  let add = 0
  for (let i = 0; i < 9; i++) add += parseInt(cpf.charAt(i)) * (10 - i) //
  let rev = 11 - (add % 11) //
  if (rev === 10 || rev === 11) rev = 0 //
  if (rev !== parseInt(cpf.charAt(9))) return false //
  add = 0
  for (let i = 0; i < 10; i++) add += parseInt(cpf.charAt(i)) * (11 - i) //
  rev = 11 - (add % 11) //
  if (rev === 10 || rev === 11) rev = 0 //
  if (rev !== parseInt(cpf.charAt(10))) return false //
  return true //
}

const requiredFieldMessage = 'Este campo √© obrigat√≥rio.' //

// --- Schemas de Formul√°rio ---
export const createCaseFormSchema = z.object({ //
  nomeCompleto: z.string().min(3, 'O nome deve ter no m√≠nimo 3 caracteres.'), //
  cpf: z.string().refine(validaCPF, { message: 'CPF inv√°lido.' }), //
  nascimento: z.string().min(1, requiredFieldMessage), //
  sexo: z.string().min(1, requiredFieldMessage), //
  telefone: z.string().refine((tel) => tel.replace(/\D/g, '').length >= 10, { //
    message: 'Telefone inv√°lido.', //
  }),
  endereco: z.string().min(5, 'O endere√ßo √© obrigat√≥rio.'), //
  dataEntrada: z.string(), //
  urgencia: z.string().min(1, requiredFieldMessage), //
  violacao: z.string().min(1, requiredFieldMessage), //
  categoria: z.string().min(1, requiredFieldMessage), //
  orgaoDemandante: z.string().min(1, requiredFieldMessage), //
  numeroSei: z.string().optional(), //
  linkSei: z.string().url('URL inv√°lida.').optional().or(z.literal('')), //
  agenteAcolhidaId: z.string().min(1, '√â obrigat√≥rio selecionar um agente.'), //
  observacoes: z.string().optional(), //
  beneficios: z.array(z.string()).optional(), //
})

export type CreateCaseFormData = z.infer<typeof createCaseFormSchema> //

export const evolutionFormSchema = z.object({ //
  conteudo: z.string().min(10, 'A evolu√ß√£o deve ter no m√≠nimo 10 caracteres.'), //
})

// --- ALTERA√á√ÉO APLICADA AQUI ---
export const pafFormSchema = z.object({ //
  diagnostico: z.string().min(10, 'O diagn√≥stico √© muito curto.'), //
  objetivos: z.string().min(10, 'Defina objetivos claros.'), //
  estrategias: z.string().min(10, 'Defina estrat√©gias claras.'), //
  
  // Trocado 'prazos' (String) por 'deadline' (Data)
  deadline: z.string().refine((val) => val && !isNaN(Date.parse(val)), { // Valida que √© uma string de data n√£o vazia
    message: 'A data do prazo √© obrigat√≥ria.',
  }),
})
// --- FIM DA ALTERA√á√ÉO ---

export const closeCaseFormSchema = z.object({ //
  motivoDesligamento: z.string().min(1, 'O motivo √© obrigat√≥rio.'), //
  parecerFinal: z.string().min(10, 'O parecer final √© muito curto.'), //
})

==================================================
FILE: frontend\src\schemas\userSchemas.ts
==================================================

// frontend/src/schemas/userSchemas.ts
import { z } from 'zod'

export const editUserFormSchema = z.object({
  nome: z.string().min(3, 'O nome deve ter pelo menos 3 caracteres.'),
  email: z.string().email('Por favor, insira um email v√°lido.'),
  // Corre√ß√£o: `z.enum` aceita um par√¢metro 'message' para todos os erros.
  // Como o <Select> envia uma string vazia ("") quando nada √© selecionado,
  // e "" n√£o √© um valor v√°lido do enum, esta mensagem ser√° exibida.
  cargo: z.enum(['Gerente', 'Agente Social', 'Especialista'], {
    message: "√â obrigat√≥rio selecionar um cargo.",
  }),
})

==================================================
FILE: frontend\src\styles\index.css
==================================================

@tailwind base;
@tailwind components;
@tailwind utilities;

/* ----------------------------- */
/*      TEMA GOV.BR MODERNO      */
/* ----------------------------- */

@layer base {
  :root {
    /* Fundo claro GOV-BR */
    --background: 210 40% 98%;
    --foreground: 222 47% 11%;

    /* Cards */
    --card: 0 0% 100%;
    --card-foreground: 222 47% 11%;

    --popover: 0 0% 100%;
    --popover-foreground: 222 47% 11%;

    /* Azul Gov.br */
    --primary: 217 80% 39%;
    --primary-foreground: 210 40% 98%;

    /* Secund√°rio */
    --secondary: 210 40% 96.1%;
    --secondary-foreground: 222 47% 11%;

    /* Muted */
    --muted: 210 40% 96.1%;
    --muted-foreground: 215.4 16.3% 46.9%;

    /* Acento */
    --accent: 210 40% 93%;
    --accent-foreground: 222 47% 11%;

    /* Erro */
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 210 40% 98%;

    /* Bordas */
    --border: 214.3 31.8% 91.4%;
    --input: 214.3 31.8% 91.4%;
    --ring: 217 80% 39%;

    --radius: 0.5rem;
  }

  /* ------------------------------ */
  /*        MODO ESCURO GOV-BR      */
  /* ------------------------------ */

  .dark {
    --background: 222 47% 11%;
    --foreground: 210 40% 98%;

    --card: 217 33% 17%;
    --card-foreground: 210 40% 98%;

    --popover: 222 47% 11%;
    --popover-foreground: 210 40% 98%;

    --primary: 217 91% 64%;
    --primary-foreground: 222 47% 11%;

    --secondary: 217.2 32.6% 17.5%;
    --secondary-foreground: 210 40% 98%;

    --muted: 217.2 32.6% 17.5%;
    --muted-foreground: 215 20.2% 65.1%;

    --accent: 217.2 32.6% 17.5%;
    --accent-foreground: 210 40% 98%;

    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 40% 98%;

    --border: 217.2 32.6% 17.5%;
    --input: 217.2 32.6% 17.5%;
    --ring: 212.7 26.8% 83.9%;
  }
}

/* ------------------------------ */
/*      ESTILOS BASE COMUNS       */
/* ------------------------------ */

@layer base {
  * {
    @apply border-border;
  }

  body {
    @apply bg-background text-foreground;
    font-feature-settings: "rlig" 1, "calt" 1;
  }
}


==================================================
FILE: frontend\src\types\agenda.ts
==================================================

// frontend/src/types/agenda.ts

export interface UpcomingAppointment {
  id: string
  titulo: string
  data: string
  caso: {
    id: string
    nomeCompleto: string
  }
}

==================================================
FILE: frontend\src\types\case.ts
==================================================

// frontend/src/types/case.ts ‚Äî Tipagens otimizadas, consistentes e preparadas para futuras expans√µes.

export interface CaseLog {
  id: string
  acao: string
  descricao: string
  createdAt: string
  autor: {
    nome: string
  }
}

export interface CaseDetailData {
  id: string
  nomeCompleto: string
  cpf: string
  nascimento: string
  sexo: string
  telefone: string
  endereco: string
  dataEntrada: string
  urgencia: string
  violacao: string
  categoria: string
  orgaoDemandante: string
  numeroSei: string | null
  linkSei: string | null
  observacoes: string | null
  status: string

  // Rela√ß√µes
  criadoPor: {
    nome: string
  }
  agenteAcolhida: {
    id: string
    nome: string
  } | null

  especialistaPAEFI: {
    id: string
    nome: string
  } | null

  // Campos adicionais
  beneficios: string[]
  logs: CaseLog[]

  motivoDesligamento: string | null
  parecerFinal: string | null
  dataInicioPAEFI?: string
  dataDesligamento?: string
}

export interface Evolution {
  id: string
  conteudo: string
  createdAt: string
  autor: {
    nome: string
  }
}

export interface PafData {
  id: string
  diagnostico: string
  objetivos: string
  estrategias: string
  deadline: string
  createdAt: string
  autor: {
    id: string
    nome: string
  }
}

export interface UserOption {
  id: string
  nome: string
}

export interface CaseSummary {
  id: string
  nomeCompleto: string
  cpf: string
  status: string
  dataEntrada: string
  dataDesligamento?: string | null
  agenteAcolhida: {
    nome: string
  } | null
  especialistaPAEFI: {
    nome: string
  } | null
}


==================================================
FILE: frontend\src\types\user.ts
==================================================

// frontend/src/types/user.ts

export type UserRole = 'Gerente' | 'Agente Social' | 'Especialista'

export interface User {
  id: string
  nome: string
  cargo: UserRole
  email: string
}


==================================================
FILE: frontend\src\utils\error.ts
==================================================

// frontend/src/utils/error.ts
import axios from 'axios'

/**
 * Extrai uma mensagem de erro leg√≠vel de um objeto de erro desconhecido.
 * @param error O erro capturado no bloco catch.
 * @param defaultMessage Uma mensagem padr√£o para usar como fallback.
 * @returns A mensagem de erro extra√≠da.
 */
export function getErrorMessage(
  error: unknown,
  defaultMessage = 'Ocorreu um erro inesperado.',
): string {
  if (axios.isAxiosError(error) && error.response) {
    return error.response.data?.message || error.message
  }
  if (error instanceof Error) {
    return error.message
  }
  return defaultMessage
}



==================================================
FILE: frontend\src\utils\formatters.ts
==================================================

// frontend/src/utils/formatters.ts
import { format } from 'date-fns'
import { ptBR } from 'date-fns/locale'

/**
 * Formata uma string de CPF para o formato 000.000.000-00.
 */
export const formatCPF = (cpf?: string | null) => {
  if (!cpf) return ''

  const cleaned = cpf.replace(/\D/g, '')

  if (cleaned.length !== 11) return cpf // devolve como veio se inv√°lido

  return cleaned.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4')
}

/**
 * Formata uma string de telefone para (00) 00000-0000 ou (00) 0000-0000.
 */
export const formatPhone = (phone?: string | null) => {
  if (!phone) return ''

  const cleaned = phone.replace(/\D/g, '')

  if (cleaned.length < 10) return phone // telefone muito curto -> devolve original

  if (cleaned.length === 11) {
    // Celular
    return cleaned.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3')
  }

  // Telefone fixo
  return cleaned.replace(/(\d{2})(\d{4})(\d{4})/, '($1) $2-$3')
}

/**
 * Formata uma data no formato dd/MM/yyyy de forma segura.
 */
export const formatDateSafe = (dateInput?: string | null | Date) => {
  if (!dateInput) return 'N/A'

  const date = typeof dateInput === 'string' ? new Date(dateInput) : dateInput

  if (isNaN(date.getTime())) return 'Data inv√°lida'

  return format(date, 'dd/MM/yyyy', { locale: ptBR })
}

==================================================
FILE: frontend\src\utils\pdfGenerator.ts
==================================================

// frontend/src/utils/pdfGenerator.ts
import pdfMake from "pdfmake/build/pdfmake"
import pdfFonts from "pdfmake/build/vfs_fonts"
import type { CaseDetailData } from "@/types/case"
import { formatDateSafe, formatCPF, formatPhone } from "./formatters"

// Necess√°rio para funcionar no navegador
pdfMake.vfs = pdfFonts.pdfMake.vfs

/**
 * Gera o PDF do Prontu√°rio do Caso
 */
export const generateCasePDF = (caseData: CaseDetailData) => {
  const beneficiosSection =
    caseData.beneficios && caseData.beneficios.length > 0
      ? [
          { text: "BENEF√çCIOS ATIVOS:", style: "subHeader", margin: [0, 10, 0, 2] },
          {
            ul: caseData.beneficios,
            fontSize: 10,
            margin: [15, 0, 0, 10],
          },
        ]
      : []

  const pafSection =
    caseData.status === "EM_ACOMPANHAMENTO_PAEFI" ||
    caseData.status === "DESLIGADO"
      ? [
          {
            text: "3. PLANO DE ACOMPANHAMENTO FAMILIAR (PAF)",
            style: "sectionHeader",
            margin: [0, 15, 0, 5],
          },
          {
            text: "Consulte o sistema para detalhes completos do PAF vigente.",
            fontSize: 10,
            italics: true,
            margin: [0, 0, 0, 10],
          },
        ]
      : []

  const docDefinition: any = {
    pageSize: "A4",
    pageMargins: [40, 60, 40, 60],

    header: {
      margin: [40, 20, 40, 0],
      columns: [
        {
          text: [
            { text: "GOVERNO DO DISTRITO FEDERAL\n", bold: true, fontSize: 10 },
            { text: "SECRETARIA DE DESENVOLVIMENTO SOCIAL\n", fontSize: 9 },
            { text: "CREAS BRAZL√ÇNDIA - SGAC", fontSize: 9, italics: true },
          ],
          alignment: "center",
          color: "#444444",
        },
      ],
    },

    footer: (currentPage: number, pageCount: number) => ({
      text: `P√°gina ${currentPage} de ${pageCount} ‚Äî Gerado em ${new Date().toLocaleDateString(
        "pt-BR"
      )} via SGAC`,
      alignment: "center",
      fontSize: 8,
      color: "#888888",
      margin: [0, 10, 0, 0],
    }),

    content: [
      {
        text: "PRONTU√ÅRIO T√âCNICO",
        style: "header",
        alignment: "center",
        margin: [0, 0, 0, 20],
      },

      // 1 ‚Äî Identifica√ß√£o
      { text: "1. IDENTIFICA√á√ÉO DO USU√ÅRIO", style: "sectionHeader" },
      {
        style: "tableExample",
        table: {
          widths: ["*", "*", "*"],
          body: [
            [
              { text: "Nome Completo", style: "label" },
              { text: "CPF", style: "label" },
              { text: "Data de Nascimento", style: "label" },
            ],
            [
              caseData.nomeCompleto,
              formatCPF(caseData.cpf),
              formatDateSafe(caseData.nascimento),
            ],
            [
              { text: "Telefone", style: "label" },
              { text: "Sexo", style: "label" },
              { text: "Endere√ßo", style: "label" },
            ],
            [
              formatPhone(caseData.telefone),
              caseData.sexo ?? "N√£o informado",
              caseData.endereco ?? "N√£o informado",
            ],
          ],
        },
        layout: "lightHorizontalLines",
      },

      // 2 ‚Äî Dados do Atendimento
      {
        text: "2. DADOS DO ATENDIMENTO",
        style: "sectionHeader",
        margin: [0, 15, 0, 5],
      },
      {
        style: "tableExample",
        table: {
          widths: ["50%", "50%"],
          body: [
            [
              { text: `Status Atual: ${caseData.status.replace(/_/g, " ")}`, bold: true },
              { text: `Data de Entrada: ${formatDateSafe(caseData.dataEntrada)}` },
            ],
            [
              { text: `Viola√ß√£o: ${caseData.violacao}` },
              { text: `Urg√™ncia: ${caseData.urgencia}` },
            ],
            [
              {
                text: `T√©cnico Acolhida: ${
                  caseData.agenteAcolhida?.nome ?? "N√£o informado"
                }`,
              },
              {
                text: `T√©cnico PAEFI: ${
                  caseData.especialistaPAEFI?.nome ?? "N√£o informado"
                }`,
              },
            ],
          ],
        },
        layout: "noBorders",
      },

      // 3 ‚Äî Benef√≠cios
      ...beneficiosSection,

      // 4 ‚Äî PAF (se aplic√°vel)
      ...pafSection,

      // 5 ‚Äî Evolu√ß√µes
      {
        text: "4. HIST√ìRICO DE EVOLU√á√ïES E ATENDIMENTOS",
        style: "sectionHeader",
        margin: [0, 15, 0, 10],
      },
      {
        text: "Nota: Para ver as evolu√ß√µes detalhadas, imprima a partir da visualiza√ß√£o completa.",
        fontSize: 9,
        italics: true,
        color: "gray",
      },
    ],

    styles: {
      header: {
        fontSize: 16,
        bold: true,
        color: "#2c3e50",
      },
      sectionHeader: {
        fontSize: 12,
        bold: true,
        color: "#ffffff",
        fillColor: "#2c3e50",
        padding: 5,
        margin: [0, 10, 0, 5],
      },
      subHeader: {
        fontSize: 10,
        bold: true,
        color: "#34495e",
      },
      label: {
        fontSize: 8,
        color: "#7f8c8d",
        bold: true,
      },
      tableExample: {
        margin: [0, 5, 0, 5],
        fontSize: 10,
      },
    },
  }

  pdfMake.createPdf(docDefinition).open()
}


==================================================
FILE: frontend\src\vite-env.d.ts
==================================================

/// <reference types="vite/client" />
